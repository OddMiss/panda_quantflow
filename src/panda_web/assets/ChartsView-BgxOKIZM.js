var Zt=Object.defineProperty;var jt=(d,t,n)=>t in d?Zt(d,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[t]=n;var Qe=(d,t,n)=>jt(d,typeof t!="symbol"?t+"":t,n);import{V as Ft,W as Kt,r as l,d as $e,X as Nt,v as Ke,f as We,C as mt,c as x,o as w,b as e,a as ce,N as tt,t as A,i as pe,n as ve,j as ge,F as me,k as Se,y as Rt,A as Jt,x as Ut,_ as be,H as Ce,Y as Yt,h as ie,g as et,w as je,Z as Xt,B as Mt,e as Et,z as Qt,m as Dt,L as ea,I as Me,J as Le,G as Pt,l as ta,$ as yt}from"./main-D0gX5rEs.js";import{r as aa,a as zt,b as oa,g as sa,Q as la}from"./klinecharts-pro-8tx7OSqM.js";import{u as Je,p as At,q as na,r as ia,n as ra,G as ca,a as ua,b as da,c as ha,d as fa,e as pa,f as va,g as ma,h as ya,i as ga,j as _a,k as ba,l as wa,m as xa,T as ka,t as Ca,L as Ot,s as La}from"./index-DIQ_3w6D.js";import{r as Sa}from"./index-DNl6pEEF.js";const Bt="https://www.pandaai.online/pandaApi",Wt="token";function Ht(d,t){const n={},r=localStorage.getItem(Wt);return r&&(n.Authorization=`${r}`),fetch(Bt+d+"",{headers:n,method:"GET"})}function gt(d,t){const n={"Content-Type":"application/json"},r=localStorage.getItem(Wt);return r&&(n.Authorization=`${r}`),fetch(Bt+d,{headers:n,method:"POST",body:JSON.stringify(t)})}async function $a(){return(await Ht("/instrumentInfoData/getQuotation")).json()}async function Da(d,t,n){return(await gt("/orderFlow/getHistoryMarketData",{symbolCode:d,cycle:t,baseBarCount:n})).json()}async function Aa(d){return(await gt("/instrumentInfoData/addInstrument",{underlyingSymbol:d})).json()}async function Tt(){return(await Ht("/instrumentInfoData/queryInstrument")).json()}async function Ta(d){return(await gt("/instrumentInfoData/deleteInstrument",{underlyingSymbol:d})).json()}const Ia="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAADo6zjiAAAAAXNSR0IArs4c6QAAA1hJREFUWEftmEtoE0EYx//f2NZHSUGKiIiNIIrQgyCigooP8KAeRLRFEN9QLFJIZrelIMh6kUJ3pj140IJP0INR8SRIEWpVFFRQsPgGLXsQRdRoL7bOZyYkksY0D2ykh+5pyUy+/e33/M8S/tPV0tIyq6qq6j4RvfZ9f1P6sZT9/Pb29pkdHR1fxpvLdd0NzHzL2g2FQlM9z/tp70cBOI6zA8BlAOeVUvvHE6JYgKMJqGMAHiqllk94ACnlPGauD4KgNxaL/coHXBYPSCkfE9FSZm7UWsf+O4DjOO8AhAE0K6VOTkiAhoaGKRYsHA6vZ+Zee2+MmREEwU8btuwqKCkJC3nAdd1OZnbzeOY+tbW1hYaHh+uSNUnUTESHATwzxuwUQnAoFHrled5ILiOFAKSUd4loFYA3AASAuSk7bwEstr9RhpGcoMx8SWu96x8AViqlKgFwpg0pZT8RrbEAdmEIwM0U4TwAP4joDTNvZuZ7WuvV/whQkf1/13X7mHltEoCIbvu+vy57k+M4I8z8IA3Q1NRUWVNTs52Za1IhO87MtQAuArBvFI/H41d7enqG7XoqBNYD4wOQatV56x1Ag1LqSlkApJQHiOg0gOvMfIeIVjDzNCHEK2PMQiLayswHtdZnygrAzHu11heykmoPEZ2fBJj0wKQHcnjAzoIjtlwBLEk1sH4ADoA5JXXCdB8otgwdx7kB4I8CztHOv6dnwdeEtIoJIazEmp/oonEALwHszpwFpQJEIpH5FRUVG5nZjn07/aIpCDtxR4joqQX4AGB2npl9TSm1PdXZkp2wWA9k2hxTE0YikTlEtMhuFkLsBWDl+AtjzCGrB4jose/7dlra4ZIG2K+1PpfVCfcR0dnMHCgKIHOT4zh5FVHGLPgMwHrO6sHKhIj5xMzTAdSWFSAajS4TQvQBqB4jZEPGmHVdXV2Pcsz/ok5GBTWh53liYGAgqSXr6uqstAobYw4HQXCqvr6ePc8zueDKci4opAnHPQdyKKaizwVSyiVE9CRRit8GBwdr0yepssrybOBoNLqWmT92d3c/T6+NApBSJkUFEcV832/M0xuSS6WEYCxbf30faG1tXVBdXf1+rLNAVtkWHYKiAQq99UQDOAFgmxBiS2dnp02wkq/fFReAx7X4uMUAAAAASUVORK5CYII=",Vt=Ft("orderflow",()=>{const d=Kt(null);return{tick:d,setTick:a=>{d.value=a},getTick:()=>d.value,removeTick:()=>{d.value&&(d.value.destructor(),d.value=null)}}}),Gt=Ft("orderflow2",()=>{const d=l("sa"),t=l("SA509"),n=l(1),r=l("CZCE"),a=l(0),S=l(0),i=l(0),c=l(0),y=l(0),$=l(0),T=l(!1);return{contract:d,mainContract:t,period:n,exchange:r,priceChangeRatio:a,priceDifference:S,lastPrice:i,volume:c,openInterest:y,preSettlement:$,isShowAIPredict:T}}),Fa={class:"marketlist-container"},Na={class:"marketlist-wrapper"},Ra={class:"header"},Ma={class:"filter-right"},Ea={class:"marketlist-header"},Pa=["onClick"],za={class:"col2 code",style:{"padding-left":"5px",display:"flex","align-items":"center",gap:"5px"}},Oa=["onClick"],Ba={class:"col2 name"},Wa={class:"col2 price"},Ha=$e({__name:"MarketList",setup(d){const t=l("all"),n=l("market"),r=l(!1),a=l(null),S=Nt("child_futureListHeight"),i=l("code"),c=l(!0),y=l({}),$=l({}),T=Ke(()=>Object.values(y.value).filter(p=>!isNaN(Number(p.lastPrice))&&!isNaN(Number(p.priceDifference))&&!isNaN(Number(p.priceChangeRatio))).map(p=>({...p,lastPrice:Number(p.lastPrice.toFixed(2)),priceDifference:Number(p.priceDifference.toFixed(2)),priceChangeRatio:Number((p.priceChangeRatio*100).toFixed(2))}))),K=Ke(()=>{let _;return n.value==="optional"?_=Object.values($.value).filter(p=>!isNaN(Number(p.lastPrice))&&!isNaN(Number(p.priceDifference))&&!isNaN(Number(p.priceChangeRatio))).map(p=>({...p,lastPrice:Number(p.lastPrice.toFixed(2)),priceDifference:Number(p.priceDifference.toFixed(2)),priceChangeRatio:Number((p.priceChangeRatio*100).toFixed(2))})):t.value==="optional"?_=T.value.filter(p=>p.underlyingSymbol in $.value):_=T.value,_.sort((p,s)=>{if(i.value==="name"){const le=h[p.underlyingSymbol]||"",he=h[s.underlyingSymbol]||"";return c.value?le.localeCompare(he,"zh"):he.localeCompare(le,"zh")}if(i.value==="code")return c.value?p.code.localeCompare(s.code):s.code.localeCompare(p.code);const C=p[i.value],F=s[i.value];return c.value?Number(C)-Number(F):Number(F)-Number(C)})});function N(_){var C;const p=_.target,s=(C=a.value)==null?void 0:C.querySelector(".dropdown-menu");s!=null&&s.contains(p)||a.value&&!a.value.contains(p)&&(r.value=!1)}const h={ih:"上证50主连",if:"沪深300主连",ic:"中证500主连",im:"中证1000主连",ts:"2年期国债",tf:"5年期国债",t:"10年期国债",tl:"30年期国债",sc:"原油主连",nr:"20号胶",lu:"低硫燃料油",bc:"国际铜",ec:"欧线集运主连",au:"沪金主连",ag:"沪银主连",cu:"沪铜主连",al:"沪铝主连",zn:"沪锌主连",pb:"沪铅主连",rb:"螺纹钢主连",ru:"橡胶主连",br:"合成橡胶主连",ni:"沪镍主连",sn:"沪锡主连",sp:"纸浆主连",fu:"燃油主连",bu:"沥青主连",ss:"不锈钢主连",hc:"热轧卷板",ao:"氧化铝主连",a:"豆一主连",b:"豆二主连",c:"玉米主连",cs:"玉米淀粉主连",m:"豆粕主连",i:"铁矿石主连",pg:"液化石油气主连",y:"豆油主连",p:"棕榈油主连",jd:"鸡蛋主连",l:"塑料主连",pp:"聚丙烯主连",v:"PVC主连",eb:"苯乙烯主连",eg:"乙二醇主连",j:"焦炭主连",jm:"焦煤主连",lh:"生猪主连",lg:"原木主连",ap:"苹果主连",sr:"白糖主连",oi:"菜籽油主连",cf:"棉花主连",cy:"棉纱主连",ta:"PTA主连",px:"对二甲苯主连",pr:"瓶片主连",ma:"甲醇主连",fg:"玻璃主连",sa:"纯碱主连",sh:"烧碱主连",rm:"菜粨主连",sf:"硅铁主连",sm:"锰硅主连",ur:"尿素主连",pk:"花生主连",cj:"红枣主连",pf:"短纤主连",lc:"碳酸锂主连",si:"工业硅主连",ps:"多晶硅主连"},g={ih:.2,if:.2,ic:.2,im:.2,ts:.005,tf:.005,t:.005,tl:.01,sc:.1,nr:5,lu:1,bc:10,ec:.1,au:.02,ag:1,cu:10,al:5,zn:5,pb:5,rb:1,ru:5,br:5,ni:10,sn:10,sp:2,fu:1,bu:1,ss:5,hc:1,ao:1,a:1,b:1,c:1,cs:1,m:1,i:.5,pg:1,y:2,p:2,jd:1,l:1,pp:1,v:1,eb:1,eg:1,j:.5,jm:.5,lh:5,lg:.5,ap:1,sr:1,oi:1,cf:5,cy:5,ta:2,px:1,pr:1,ma:1,fg:1,sa:1,sh:1,rm:1,sf:2,sm:2,ur:1,pk:2,cj:5,pf:2,lc:20,si:5,ps:5};function oe(){const _=new Date,p=_.getTime()+_.getTimezoneOffset()*6e4,s=new Date(p+8*60*60*1e3),C=s.getDay(),F=s.getHours(),le=s.getMinutes();if(C===0)return!1;if(C===6){if(F<2||F===2&&le<=35)return!0}else if(F===8&&le>=50||F>8&&F<15||F===15&&le<=20||F===20&&le>=50||F>20||F<2||F===2&&le<=40)return!0;return!1}function H(_=!1){!_&&!oe()||$a().then(p=>{if(p.code==="200"){y.value=p.data;const s=y.value[J.contract];s&&(J.lastPrice=s.lastPrice,J.priceDifference=s.priceDifference,J.priceChangeRatio=s.priceChangeRatio,J.volume=s.volume,J.openInterest=s.openInterest)}})}let ae;We(()=>{document.addEventListener("click",N),H(!0),ae=setInterval(H,1e3),Tt().then(_=>{_.code=="200"&&($.value=_.data)})}),mt(()=>{document.removeEventListener("click",N),clearInterval(ae)});const ye=_=>{const p=typeof _=="string"?parseFloat(_):_;return isNaN(p)?"":p>0?"up":p<0?"down":""},de=Vt(),J=Gt();function De(_){J.contract=_,J.mainContract=y.value[_].code,J.exchange=y.value[_].exchange,J.priceChangeRatio=y.value[_].priceChangeRatio,J.priceDifference=y.value[_].priceDifference,J.lastPrice=y.value[_].lastPrice,J.volume=y.value[_].volume,J.openInterest=y.value[_].openInterest,J.preSettlement=y.value[_].preSettlement,Da(y.value[_].code,1,200).then(p=>{if(p.code=="200"){const s=de.getTick();s&&(s.updateBaseData(p.data.baseBar,g[_],y.value[_].code),J.isShowAIPredict=!1,s.ClearChart(1),s.DrawChart(1))}})}function R(_){_ in $.value?re(_):E(_)}function E(_){Aa(_).then(p=>{p.code=="200"&&Tt().then(s=>{s.code=="200"&&($.value=s.data)})})}function re(_){Ta(_).then(p=>{p.code=="200"&&delete $.value[_]})}function se(_){i.value===_?c.value=!c.value:(i.value=_,c.value=!0)}return(_,p)=>(w(),x("div",Fa,[e("div",Na,[e("div",Ra,[e("div",{class:"title",ref_key:"titleRef",ref:a},[e("span",{class:"title-text",onClick:p[0]||(p[0]=s=>r.value=!r.value)},[p[11]||(p[11]=e("img",{src:Ia,alt:"market",class:"market-icon",width:"16px"},null,-1)),tt(" "+A(n.value==="market"?"行情-期货":"自选-期货")+" ",1),ce("",!0)]),ce("",!0)],512),e("div",Ma,[e("span",{class:pe(["filter-item",{active:t.value==="all"}]),onClick:p[3]||(p[3]=s=>t.value="all")},"全部",2),e("span",{class:pe(["filter-item",{active:t.value==="optional"}]),onClick:p[4]||(p[4]=s=>t.value="optional")},"自选",2)])]),e("div",Ea,[e("span",{class:"col code",onClick:p[5]||(p[5]=s=>se("code"))},"商品代码"+A(i.value==="code"?c.value?"↑":"↓":""),1),e("span",{class:"col name",onClick:p[6]||(p[6]=s=>se("name"))},"名称"+A(i.value==="name"?c.value?"↑":"↓":""),1),e("span",{class:"col price",onClick:p[7]||(p[7]=s=>se("lastPrice"))},"最新价"+A(i.value==="lastPrice"?c.value?"↑":"↓":""),1),e("span",{class:"col change",onClick:p[8]||(p[8]=s=>se("priceDifference"))},"涨跌"+A(i.value==="priceDifference"?c.value?"↑":"↓":""),1),e("span",{class:"col changePercent",onClick:p[9]||(p[9]=s=>se("priceChangeRatio"))},"涨跌幅"+A(i.value==="priceChangeRatio"?c.value?"↑":"↓":""),1)]),e("div",{class:"future-list",style:ve({"max-height":`calc(${ge(S)}vh - 120px)`})},[(w(!0),x(me,null,Se(K.value,s=>Rt((w(),x("div",{key:s.code,class:"marketlist-row",onClick:C=>De(s.underlyingSymbol)},[e("span",za,[e("span",{class:pe(["optional-svg",{added:s.underlyingSymbol in $.value}]),onClick:Ut(C=>R(s.underlyingSymbol),["stop"])},p[12]||(p[12]=[e("svg",{t:"1743647836070",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1646",width:"32",height:"32"},[e("path",{d:"M818.56 50.432a128 128 0 0 1 128 128v667.136a128 128 0 0 1-179.84 117.056L512 849.792l-254.72 112.832a128 128 0 0 1-179.84-117.12V178.496a128 128 0 0 1 128-128h613.12zM528 242.176a32 32 0 0 0-40.384 6.848l-3.328 4.736-56.512 97.28-109.952 23.68a32 32 0 0 0-20.544 48l3.456 4.608 75.008 83.776-11.456 111.872a32 32 0 0 0 39.296 34.368l5.504-1.856L512 610.048l102.848 45.44a32 32 0 0 0 44.8-26.752v-5.76l-11.456-111.872 75.008-83.84a32 32 0 0 0-11.52-50.88l-5.568-1.728-109.952-23.68-56.512-97.28a32 32 0 0 0-11.52-11.52z",fill:"#E1E2E3","p-id":"1647"})],-1)]),10,Oa),tt(" "+A(s.code),1)]),e("span",Ba,A(h[s.underlyingSymbol]),1),e("span",Wa,A(s.lastPrice),1),e("span",{class:pe(["col2 change",ye(s.priceDifference)])},A(s.priceDifference),3),e("span",{class:pe(["col2 changePercent",ye(s.priceChangeRatio)])},A(s.priceChangeRatio)+"% ",3)],8,Pa)),[[Jt,s.underlyingSymbol in h]])),128))],4)])]))}}),Va=be(Ha,[["__scopeId","data-v-24c42559"]]),Ga={class:"aiprediction-container"},qa={class:"aiprediction-wrapper"},Za=["onClick"],ja={key:0},Ka={key:1},Ja={key:0,class:"model-options"},Ua=["onClick"],Ya=$e({__name:"AiPrediction",setup(d){const t=Vt(),n=Gt(),r=["SVM","RandomForest","LSTM","MLP","Transformer","XGBoost"],a={LSTM:[{value:"LSTM_SET_1",label:"2个layer，每个layer有50个units"},{value:"LSTM_SET_2",label:"2个layer，每个layer有100个units"},{value:"LSTM_SET_3",label:"2个layer，每个layer有25个units"}],MLP:[{value:"MLP_SET_1",label:"1个hidden layer，64个神经元"},{value:"MLP_SET_2",label:"1个hidden layer，64个神经元"},{value:"MLP_SET_3",label:"1个hidden layer，64个神经元"}],RandomForest:[{value:"RF_SET_1",label:"15个estimators，max_depth无限制"},{value:"RF_SET_2",label:"25个estimators，max_depth为5"},{value:"RF_SET_3",label:"10个estimators，max_depth为3"}],SVM:[{value:"SVM_SET_1",label:"RBF核，C=1.0，epsilon=0.1"},{value:"SVM_SET_2",label:"RBF核，C=10.0，epsilon=0.01"},{value:"SVM_SET_3",label:"RBF核，C=0.1，epsilon=0.5"}],Transformer:[{value:"TRANSFORMER_SET_1",label:"Head_size为64，单层结构，dropout是10%"},{value:"TRANSFORMER_SET_2",label:"Head_size为128，layer为2，dropout为20%"},{value:"TRANSFORMER_SET_3",label:"Head_size为32，layer为1，dropout为5%"}],XGBoost:[{value:"XGBOOST_SET_1",label:"n_estimators为5，最大深度为1，学习率为0.1，行采样比例为0.5，列采样比例为0.5"},{value:"XGBOOST_SET_2",label:"n_estimators为10，最大深度为2，学习率为0.15，行采样比例为0.5，列采样比例为0.6"},{value:"XGBOOST_SET_3",label:"n_estimators为15，最大深度为3，学习率为0.2，行采样比例为0.6，列采样比例为0.5"}]},S=l(0),i=l(1),c=l(null);function y(h){S.value=h}function $(h){i.value=h}Ce(S,h=>{if(!c.value)return;const oe=c.value.querySelectorAll(".card")[h],H=c.value,ae=H.getBoundingClientRect(),ye=oe.getBoundingClientRect(),de=ye.left-ae.left-ae.width/2+ye.width/2;H.scrollBy({left:de,behavior:"smooth"})}),We(()=>{y(2)});function T(h){const g=Math.abs(h-S.value);return{margin:"-12px",transform:`scale(${1.3-g*.14})`,zIndex:6-g}}function K(){n.isShowAIPredict=!0;const h=t.getTick();if(h){h.ifDrawAIPredict=!0;const g=a[r[S.value]][i.value].value;h.modelSetting=g,h.exchange=n.exchange,h.StartUpdateAIPredictData(!0)}}function N(){n.isShowAIPredict=!1;const h=t.getTick();h&&(h.ifDrawAIPredict=!1,h.ClearChart(1),h.DrawChart(2))}return(h,g)=>(w(),x("div",Ga,[e("div",qa,[g[5]||(g[5]=e("div",{class:"title"}," Ai预测 ",-1)),e("div",{class:"card-container",ref_key:"container",ref:c},[g[1]||(g[1]=e("div",{class:"spacer"},null,-1)),(w(),x(me,null,Se(r,(oe,H)=>e("div",{class:pe(["card",{"selected-card":S.value===H}]),key:H,style:ve(T(H)),onClick:ae=>y(H)},[oe==="RandomForest"?(w(),x("span",ja,g[0]||(g[0]=[tt("Random"),e("br",null,null,-1),tt("Forest")]))):(w(),x("span",Ka,A(oe),1))],14,Za)),64)),g[2]||(g[2]=e("div",{class:"spacer"},null,-1))],512),g[6]||(g[6]=e("div",{class:"sub-title"}," 预测模型 ",-1)),a[r[S.value]]?(w(),x("div",Ja,[(w(!0),x(me,null,Se(a[r[S.value]],(oe,H)=>(w(),x("div",{key:oe.value,class:pe(["option-item",{"selected-option":i.value===H}]),onClick:ae=>$(H)},A(oe.label),11,Ua))),128))])):ce("",!0),ge(n).isShowAIPredict?ce("",!0):(w(),x("div",{key:1,class:"start-btn",onClick:K},g[3]||(g[3]=[e("div",null,[e("svg",{width:"16px",height:"15px",viewBox:"0 0 16 15",xmlns:"http://www.w3.org/2000/svg"},[e("g",{fill:"#2767EE","fill-rule":"nonzero"},[e("path",{d:"M6.212,12 L0,12 L0,0 L15,0 L15,6.258 C14.691518,6.0047443 14.3561779,5.78610256 14,5.606 L14,1 L1,1 L1,9 L6.212,9 C6.1189172,9.32684284 6.05631633,9.66160683 6.025,10 L1,10 L1,11 L6.025,11 C6.056,11.344 6.12,11.677 6.212,12 Z M4,13 L4,14 L7.257,14 C7.0040793,13.6912725 6.78546229,13.3559704 6.605,13 L4,13 Z M7.685,13.438 L8.392,14.145 L9.806,12.731 L9.099,12.024 L7.685,13.438 Z M13.341,9.196 L14.755,7.782 L14.048,7.075 L12.634,8.489 L13.341,9.196 Z M7.685,7.782 L9.099,9.196 L9.806,8.489 L8.392,7.075 L7.685,7.782 L7.685,7.782 Z M12.634,12.731 L14.048,14.145 L14.755,13.438 L13.341,12.024 L12.634,12.731 Z M11,15 L12,15 L12,13 L11,13 L11,15 Z M11,8 L12,8 L12,6 L11,6 L11,8 Z M9,10 L7,10 L7,11 L9,11 L9,10 Z M14,10 L14,11 L16,11 L16,10 L14,10 Z"})])])],-1),e("div",null,"启动",-1)]))),ge(n).isShowAIPredict?(w(),x("div",{key:2,class:"stop-btn",onClick:N},g[4]||(g[4]=[e("div",{class:"rotate-svg"},[e("svg",{t:"1747576575240",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1505",width:"16",height:"16"},[e("path",{d:"M512 0a51.2 51.2 0 0 1 51.2 51.2v153.6a51.2 51.2 0 0 1-102.4 0V51.2a51.2 51.2 0 0 1 51.2-51.2z m0 768a51.2 51.2 0 0 1 51.2 51.2v153.6a51.2 51.2 0 0 1-102.4 0v-153.6a51.2 51.2 0 0 1 51.2-51.2z m443.392-512a51.2 51.2 0 0 1-18.7392 69.9392l-133.0176 76.8a51.2 51.2 0 1 1-51.2-88.6784l133.0176-76.8A51.2 51.2 0 0 1 955.392 256zM290.304 640a51.2 51.2 0 0 1-18.7392 69.9392l-133.0176 76.8a51.2 51.2 0 1 1-51.2-88.6784l133.0176-76.8a51.2 51.2 0 0 1 69.9392 18.7392zM955.392 768a51.2 51.2 0 0 1-69.9392 18.7392l-133.0176-76.8a51.2 51.2 0 0 1 51.2-88.6784l133.0176 76.8A51.2 51.2 0 0 1 955.392 768zM290.304 384a51.2 51.2 0 0 1-69.9392 18.7392l-133.0176-76.8a51.2 51.2 0 1 1 51.2-88.6784l133.0176 76.8A51.2 51.2 0 0 1 290.304 384z",fill:"#ffffff","p-id":"1506"})])],-1),e("div",null,"停止",-1)]))):ce("",!0)])]))}}),Xa=be(Ya,[["__scopeId","data-v-aecc3abd"]]),Qa={class:"toppanel-container"},eo={class:"toppanel-wrapper"},to={key:0,class:"item"},ao={key:1,class:"item"},oo=$e({__name:"index",props:{currentCustomPanelIndex:{},currentCustomPanelIndexModifiers:{}},emits:["update:currentCustomPanelIndex"],setup(d){const t=Yt(d,"currentCustomPanelIndex");return(n,r)=>(w(),x("div",Qa,[e("div",eo,[t.value==1?(w(),x("div",to,[ie(Va)])):ce("",!0),t.value==2?(w(),x("div",ao,[ie(Xa)])):ce("",!0)])]))}}),so=be(oo,[["__scopeId","data-v-c35fb331"]]),lo={class:"header"},no={class:"date-wrapper"},io={style:{width:"0",height:"0",overflow:"hidden",position:"absolute","z-index":"99999999"}},ro={key:0,class:"es"},co=["onClick"],uo={__name:"table-right",setup(d){const t=Je(),n=Nt("child_dailyPositionHeight"),r=l([]),a=l([]),S=l(!1),i=l(1),c=l(10),y=l(0),$=l(1),T=l(new Set),K=R=>R==null?"¥0.00":`¥${(R/100).toFixed(2)}`;Ce(()=>[t.timeRange,t.startDate,t.endDate],async([R,E,re])=>{E&&re&&(g.value=re,await N())},{immediate:!0}),Ce(()=>t.rightTableData,async R=>{R&&R.node_output&&await N()},{immediate:!0});const N=async()=>{var R;if(console.log("Fetching position data with:",{rightTableData:t.rightTableData,nodeOutput:(R=t.rightTableData)==null?void 0:R.node_output,selectedDate:g.value,isInitialized:S.value}),!t.rightTableData||!t.rightTableData.node_output){console.log("Missing required data for fetch");return}try{await t.fetchBacktestPosition(t.rightTableData.node_output,1,1e4,""),t.backtestPosition&&t.backtestPosition.data&&(a.value=t.backtestPosition.data.items||[],T.value=new Set(a.value.map(E=>typeof E.gmt_create=="string"&&E.gmt_create.length===8?`${E.gmt_create.slice(0,4)}-${E.gmt_create.slice(4,6)}-${E.gmt_create.slice(6,8)}`:ae(new Date(E.gmt_create)))),(!g.value||!S.value)&&T.value.size>0&&(g.value=Array.from(T.value)[0],S.value=!0),h())}catch(E){console.error("获取持仓数据失败",E)}},h=()=>{if(console.log("Filtering data with date:",g.value),console.log("Available data:",a.value),!g.value||!a.value){r.value=[],y.value=0;return}const R=a.value.filter(se=>{const _=typeof se.gmt_create=="string"&&se.gmt_create.length===8?`${se.gmt_create.slice(0,4)}-${se.gmt_create.slice(4,6)}-${se.gmt_create.slice(6,8)}`:ae(new Date(se.gmt_create)),p=ae(new Date(g.value));return console.log("Comparing dates:",{itemDate:_,selectedDateStr:p,original:se.gmt_create}),_===p});console.log("Filtered data:",R),y.value=R.length,$.value=Math.ceil(y.value/c.value);const E=(i.value-1)*c.value,re=E+c.value;r.value=R.slice(E,re),console.log("Final position data:",r.value)},g=l(""),oe=l(null);Ce(g,()=>{i.value=1,h()});const H=()=>{var R;(R=oe.value)==null||R.focus()},ae=R=>{if(!R)return"";const E=new Date(R),re=E.getFullYear(),se=String(E.getMonth()+1).padStart(2,"0"),_=String(E.getDate()).padStart(2,"0");return`${re}-${se}-${_}`},ye=R=>{const E=ae(R);return!T.value.has(E)},de=R=>{if(!R)return"";const E=R.substring(0,4),re=R.substring(4,6),se=R.substring(6,8);return`${E}-${re}-${se}`},J=async R=>{const E=R.indexOf("."),re=R.substring(0,E);await t.fetchBacktestTrade(t.rightTableData.node_output,1,1e4);const se=t.backtestTrade.data.items,_=se.filter(C=>C.business===0),p=se.filter(C=>C.business===1),s={buyFigure:_.map(C=>({timestamp:new Date(de(C.gmt_create)).getTime(),value:C.price})),sellFigure:p.map(C=>({timestamp:new Date(de(C.gmt_create)).getTime(),value:C.price}))};console.log("overlay",s),t.klineCharthandleContractChange(re,s)},De=()=>{const R=document.querySelectorAll('[id^="el-popper-container-"]');console.log("找到popper元素数量:",R.length),R.forEach(E=>{E.style.position="relative",E.style.zIndex="99999999999999999",console.log(`已设置元素 ${E.id} 的样式`)})};return We(async()=>{console.log("Component mounted"),De(),await N()}),(R,E)=>{const re=et("el-icon"),se=et("el-date-picker");et("el-pagination");const _=et("el-table-column"),p=et("el-table");return w(),x("div",{class:"table-right",style:ve({maxHeight:ge(n)+"vh"})},[e("div",lo,[e("div",no,[e("span",{class:"date-text",onClick:H},"每日持仓"),g.value?(w(),x("span",{key:0,class:"selected-date",onClick:H},"（"+A(ae(g.value))+"）",1)):ce("",!0),ie(re,{class:"arrow-icon",onClick:H},{default:je(()=>[ie(ge(Xt))]),_:1}),e("div",io,[ie(se,{modelValue:g.value,"onUpdate:modelValue":E[0]||(E[0]=s=>g.value=s),type:"date",placeholder:"请选择日期",size:"small",clearable:!1,class:"table-right-date-picker",ref_key:"datePicker",ref:oe,"disabled-date":ye},null,8,["modelValue"])])]),r.value.length>0?(w(),x("div",ro,"已持仓"+A(y.value),1)):ce("",!0),ce("",!0)]),ie(p,{data:r.value,border:"",style:{width:"100%"},"max-height":`calc(${ge(n)}vh - 20px)`,class:"custom-table-r"},{default:je(()=>[ie(_,{fixed:"",prop:"contract_name",label:"标的"}),ie(_,{width:"100",prop:"contract_code",label:"代码"},{default:je(s=>[e("span",{class:"contract-code",onClick:C=>J(s.row.contract_code)},A(s.row.contract_code),9,co)]),_:1}),ie(_,{label:"最新价"},{default:je(s=>[e("span",null,A(K(s.row.last_price)),1)]),_:1}),ie(_,{label:"仓位"},{default:je(s=>[e("span",{class:pe(s.row.direction===0?"position-long":"position-short")},A(s.row.direction===0?"多":"空")+" "+A(Math.abs(s.row.position)),3)]),_:1}),ie(_,{label:"开仓均价"},{default:je(s=>[e("span",null,A(K(s.row.price)),1)]),_:1}),ie(_,{fixed:"right",label:"累积盈亏"},{default:je(s=>[e("span",{class:pe(["profit",s.row.accumulate_profit>0?"profit-positive":"profit-negative"])},A(K(s.row.accumulate_profit)),3)]),_:1})]),_:1},8,["data","max-height"])],4)}}},ho=be(uo,[["__scopeId","data-v-dc4d211b"]]),fo={class:"foot-head"},po={class:"menu"},vo=["onClick"],mo=$e({__name:"foot-head",props:{activeTab:{},tabs:{}},emits:["tabChange"],setup(d,{emit:t}){const n=t,r=a=>{n("tabChange",a)};return(a,S)=>(w(),x("div",fo,[ce("",!0),e("div",po,[(w(!0),x(me,null,Se(a.tabs,(i,c)=>(w(),x("div",{key:i.key,class:pe(["menu-item",{active:a.activeTab===i.key}]),onClick:y=>r(i.key)},A(i.label),11,vo))),128))]),ce("",!0)]))}}),yo=be(mo,[["__scopeId","data-v-e19dc403"]]);class go{constructor(t){Qe(this,"_apiKey");Qe(this,"_subscriptions",new Map);Qe(this,"_currentSubscription",null);Qe(this,"_debounceTimer",null);this._apiKey=t}async searchSymbols(t){try{const n=await fetch("https://www.pandaai.online/pandaApi/historyData/querySymobl");if(!n.ok)return console.error(`API 请求失败: ${n.status} ${n.statusText}`),[];const r=await n.json();if(console.log("API 返回结果:",r),r.code!=="200"||!r.data)return console.error("API 返回错误:",r.message),[];const a=Object.values(r.data);console.log(`获取到 ${a.length} 个合约`);let S=a;if(t&&t.trim()){const i=t.toLowerCase();S=a.filter(c=>c.symbol.includes(i)||c.tradingCode.toLowerCase().includes(i)),console.log(`搜索 "${t}" 匹配到 ${S.length} 个合约`)}return S.map(i=>({ticker:i.orderBookID||"",name:i.tradingCode||i.code||"",shortName:i.symbol||"",exchange:i.exchange||"",market:"futures",pricePrecision:2,volumePrecision:0,priceCurrency:"CNY",type:"future"}))}catch(n){return console.error("搜索代码时发生错误:",n),[]}}async getHistoryKLineData(t,n,r,a){console.log("getHistoryKLineData",t,n,r,a),r=r-5*24*60*60*1e3;const i=await(await fetch(`https://www.pandaai.online/pandaApi/historyData/queryHistoryData?startDate=${r}&endDate=${a}&symbol=${t.ticker.toUpperCase()}&period=${n.text}&quotationType=future`)).json();return i.data=i.data.reverse(),await(i.data||[]).map(c=>({timestamp:parseInt(c.date),open:c.open,high:c.high,low:c.low,close:c.close,volume:c.volume,turnover:c.volume}))}async subscribe(t,n,r){const a=`${t.ticker}_${n.text}`;console.log(`订阅数据: ${a}`),this._debounceTimer&&(clearTimeout(this._debounceTimer),this._debounceTimer=null),this._debounceTimer=setTimeout(async()=>{try{if(this._subscriptions.has(a)){console.log(`已存在订阅 ${a}，先取消再重新订阅`);const i=this._subscriptions.get(a);i&&clearInterval(i),this._subscriptions.delete(a)}this._subscriptions.forEach((i,c)=>{c!==a&&(console.log(`取消其他订阅: ${c}`),clearInterval(i))}),this._subscriptions.clear(),this._currentSubscription=a;const S=setInterval(async()=>{if(this._currentSubscription!==a){console.log(`订阅 ${a} 已过期，停止数据获取`);return}try{const i={symbolCode:t.ticker||"SA509",cycle:1,baseBarCount:1};let c=localStorage.getItem("token");c="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1aWQiOiI0In0.m_uYVVkN6saALnHY9OyU6WIVNfLmku0Q_0lCX6DKNfTbezBJUSMqiDtTvXAnxGC1cNpeDKIkSlCh_GcIH3F5MRUbYNwmUCF_ZANYIP0vZbp6CUIOuGR9wiKtsjo5BAv4ecczMf2SsCWyBxOQN0K7h4yhSR6iVpyV5MkM0SLsDGCI0VnwbLFEANjgFGi-Hz_RICd_SIAIQxBtwPgOzeowEgnoKILpFs7xvOao3GDpJqo7GmeLmTzzilpH8udWo74SyEfxYewRodjkPi2VOdlTiWaX1qMv16seX0JKhJsuDk88eEMIJcjg9Y5G29hDzjef2z89Yjjyi_0dxh9Rla_Xsw";const y=await fetch("https://www.pandaai.online/pandaApi/orderFlow/getHistoryMarketData",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`${c}`},body:JSON.stringify(i)});if(!y.ok)throw new Error(`API请求失败: ${y.status} ${y.statusText}`);const $=await y.json();if($.code!=="200")throw new Error(`API返回错误: ${$.code} - ${$.message}`);if(!$.data||$.data.length===0||$.data.baseBar.length===0)return;const T=$.data.baseBar[0],K={timestamp:this.parseTickTime(T.ticktime),open:T.open,high:T.high,low:T.close,close:T.close,volume:T.volume};this._currentSubscription===a&&r(K)}catch(i){console.error(`订阅 ${a} 数据获取失败:`,i)}},1e3);this._subscriptions.set(a,S),console.log(`✅ 订阅创建成功: ${a}`)}catch(S){console.error(`创建订阅失败: ${a}`,S)}},300)}unsubscribe(t,n){const r=`${t.ticker}_${n.text}`;if(console.log(`取消订阅: ${r}`),this._debounceTimer&&(clearTimeout(this._debounceTimer),this._debounceTimer=null),this._subscriptions.has(r)){const a=this._subscriptions.get(r);a&&(clearInterval(a),console.log(`✅ 已取消订阅: ${r}`)),this._subscriptions.delete(r)}this._currentSubscription===r&&(this._currentSubscription=null)}unsubscribeAll(){console.log("取消所有订阅"),this._debounceTimer&&(clearTimeout(this._debounceTimer),this._debounceTimer=null),this._subscriptions.forEach((t,n)=>{clearInterval(t),console.log(`✅ 已取消订阅: ${n}`)}),this._subscriptions.clear(),this._currentSubscription=null}async getOrderFlowData(t){try{console.log(`📡 调用PandaAI订单流API: ${t.ticker}`);const n={symbolCode:t.ticker||"SA509",cycle:1,baseBarCount:1e4};let r=localStorage.getItem("token");r="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1aWQiOiI0In0.m_uYVVkN6saALnHY9OyU6WIVNfLmku0Q_0lCX6DKNfTbezBJUSMqiDtTvXAnxGC1cNpeDKIkSlCh_GcIH3F5MRUbYNwmUCF_ZANYIP0vZbp6CUIOuGR9wiKtsjo5BAv4ecczMf2SsCWyBxOQN0K7h4yhSR6iVpyV5MkM0SLsDGCI0VnwbLFEANjgFGi-Hz_RICd_SIAIQxBtwPgOzeowEgnoKILpFs7xvOao3GDpJqo7GmeLmTzzilpH8udWo74SyEfxYewRodjkPi2VOdlTiWaX1qMv16seX0JKhJsuDk88eEMIJcjg9Y5G29hDzjef2z89Yjjyi_0dxh9Rla_Xsw";const a=await fetch("https://www.pandaai.online/pandaApi/orderFlow/getHistoryMarketData",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`${r}`},body:JSON.stringify(n)});if(!a.ok)throw new Error(`API请求失败: ${a.status} ${a.statusText}`);const S=await a.json();if(S.code!=="200")throw new Error(`API返回错误: ${S.code} - ${S.message}`);const i=this.convertPandaApiDataToOrderFlow(S.data,t);return console.log(`✅ 转换完成，共${i.length}条订单流数据`),i}catch(n){return console.error("❌ 获取订单流数据失败:",n),console.warn("🔄 使用模拟数据作为降级方案"),this.generateMockOrderFlowData(t)}}convertPandaApiDataToOrderFlow(t,n){if(!t||!t.baseBar||!Array.isArray(t.baseBar))return console.warn("⚠️ API数据格式不正确，使用模拟数据"),this.generateMockOrderFlowData(n);const r=[];for(const a of t.baseBar)try{const S=this.parseTickTime(a.ticktime),i=[],c=a.price||[],y=a.Ask||[],$=a.Bid||[];for(let K=0;K<c.length;K++){const N=c[K],h=y[K]||0,g=$[K]||0;N&&(h>0||g>0)&&i.push({price:Number(N.toFixed(2)),buyVolume:g,sellVolume:h,totalVolume:g+h})}i.sort((K,N)=>K.price-N.price);const T={timestamp:S,priceLevels:i,tickSize:.5,open:a.open,high:a.high,low:a.low,close:a.close,volume:a.volume,delta:a.delta};r.push(T)}catch(S){console.error("❌ 转换单个Bar数据失败:",S,a)}return r}parseTickTime(t){try{if(!t)return Date.now();const n=new Date(t);return isNaN(n.getTime())?(console.warn(`⚠️ 无法解析时间格式: ${t}，使用当前时间`),Date.now()):n.getTime()}catch(n){return console.error("❌ 时间解析失败:",n,t),Date.now()}}generateMockOrderFlowData(t){console.log(`🔄 生成 ${t.ticker} 的模拟订单流数据`);const n=[],r=Date.now()-5*24*60*60*1e3;for(let a=100;a>=0;a--){const S=r-a*60*1e3,i=100+Math.random()*20,c=[];for(let y=0;y<10;y++){const $=i+(y-5)*.1,T=Math.floor(Math.random()*1e3),K=Math.floor(Math.random()*1e3);c.push({price:Number($.toFixed(2)),buyVolume:T,sellVolume:K,totalVolume:T+K})}n.push({timestamp:S,priceLevels:c,tickSize:.01})}return console.log("mockData",n),n}}const _o={class:"table-container"},bo={class:"table-wrapper"},wo={class:"custom-table"},xo=["title"],ko={class:"name-cell table-cell"},Co=["onBlur","onKeyup"],Lo=["title"],So=["onClick"],$o={class:"table-cell"},Do={class:"table-cell"},Ao={style:{"text-align":"right"}},To=["onClick"],Io=["onClick"],Fo={key:0,class:"loading-spinner"},No={class:"pagination"},Ro={class:"page-nav"},Mo=["disabled"],Eo={style:{transform:"rotate(180deg)"},viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"32302",width:"16",height:"16"},Po={key:0,class:"dots"},zo=["onClick"],Oo=["disabled"],Bo={style:{transform:"rotate(0deg)"},viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"32302",width:"16",height:"16"},Wo={__name:"tableb",props:{tableData:{type:Array,default:()=>[]}},emits:["apply"],setup(d,{expose:t,emit:n}){const r=Mt(),a=n;Je();const S=Et(),i=s=>{S.push(`/editor?workflow_id=${s}`)},c=l(null),y=l(""),$=l(null),T=d,K=Ke(()=>!T.tableData||!T.tableData.data||!T.tableData.data.workflows?[]:T.tableData.data.workflows.map(s=>({id:s._id,name:s.name,createTime:At(s.create_at),modifyTime:At(s.update_at),item:s}))),N=l([]);Ce(K,s=>{N.value=s},{immediate:!0});const h=l(1),g=l(10),oe=Ke(()=>N.value.length),H=Ke(()=>Math.ceil(oe.value/g.value)),ae=Ke(()=>{const s=(h.value-1)*g.value,C=s+g.value;return N.value.slice(s,C)}),ye=Ke(()=>{const s=[],C=H.value,F=h.value;if(C<=5){for(let le=1;le<=C;le++)s.push(le);return s}if(s.push(1),F>3&&s.push("..."),F===1||F===2)s.includes(2)||s.push(2),s.includes(3)||s.push(3);else if(F===C||F===C-1)for(let le=C-2;le<C;le++)s.includes(le)||s.push(le);else s.push(F-1,F,F+1);return F<C-2&&s.push("..."),s.includes(C)||s.push(C),[...new Set(s)]}),de=s=>{s!=="..."&&(h.value=s)},J=()=>{h.value>1&&h.value--},De=()=>{h.value<H.value&&h.value++},R=l({}),E=(s,C)=>{R.value[C]=!0,a("apply",{workflow_id:s._id,title:s.name,feature_tag:"factor",locator:"task_id"}),setTimeout(()=>{R.value[C]=!1},5e3),console.log("应用项目：",s)},re=s=>{s?R.value[s]=!1:Object.keys(R.value).forEach(C=>{R.value[C]=!1})};Ce(K,()=>{re()},{deep:!0}),t({resetLoadingState:re});const se=async s=>{var C;c.value=s.id,y.value=s.name,await Me(),(C=$.value)==null||C.focus()},_=async s=>{if(!y.value.trim()){r.error("名称不能为空"),y.value=s.name;return}if(y.value===s.name){c.value=null;return}try{await Sa(s.id,y.value);const C=N.value.findIndex(F=>F.id===s.id);C!==-1&&(N.value[C].name=y.value),c.value=null,r.success("名称修改成功")}catch(C){console.error("重命名失败:",C),y.value=s.name,r.error("名称修改失败，请稍后重试")}},p=()=>{c.value=null,y.value=""};return(s,C)=>(w(),x("div",_o,[e("div",bo,[e("table",wo,[C[2]||(C[2]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"名称"),e("th",null,"创建时间"),e("th",null,"修改时间"),e("th")])],-1)),e("tbody",null,[(w(!0),x(me,null,Se(ae.value,(F,le)=>(w(),x("tr",{key:F.id},[e("td",{class:"table-cell",title:F.id},A(F.id),9,xo),e("td",ko,[c.value===F.id?Rt((w(),x("input",{key:0,"onUpdate:modelValue":C[0]||(C[0]=he=>y.value=he),type:"text",class:"edit-input",onBlur:he=>_(F),onKeyup:[Dt(he=>_(F),["enter"]),Dt(p,["esc"])],ref_for:!0,ref_key:"editInput",ref:$},null,40,Co)),[[Qt,y.value]]):(w(),x(me,{key:1},[e("span",{class:"table-cell",title:F.name},A(F.name),9,Lo),F.owner!=="*"?(w(),x("span",{key:0,class:"copy-icon",onClick:he=>se(F)},C[1]||(C[1]=[ea('<svg width="12px" height="12px" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" data-v-63473ec7><title data-v-63473ec7>修改名称</title><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" data-v-63473ec7><g id="超级图表-工作流" transform="translate(-364, -729)" fill="#2767EE" fill-rule="nonzero" data-v-63473ec7><g id="编辑" transform="translate(364, 729)" data-v-63473ec7><path d="M5.98554217,5.31036145 L10.9359036,0.361445783 C11.1310843,0.16626506 11.4477108,0.16626506 11.6428916,0.361445783 C11.8380723,0.556626506 11.8380723,0.873253012 11.6428916,1.06843373 L6.69253012,6.0173494 C6.4973494,6.21253012 6.18072289,6.21253012 5.98554217,6.0173494 C5.79036145,5.82216867 5.79036145,5.50554217 5.98554217,5.31036145 Z M10.9995181,5.83373494 C10.9995181,5.55759036 11.2236145,5.33349398 11.499759,5.33349398 C11.7759036,5.33349398 12,5.55759036 12,5.83373494 L12,9.50024096 C12,10.8809639 10.8809639,12 9.50024096,12 L2.49975904,12 C1.11903614,12 0,10.8809639 0,9.50024096 L0,2.49975904 C0,1.11903614 1.11903614,0 2.49975904,0 L6.16626506,0 C6.44240964,0 6.66650602,0.224096386 6.66650602,0.500240964 C6.66650602,0.776385542 6.44240964,1.00048193 6.16626506,1.00048193 L2.49975904,1.00048193 C1.6713253,1.00048193 1.00048193,1.67277108 1.00048193,2.49975904 L1.00048193,9.50024096 C1.00048193,10.3286747 1.67277108,11.0009639 2.49975904,11.0009639 L9.50024096,11.0009639 C10.3286747,11.0009639 11.0009639,10.3286747 11.0009639,9.50024096 L11.0009639,5.83373494 L10.9995181,5.83373494 Z" id="形状" data-v-63473ec7></path></g></g></g></svg>',1)]),8,So)):ce("",!0)],64))]),e("td",$o,A(F.createTime),1),e("td",Do,A(F.modifyTime),1),e("td",Ao,[e("button",{class:pe(["apply-btn"]),onClick:he=>i(F.id),style:{"margin-right":"10px"}}," 编辑 ",8,To),e("button",{class:pe(["apply-btn",{loading:R.value[F.id]}]),onClick:he=>E(F.item,F.id)},[tt(A(R.value[F.id]?"正在应用":"应用")+" ",1),R.value[F.id]?(w(),x("span",Fo)):ce("",!0)],10,Io)])]))),128))])])]),e("div",No,[e("div",Ro,[e("button",{disabled:h.value===1,onClick:J},[(w(),x("svg",Eo,C[3]||(C[3]=[e("path",{"data-v-da8ede72":"",d:"M722.438 510.815c-0.246-0.246-0.513-0.454-0.766-0.69l-299.893-299.892c-14.231-14.24-37.291-14.24-51.529 0-14.241 14.231-14.241 37.291 0 51.529l274.851 274.859-274.849 274.851c-14.241 14.237-14.241 37.301 0 51.532 7.116 7.119 16.436 10.682 25.764 10.682 9.321 0 18.644-3.563 25.763-10.682l299.905-299.901c0.246-0.234 0.51-0.438 0.751-0.678 7.129-7.13 10.685-16.469 10.674-25.804 0.006-9.337-3.55-18.676-10.674-25.804z",fill:"#ffffff","p-id":"32303"},null,-1)])))],8,Mo),(w(!0),x(me,null,Se(ye.value,(F,le)=>(w(),x(me,{key:le},[F==="..."?(w(),x("span",Po,"...")):(w(),x("button",{key:1,class:pe({active:F===h.value}),onClick:he=>de(F)},A(F),11,zo))],64))),128)),e("button",{disabled:h.value===H.value,onClick:De},[(w(),x("svg",Bo,C[4]||(C[4]=[e("path",{"data-v-da8ede72":"",d:"M722.438 510.815c-0.246-0.246-0.513-0.454-0.766-0.69l-299.893-299.892c-14.231-14.24-37.291-14.24-51.529 0-14.241 14.231-14.241 37.291 0 51.529l274.851 274.859-274.849 274.851c-14.241 14.237-14.241 37.301 0 51.532 7.116 7.119 16.436 10.682 25.764 10.682 9.321 0 18.644-3.563 25.763-10.682l299.905-299.901c0.246-0.234 0.51-0.438 0.751-0.678 7.129-7.13 10.685-16.469 10.674-25.804 0.006-9.337-3.55-18.676-10.674-25.804z",fill:"#ffffff","p-id":"32303"},null,-1)])))],8,Oo)])])]))}},Ho=be(Wo,[["__scopeId","data-v-63473ec7"]]),Vo={class:"factor-analysis"},Go={class:"metrics-bar"},qo={class:"metric"},Zo={class:"metric"},jo={class:"metric"},Ko={class:"metric"},Jo={class:"value"},Uo={__name:"aa",props:{taskId:{type:String,required:!0}},setup(d){const t=Je(),n=d,r=l({annualized_ratio:0,maximum_drawdown:0,return_ratio:0,sharpe_ratio:0}),a=N=>{const h=parseFloat(N);return h>0?"#f92855":h<0?"#2dc08e":"#fff"},S=l(null);let i=null,c=null;const y=l({}),$=()=>{if(i=Le(S.value),Object.keys(y.value).length===0){console.log("data为空");return}let N=JSON.parse(JSON.stringify(y.value));N.simple_return_chart.y[0].data=y.value.simple_return_chart.y[0].data.map(g=>na(g*100)),N.simple_return_chart.x[0].data=y.value.simple_return_chart.x[0].data.map(g=>ia(new Date(g))),console.log("data:",N.simple_return_chart.y[0].data.length);const h={title:{},tooltip:{trigger:"axis",formatter:function(g){const oe=g[0].axisValue,H=g[0].value;return`${oe}<br/>${H}%`}},grid:{left:"5%",right:"5%",bottom:"5%",top:"10%",containLabel:!0},xAxis:[{type:"category",data:N.simple_return_chart.x[0].data,onZero:!0,show:!1,axisPointer:{type:"none"},lineStyle:{color:"#fff",width:0}},{type:"category",data:N.simple_return_chart.x[0].data,boundaryGap:!1,axisTick:{alignWithLabel:!0,show:!0,length:5,lineStyle:{color:"#858585"}},axisLabel:{color:"#858585",fontSize:10},position:"bottom"}],yAxis:{type:"value",min:Math.min(0,Math.min(...N.simple_return_chart.y[0].data)),max:Math.max(0,Math.max(...N.simple_return_chart.y[0].data)),splitNumber:6,axisLabel:{color:"#858585",formatter:"{value}%",fontSize:10},axisLine:{show:!0,lineStyle:{color:"#858585"}},splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:"rgba(255, 255, 255, 0.05)"}},axisTick:{alignWithLabel:!0,show:!0,length:5,lineStyle:{color:"#858585"}}},dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100,bottom:10,height:20},{type:"inside",xAxisIndex:[0,1],start:0,end:100}],series:[{type:"line",showSymbol:!1,data:N.simple_return_chart.y[0].data,lineStyle:{color:"#09c",width:1}}]};i.setOption(h),window.addEventListener("resize",T)},T=()=>{i==null||i.resize()},K=async()=>{if(!n.taskId)return;const N=await t.getFactorEarnings(n.taskId);console.log("查看单个因子收益数据:",N),N.data&&(r.value=N.data.one_group_data);const h=await t.getFactorEarningsChart(n.taskId);console.log("查看单个因子收益数据图标:",h),h.data&&(y.value=h.data,$())};return Ce(()=>n.taskId,async()=>{await K()}),We(async()=>{await K(),c=new ResizeObserver(()=>{i==null||i.resize()}),S.value&&c.observe(S.value.parentElement)}),mt(()=>{window.removeEventListener("resize",T),c&&(c.disconnect(),c=null),i==null||i.dispose(),i=null}),(N,h)=>(w(),x("div",Vo,[e("div",Go,[e("div",qo,[h[0]||(h[0]=e("span",{class:"label"},"分组盈亏",-1)),e("span",{class:"value",style:ve({color:a(r.value.return_ratio)})},A(r.value.return_ratio),5)]),e("div",Zo,[h[1]||(h[1]=e("span",{class:"label"},"夏普比率",-1)),e("span",{class:"value",style:ve({color:a(r.value.sharpe_ratio)})},A(r.value.sharpe_ratio),5)]),e("div",jo,[h[2]||(h[2]=e("span",{class:"label"},"年化收益",-1)),e("span",{class:"value",style:ve({color:a(r.value.annualized_ratio)})},A(r.value.annualized_ratio),5)]),e("div",Ko,[h[3]||(h[3]=e("span",{class:"label"},"最大回撤",-1)),e("span",Jo,A(r.value.maximum_drawdown),1)])]),e("div",{ref_key:"echartsRef",ref:S,class:"chart-container"},null,512)]))}},Yo=be(Uo,[["__scopeId","data-v-e3912ffc"]]),Xo={class:"table-container"},Qo={class:"table-wrapper"},es={key:0,class:"fixed-column"},ts={class:"scroll-area"},as={style:{display:"flex",position:"sticky",top:"0","z-index":"99",background:"#121212",width:"max-content"}},os=["title"],ss={__name:"TablesScroll",props:{tableData:{type:Array,required:!0},headers:{type:Array,required:!0},isFixed:{type:Boolean,default:!0},columnWidth:{type:[Number,String],default:0},customHeader:{type:Array,default:[]}},setup(d){Pt(c=>({"7a2b27e2":`${d.columnWidth}px`}));const t=d,n=l(null),r=l(null),a=c=>!isNaN(c)&&Number.isFinite(Number(c))&&String(c).includes(".")?Number(c).toFixed(2):c,S=c=>c?c.replace(/(\d{4})(\d{2})(\d{2})/g,"$1-$2-$3"):"-",i=()=>{n.value&&r.value&&t.isFixed&&(console.log("-------------"),n.value.addEventListener("scroll",()=>{console.log(n.value.scrollTop),r.value.style.top=`-${n.value.scrollTop}px`}))};return We(()=>{i()}),(c,y)=>(w(),x("div",Xo,[e("div",Qo,[t.isFixed?(w(),x("div",es,[e("div",{class:"fixed-header",style:ve({width:`${d.customHeader.length>0?d.customHeader[0].width:d.columnWidth}px`})},A(d.customHeader.length>0?d.customHeader[0].key:t.headers[0]),5),e("div",{class:"fixed-body",ref_key:"fixedBody",ref:r},[(w(!0),x(me,null,Se(t.tableData,($,T)=>(w(),x("div",{key:T,class:"fixed-cell",style:ve({width:`${d.customHeader.length>0?d.customHeader[0].width:d.columnWidth}px`})},A(S($[t.headers[0]])),5))),128))],512)])):ce("",!0),e("div",ts,[e("div",{class:"scroll-body",ref_key:"scrollBody",ref:n},[e("div",as,[(w(!0),x(me,null,Se([...t.headers].splice(t.isFixed?1:0),($,T)=>(w(),x("div",{key:T,class:"header-cell",style:ve({width:`${d.customHeader.length>0?d.customHeader[T+1].width:d.columnWidth}px`}),title:$},A(d.customHeader.length>0?d.customHeader[T+1].key:$),13,os))),128))]),(w(!0),x(me,null,Se(t.tableData,($,T)=>(w(),x("div",{key:T,class:"table-row"},[(w(!0),x(me,null,Se([...t.headers].splice(t.isFixed?1:0),(K,N)=>(w(),x("div",{key:N,class:"table-cell",style:ve({width:`${d.customHeader.length>0?d.customHeader[N+1].width:d.columnWidth}px`})},A(a($[K])),5))),128))]))),128))],512)])])]))}},It=be(ss,[["__scopeId","data-v-9a0230d5"]]),ls={class:"factor-deep"},ns={class:"factor-deep-header"},is={class:"factor-item"},rs={class:"factor-item-title"},cs={class:"factor-item-content"},us={style:{display:"flex","justify-content":"space-between"}},ds={class:"factor-deep-content",style:{"flex-shrink":"1","flex-grow":"1","flex-basis":"368px","margin-top":"20px"}},hs={class:"data-card",style:{height:"100%"}},fs={class:"data-item"},ps={class:"data-item"},vs={class:"data-item"},ms={class:"data-item"},ys={class:"value"},gs={key:0,class:"value"},_s={key:1,class:"label"},bs={class:"factor-item",style:{margin:"0","margin-top":"20px",width:"auto","flex-shrink":"0","flex-grow":"1","flex-basis":"460px","margin-left":"20px"}},ws={class:"factor-item-title"},xs={class:"factor-item-content"},ks={style:{width:"100%",height:"400%"}},Cs={class:"factor-item",style:{"margin-left":"20px"}},Ls={class:"factor-item-title"},Ss={class:"factor-item-content"},$s={style:{width:"100%",height:"400px"}},Ds={class:"factor-item-container"},As={class:"factor-item"},Ts={class:"factor-item-title"},Is={class:"factor-item-content"},Fs={class:"factor-item"},Ns={class:"factor-item-title"},Rs={class:"factor-item-content"},Ms={class:"factor-item"},Es={class:"factor-item-title"},Ps={class:"factor-item-content"},zs={class:"factor-item"},Os={class:"factor-item-title"},Bs={class:"factor-item-content"},Ws={class:"factor-item"},Hs={class:"factor-item-title"},Vs={class:"factor-item-content"},Gs={class:"factor-item"},qs={class:"factor-item-title"},Zs={class:"factor-item-content"},js={class:"factor-item"},Ks={class:"factor-item-title"},Js={class:"factor-item-content"},Us={class:"factor-item"},Ys={class:"factor-item-title"},Xs={class:"factor-item-content"},Qs={class:"factor-item"},el={class:"factor-item-title"},tl={class:"factor-item-content"},al={class:"factor-item"},ol={class:"factor-item-title"},sl={class:"factor-item-content"},ue="#7d7d7d",ll=$e({__name:"bb",props:{factorId:{type:String,required:!0},taskId:{type:String,requfactorIdired:!0},into:{type:Boolean,required:!0,default:!1}},setup(d){const t=o=>"",n=o=>o,r=o=>!isNaN(o)&&Number.isFinite(Number(o))&&String(o).includes(".")?Number(o).toFixed(2):o,a=d;Et();const S=l(!1),i=o=>{const ne=parseFloat(o);return ne>0?"#ff4851":ne<0?"#2fae34":"#333"},c=l({annualized_ratio:0,maximum_drawdown:0,return_ratio:0,sharpe_ratio:0}),y=async()=>{var z,O,W,B,G,q,Z,j;const{json:o,httpController:ne}=await ca(a.taskId||t());c.value={annualized_ratio:n((O=(z=o==null?void 0:o.data)==null?void 0:z.one_group_data)==null?void 0:O.annualized_ratio),maximum_drawdown:n((B=(W=o==null?void 0:o.data)==null?void 0:W.one_group_data)==null?void 0:B.maximum_drawdown),return_ratio:n((q=(G=o==null?void 0:o.data)==null?void 0:G.one_group_data)==null?void 0:q.return_ratio),sharpe_ratio:n((j=(Z=o==null?void 0:o.data)==null?void 0:Z.one_group_data)==null?void 0:j.sharpe_ratio)}};let $=null;const T=l(null),K=l(""),N=l({}),h=async()=>{var O,W,B,G,q,Z,j,ee,Y,V,I,D,k,v,f,u;const{json:o,httpController:ne}=await ua((a==null?void 0:a.taskId)||t());if(o.code==="200"&&(K.value=(W=(O=o==null?void 0:o.data)==null?void 0:O.return_chart)==null?void 0:W.title,N.value=(B=o==null?void 0:o.data)==null?void 0:B.return_chart,T.value)){if($=Le(T.value),Object.keys(N.value).length==0)return;var z={code:"200",message:"查询成功",data:{task_id:"bbf3bbc030a94849bea4810058eec027",return_chart:{title:"python 5 groups return",x:[{name:"date",data:(q=(G=N.value)==null?void 0:G.x[0])==null?void 0:q.data}],y:(Z=N.value)==null?void 0:Z.y}}};const m=(V=(Y=(ee=(j=z==null?void 0:z.data)==null?void 0:j.return_chart)==null?void 0:ee.x[0])==null?void 0:Y.data)==null?void 0:V.map(P=>P.split(" ")[0]),M=(k=(D=(I=z==null?void 0:z.data)==null?void 0:I.return_chart)==null?void 0:D.y)==null?void 0:k.map(P=>P.name),L=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFCC5C","#FF6F69","#88D8B0","#6C88C4","#FFA07A","#98FB98","#87CEEB","#DDA0DD"].sort(()=>Math.random()-.5),te=(u=(f=(v=z==null?void 0:z.data)==null?void 0:v.return_chart)==null?void 0:f.y)==null?void 0:u.map((P,Q)=>{var _e;return(_e=P==null?void 0:P.data)==null?void 0:_e.map((qe,Ze)=>({value:[Ze,Q,Number(qe).toFixed(2)],itemStyle:{color:L[Q%L.length]}}))}).flat(),X={title:{left:"center"},tooltip:{show:!1,axisPointer:{show:!1}},grid3D:{viewControl:{projection:"orthographic",autoRotate:!0,distance:200,beta:45,alpha:25},boxWidth:70,boxHeight:70,boxDepth:200,light:{main:{intensity:1.2}},top:"0%",bottom:"10%"},xAxis3D:{type:"category",data:m==null?void 0:m.map(P=>P.split(" ")[0]),name:"",axisLabel:{interval:Math.floor((m==null?void 0:m.length)/10),rotate:45,margin:20,textStyle:{fontSize:10,color:ue}},nameTextStyle:{fontSize:14,margin:30}},yAxis3D:{type:"category",data:M,name:"",axisLabel:{color:ue}},zAxis3D:{type:"value",name:"",axisLabel:{color:ue}},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100},{type:"inside",xAxisIndex:0,start:0,end:100}],series:[{type:"bar3D",data:te,shading:"lambert",label:{show:!1}}]};$.setOption(X)}},g=l("分组收益"),oe=l([]),H=l({}),ae=async()=>{var z,O;const{json:o,httpController:ne}=await da((a==null?void 0:a.taskId)||t());o.code==="200"&&(H.value=(z=o==null?void 0:o.data)==null?void 0:z.group_return_analysis,oe.value=Object.keys((O=o==null?void 0:o.data)==null?void 0:O.group_return_analysis[0]))},ye=l("最新数据"),de=l([]),J=l({}),De=l([{key:"时间",width:130},{key:"股票代码",width:100},{key:"名称",width:100},{key:"因子值",width:80}]),R=async()=>{var z,O;const{json:o,httpController:ne}=await ha((a==null?void 0:a.taskId)||t());o.code==="200"&&(J.value=(z=o==null?void 0:o.data)==null?void 0:z.last_date_top_factor,de.value=Object.keys((O=o==null?void 0:o.data)==null?void 0:O.last_date_top_factor[0]))};let E=null;const re=l(null),se=l(""),_=l({}),p=async()=>{var O,W,B,G,q,Z,j,ee;const{json:o,httpController:ne}=await fa((a==null?void 0:a.taskId)||t());if(o.code==="200"&&(se.value=(W=(O=o==null?void 0:o.data)==null?void 0:O.ic_decay_chart)==null?void 0:W.title,_.value=(B=o==null?void 0:o.data)==null?void 0:B.ic_decay_chart,re.value)){if(E=Le(re.value),Object.keys(_.value).length==0)return;const Y=(q=(G=_.value)==null?void 0:G.x[0])==null?void 0:q.data,V=(ee=(j=(Z=_.value)==null?void 0:Z.y[0])==null?void 0:j.data)==null?void 0:ee.map((I,D)=>({value:I,itemStyle:{color:I>0?"#ff0000":"#3498db"}}));var z={title:{},tooltip:{trigger:"axis",formatter:function(I){return I.map(D=>{let k=D.value;const v=D.color;if(Array.isArray(k)){const f=k.map(u=>u==null||isNaN(u)?"--":Number(u).toFixed(4));return`<span style="color:${v}">${D.seriesName}</span>: ${f[0]}, ${f[1]}`}return k=k==null||isNaN(k)?"--":Number(k).toFixed(4),`<span style="color:${v}">${D.seriesName}</span>: ${k}`}).join("<br/>")}},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100}],xAxis:[{type:"category",data:Y,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(I,D){const k=Y.length,v=40,f=E.getWidth(),u=Math.floor(f/v),m=Math.floor((k-1)/(u-1));return(k-1-I)%m===0}},show:!1},{type:"category",data:Y,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(I,D){const k=Y.length,v=40,f=E.getWidth(),u=Math.floor(f/v),m=Math.floor((k-1)/(u-1));return(k-1-I)%m===0}},position:"bottom"}],yAxis:[{type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",color:ue}}}],series:[{name:"IC值",type:"bar",data:V,label:{show:!1,position:"bottom",formatter:function(I){return I.value?I.value.toFixed(2):""}}},{name:"IC趋势",type:"line",smooth:!1,showSymbol:!1,data:_.value.y[0].data,lineStyle:{color:"#ff0000",width:0}}]};E.setOption(z)}};let s=null;const C=l(null),F=l(""),le=l({}),he=async()=>{var O,W,B,G,q,Z,j,ee,Y;const{json:o,httpController:ne}=await pa((a==null?void 0:a.taskId)||t());if(o.code==="200"&&(console.log("json",o),F.value=(W=(O=o==null?void 0:o.data)==null?void 0:O.ic_den_chart)==null?void 0:W.title,le.value=(B=o==null?void 0:o.data)==null?void 0:B.ic_den_chart,C.value)){if(s=Le(C.value),Object.keys(le.value).length==0)return;var z={title:{},tooltip:{trigger:"axis",formatter:function(V){return V.map(I=>{let D=I.value;const k=I.color;if(Array.isArray(D)){const v=D.map(f=>f==null||isNaN(f)?"--":Number(f).toFixed(4));return`<span style="color:${k}">${I.seriesName}</span>: ${v[0]}, ${v[1]}`}return D=D==null||isNaN(D)?"--":Number(D).toFixed(4),`<span style="color:${k}">${I.seriesName}</span>: ${D}`}).join("<br/>")}},legend:{data:["Histogram","Density Curve"],top:"0px",textStyle:{color:ue}},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100},{type:"inside",xAxisIndex:0,start:0}],xAxis:{type:"value",boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!0,lineStyle:{type:"dashed",color:ue}}},yAxis:{type:"value",axisLine:{onZero:!1,show:!1},axisTick:{show:!1},position:"left",splitLine:{show:!0,lineStyle:{type:"dashed",color:ue}}},series:[{name:"Histogram",type:"bar",data:(Z=(q=(G=le.value)==null?void 0:G.y[0])==null?void 0:q.data)==null?void 0:Z.map((V,I)=>{var D,k;return[(k=(D=le.value)==null?void 0:D.x[0])==null?void 0:k.data[I],V]}),itemStyle:{color:"rgba(135, 206, 235, 0.6)"}},{name:"Density Curve",type:"line",smooth:!0,data:(Y=(ee=(j=le.value)==null?void 0:j.y[1])==null?void 0:ee.data)==null?void 0:Y.map((V,I)=>{var D,k;return[(k=(D=le.value)==null?void 0:D.x[0])==null?void 0:k.data[I],V]}),itemStyle:{color:"#1E90FF"},lineStyle:{width:2}}]};s.setOption(z)}};let we=null;const He=l(null),at=l(""),xe=l({}),Ee=async()=>{var O,W,B,G,q,Z,j,ee,Y,V,I,D,k;const{json:o,httpController:ne}=await va((a==null?void 0:a.taskId)||t());if(o.code==="200"&&(at.value=(W=(O=o==null?void 0:o.data)==null?void 0:O.ic_seq_chart)==null?void 0:W.title,xe.value=(B=o==null?void 0:o.data)==null?void 0:B.ic_seq_chart,console.log("echartsRefICSequenceData",xe.value),He.value)){if(we=Le(He.value),Object.keys(xe.value).length==0)return;var z={title:{left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(v){return v.map(f=>{let u=f.value;const m=f.color;if(Array.isArray(u)){const M=u.map(L=>L==null||isNaN(L)?"--":Number(L).toFixed(4));return`<span style="color:${m}">${f.seriesName}</span>: ${M[0]}, ${M[1]}`}return u=u==null||isNaN(u)?"--":Number(u).toFixed(4),`<span style="color:${m}">${f.seriesName}</span>: ${u}`}).join("<br/>")}},legend:{data:(q=(G=xe.value)==null?void 0:G.y)==null?void 0:q.map(v=>v.name),top:"0px",selected:{IC:!0,Cum_IC:!1},textStyle:{color:ue}},grid:{left:"3%",right:"4%",bottom:"2%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100}],xAxis:[{type:"category",data:(ee=(j=(Z=xe.value)==null?void 0:Z.x[0])==null?void 0:j.data)==null?void 0:ee.map(v=>v.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(v,f){var X,P,Q;const u=(Q=(P=(X=xe.value)==null?void 0:X.x[0])==null?void 0:P.data)==null?void 0:Q.length,m=40,M=we.getWidth(),L=Math.floor(M/m),te=Math.floor((u-1)/(L-1));return(u-1-v)%te===0}},show:!1},{type:"category",data:(I=(V=(Y=xe.value)==null?void 0:Y.x[0])==null?void 0:V.data)==null?void 0:I.map(v=>v.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(v,f){var X,P,Q;const u=(Q=(P=(X=xe.value)==null?void 0:X.x[0])==null?void 0:P.data)==null?void 0:Q.length,m=40,M=we.getWidth(),L=Math.floor(M/m),te=Math.floor((u-1)/(L-1));return(u-1-v)%te===0}},position:"bottom"}],yAxis:{type:"value",axisLabel:{interval:1e3},splitLine:{show:!0,lineStyle:{type:"dashed",color:ue}}},series:(k=(D=xe.value)==null?void 0:D.y)==null?void 0:k.map(v=>({name:v.name,data:v.data,type:v.name==="IC"?"bar":"line",itemStyle:{color:v.name==="IC"?"#3498db":"#e74c3c"},label:{show:!1,position:"top",formatter:function(f){return f.data.toFixed(3)}}}))};we.setOption(z)}};let b=null;const U=l(null),fe=l(""),ke=l({}),Ve=async()=>{var O,W,B,G,q,Z,j,ee,Y,V,I,D,k;const{json:o,httpController:ne}=await ma((a==null?void 0:a.taskId)||t());if(o.code==="200"&&(fe.value=(W=(O=o==null?void 0:o.data)==null?void 0:O.ic_self_correlation_chart)==null?void 0:W.title,ke.value=(B=o==null?void 0:o.data)==null?void 0:B.ic_self_correlation_chart,U.value)){if(b=Le(U.value),Object.keys(ke.value).length==0)return;var z={title:{},tooltip:{trigger:"axis",formatter:function(v){return v.map(f=>{let u=f.value;const m=f.color;if(Array.isArray(u)){const M=u.map(L=>L==null||isNaN(L)?"--":Number(L).toFixed(4));return`<span style="color:${m}">${f.seriesName}</span>: ${M[0]}, ${M[1]}`}return u=u==null||isNaN(u)?"--":Number(u).toFixed(4),`<span style="color:${m}">${f.seriesName}</span>: ${u}`}).join("<br/>")}},legend:{data:["自相关系数","下限(95%置信区间)","上限(95%置信区间)"],top:"0px",textStyle:{color:ue}},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100}],xAxis:[{type:"category",data:(q=(G=ke.value)==null?void 0:G.x[0])==null?void 0:q.data,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(v,f){var X,P,Q;const u=(Q=(P=(X=ke.value)==null?void 0:X.x[0])==null?void 0:P.data)==null?void 0:Q.length,m=40,M=b.getWidth(),L=Math.floor(M/m),te=Math.floor((u-1)/(L-1));return(u-1-v)%te===0}},show:!1},{type:"category",data:(j=(Z=ke.value)==null?void 0:Z.x[0])==null?void 0:j.data,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(v,f){var X,P,Q;const u=(Q=(P=(X=ke.value)==null?void 0:X.x[0])==null?void 0:P.data)==null?void 0:Q.length,m=40,M=b.getWidth(),L=Math.floor(M/m),te=Math.floor((u-1)/(L-1));return(u-1-v)%te===0}},position:"bottom"}],yAxis:{type:"value",min:-1,max:1,interval:.2,splitLine:{show:!0,lineStyle:{type:"dashed",color:ue}}},series:[{name:"自相关系数",type:"line",data:(Y=(ee=ke.value)==null?void 0:ee.y[0])==null?void 0:Y.data,symbol:"circle",symbolSize:8,lineStyle:{width:2},itemStyle:{color:"#3498db"},label:{show:!1,position:"top",formatter:function(v){return v.value.toFixed(3)}}},{name:"下限(95%置信区间)",type:"line",data:(I=(V=ke.value)==null?void 0:V.y[1])==null?void 0:I.data,lineStyle:{type:"dashed",width:1},itemStyle:{color:"#95a5a6"},symbol:"none"},{name:"上限(95%置信区间)",type:"line",data:(k=(D=ke.value)==null?void 0:D.y[2])==null?void 0:k.data,lineStyle:{type:"dashed",width:1},itemStyle:{color:"#95a5a6"},symbol:"none"}]};b.setOption(z)}};let Ae=null;const ot=l(null),_t=l(""),Ye=l({}),st=async()=>{var O,W,B,G,q,Z,j,ee,Y,V;const{json:o,httpController:ne}=await ya((a==null?void 0:a.taskId)||t());if(o.code==="200"&&(_t.value=(W=(O=o==null?void 0:o.data)==null?void 0:O.rank_ic_decay_chart)==null?void 0:W.title,Ye.value=(B=o==null?void 0:o.data)==null?void 0:B.rank_ic_decay_chart,ot.value)){if(Ae=Le(ot.value),Object.keys(Ye.value).length==0)return;const I=(q=(G=Ye.value)==null?void 0:G.x[0])==null?void 0:q.data,D=(ee=(j=(Z=Ye.value)==null?void 0:Z.y[0])==null?void 0:j.data)==null?void 0:ee.map((k,v)=>({value:k,itemStyle:{color:k>0?"#ff0000":"#3498db"}}));var z={title:{},tooltip:{trigger:"axis",formatter:function(k){return k.map(v=>{let f=v.value;const u=v.color;if(Array.isArray(f)){const m=f.map(M=>M==null||isNaN(M)?"--":Number(M).toFixed(4));return`<span style="color:${u}">${v.seriesName}</span>: ${m[0]}, ${m[1]}`}return f=f==null||isNaN(f)?"--":Number(f).toFixed(4),`<span style="color:${u}">${v.seriesName}</span>: ${f}`}).join("<br/>")}},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100}],xAxis:[{type:"category",data:I,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(k,v){const f=I.length,u=40,m=Ae.getWidth(),M=Math.floor(m/u),L=Math.floor((f-1)/(M-1));return(f-1-k)%L===0}},show:!1},{type:"category",data:I,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(k,v){const f=I.length,u=40,m=Ae.getWidth(),M=Math.floor(m/u),L=Math.floor((f-1)/(M-1));return(f-1-k)%L===0}},position:"bottom"}],yAxis:[{type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",color:ue}}}],series:[{name:"IC值",type:"bar",data:D,label:{show:!1,position:"bottom",formatter:function(k){return k.value?k.value.toFixed(3):""}}},{name:"IC趋势",type:"line",smooth:!1,showSymbol:!1,data:(V=(Y=Ye.value)==null?void 0:Y.y[0])==null?void 0:V.data,lineStyle:{color:"#000000",width:0}}]};Ae.setOption(z)}};let Pe=null;const lt=l(null),bt=l(""),Ue=l({}),nt=async()=>{var O,W,B,G,q,Z,j,ee,Y;const{json:o,httpController:ne}=await ga((a==null?void 0:a.taskId)||t());if(o.code==="200"&&(bt.value=(W=(O=o==null?void 0:o.data)==null?void 0:O.rank_ic_den_chart)==null?void 0:W.title,Ue.value=(B=o==null?void 0:o.data)==null?void 0:B.rank_ic_den_chart,lt.value)){if(Pe=Le(lt.value),Object.keys(Ue.value).length==0)return;var z={title:{},tooltip:{trigger:"axis",formatter:function(V){return V.map(I=>{let D=I.value;const k=I.color;if(Array.isArray(D)){const v=D.map(f=>f==null||isNaN(f)?"--":Number(f).toFixed(4));return`<span style="color:${k}">${I.seriesName}</span>: ${v[0]}, ${v[1]}`}return D=D==null||isNaN(D)?"--":Number(D).toFixed(4),`<span style="color:${k}">${I.seriesName}</span>: ${D}`}).join("<br/>")}},legend:{data:["Histogram","Density Curve"],top:"0px",textStyle:{color:ue}},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100},{type:"inside",xAxisIndex:0,zoomOnMouseWheel:!1,start:0}],xAxis:{type:"value",boundaryGap:!1,axisLine:{onZero:!1},axisLabel:{formatter:"{value}"},splitLine:{show:!0,lineStyle:{type:"dashed",color:ue}}},yAxis:{type:"value",axisLine:{onZero:!1,show:!1},axisTick:{show:!1},position:"left",splitLine:{show:!0,lineStyle:{type:"dashed",color:ue}}},series:[{name:"Histogram",type:"bar",data:(Z=(q=(G=Ue.value)==null?void 0:G.y[0])==null?void 0:q.data)==null?void 0:Z.map((V,I)=>{var D,k;return[(k=(D=Ue.value)==null?void 0:D.x[0])==null?void 0:k.data[I],V]}),itemStyle:{color:"rgba(135, 206, 235, 0.6)"}},{name:"Density Curve",type:"line",smooth:!0,data:(Y=(ee=(j=Ue.value)==null?void 0:j.y[1])==null?void 0:ee.data)==null?void 0:Y.map((V,I)=>{var D,k;return[(k=(D=Ue.value)==null?void 0:D.x[0])==null?void 0:k.data[I],V]}),itemStyle:{color:"#1E90FF"},lineStyle:{width:2}}]};Pe.setOption(z)}};let Te=null;const it=l(null),wt=l(""),ze=l({}),rt=async()=>{var O,W,B,G,q,Z,j,ee,Y,V,I,D,k;const{json:o,httpController:ne}=await _a(a.taskId||t());if(o.code==="200"&&(wt.value=(W=(O=o==null?void 0:o.data)==null?void 0:O.rank_ic_seq_chart)==null?void 0:W.title,ze.value=(B=o==null?void 0:o.data)==null?void 0:B.rank_ic_seq_chart,it.value)){if(Te=Le(it.value),Object.keys(ze.value).length==0)return;var z={title:{left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(v){return v.map(f=>{let u=f.value;const m=f.color;if(Array.isArray(u)){const M=u.map(L=>L==null||isNaN(L)?"--":Number(L).toFixed(4));return`<span style="color:${m}">${f.seriesName}</span>: ${M[0]}, ${M[1]}`}return u=u==null||isNaN(u)?"--":Number(u).toFixed(4),`<span style="color:${m}">${f.seriesName}</span>: ${u}`}).join("<br/>")}},legend:{data:(q=(G=ze.value)==null?void 0:G.y)==null?void 0:q.map(v=>v.name),top:"0px",selected:{IC:!0,Cum_IC:!1},textStyle:{color:ue}},grid:{left:"3%",right:"4%",bottom:"1%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100}],xAxis:[{type:"category",data:(ee=(j=(Z=ze.value)==null?void 0:Z.x[0])==null?void 0:j.data)==null?void 0:ee.map(v=>v.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(v,f){var X,P,Q;const u=(Q=(P=(X=ze.value)==null?void 0:X.x[0])==null?void 0:P.data)==null?void 0:Q.length,m=40,M=Te.getWidth(),L=Math.floor(M/m),te=Math.floor((u-1)/(L-1));return(u-1-v)%te===0}},show:!1},{type:"category",data:(I=(V=(Y=ze.value)==null?void 0:Y.x[0])==null?void 0:V.data)==null?void 0:I.map(v=>v.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(v,f){var X,P,Q;const u=(Q=(P=(X=ze.value)==null?void 0:X.x[0])==null?void 0:P.data)==null?void 0:Q.length,m=40,M=Te.getWidth(),L=Math.floor(M/m),te=Math.floor((u-1)/(L-1));return(u-1-v)%te===0}},position:"bottom"}],yAxis:{type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",color:ue}}},series:(k=(D=ze.value)==null?void 0:D.y)==null?void 0:k.map(v=>({name:v.name,data:v.data,type:v.name==="Rank_IC"?"bar":"line",itemStyle:{color:v.name==="IC"?"#3498db":"#e74c3c"},showSymbol:!1,label:{show:!1,position:"top",formatter:function(f){return f.data.toFixed(3)}}}))};Te.setOption(z)}};let Ie=null;const ct=l(null),xt=l(""),Re=l({}),ut=async()=>{var O,W,B,G,q,Z,j,ee,Y,V,I,D,k;const{json:o,httpController:ne}=await ba((a==null?void 0:a.taskId)||t());if(o.code==="200"&&(xt.value=(W=(O=o==null?void 0:o.data)==null?void 0:O.rank_ic_self_correlation_chart)==null?void 0:W.title,Re.value=(B=o==null?void 0:o.data)==null?void 0:B.rank_ic_self_correlation_chart,ct.value)){if(Ie=Le(ct.value),Object.keys(Re.value).length==0)return;var z={title:{},tooltip:{trigger:"axis",formatter:function(v){return v.map(f=>{let u=f.value;const m=f.color;if(Array.isArray(u)){const M=u.map(L=>L==null||isNaN(L)?"--":Number(L).toFixed(4));return`<span style="color:${m}">${f.seriesName}</span>: ${M[0]}, ${M[1]}`}return u=u==null||isNaN(u)?"--":Number(u).toFixed(4),`<span style="color:${m}">${f.seriesName}</span>: ${u}`}).join("<br/>")}},legend:{data:["自相关系数","下限(95%置信区间)","上限(95%置信区间)"],top:"0px",textStyle:{color:ue}},grid:{left:"3%",right:"4%",bottom:"10%",top:"10%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100}],xAxis:[{type:"category",data:(q=(G=Re.value)==null?void 0:G.x[0])==null?void 0:q.data,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(v,f){var X,P,Q;const u=(Q=(P=(X=Re.value)==null?void 0:X.x[0])==null?void 0:P.data)==null?void 0:Q.length,m=40,M=Ie.getWidth(),L=Math.floor(M/m),te=Math.floor((u-1)/(L-1));return(u-1-v)%te===0}},show:!1},{type:"category",data:(j=(Z=Re.value)==null?void 0:Z.x[0])==null?void 0:j.data,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(v,f){var X,P,Q;const u=(Q=(P=(X=Re.value)==null?void 0:X.x[0])==null?void 0:P.data)==null?void 0:Q.length,m=40,M=Ie.getWidth(),L=Math.floor(M/m),te=Math.floor((u-1)/(L-1));return(u-1-v)%te===0}},position:"bottom"}],yAxis:{type:"value",min:-1,max:1,interval:.2,splitLine:{show:!0,lineStyle:{type:"dashed",color:ue}}},series:[{name:"自相关系数",type:"line",data:(Y=(ee=Re.value)==null?void 0:ee.y[0])==null?void 0:Y.data,symbol:"circle",symbolSize:8,lineStyle:{width:2},itemStyle:{color:"#3498db"},label:{show:!1,position:"top",formatter:function(v){return v.value.toFixed(3)}}},{name:"下限(95%置信区间)",type:"line",data:(I=(V=Re.value)==null?void 0:V.y[1])==null?void 0:I.data,lineStyle:{type:"dashed",width:1},itemStyle:{color:"#95a5a6"},symbol:"none"},{name:"上限(95%置信区间)",type:"line",data:(k=(D=Re.value)==null?void 0:D.y[2])==null?void 0:k.data,lineStyle:{type:"dashed",width:1},itemStyle:{color:"#95a5a6"},symbol:"none"}]};Ie.setOption(z)}};let Fe=null;const dt=l(null),kt=l(""),Oe=l({}),ht=async()=>{var z,O,W,B,G,q,Z,j,ee,Y,V,I,D,k,v,f;const{json:o,httpController:ne}=await wa((a==null?void 0:a.taskId)||t());if(o.code==="200"&&((W=(O=(z=o==null?void 0:o.data)==null?void 0:z.return_chart)==null?void 0:O.y)==null||W.forEach(u=>{u.data=u.data.map(m=>r(m*100))}),kt.value=(G=(B=o==null?void 0:o.data)==null?void 0:B.return_chart)==null?void 0:G.title,Oe.value=(q=o==null?void 0:o.data)==null?void 0:q.return_chart,dt.value)){if(Fe=Le(dt.value),Object.keys(Oe.value).length==0)return;const u={title:{},tooltip:{trigger:"axis",formatter:function(m){return m.map(M=>{let L=M.value;const te=M.color;if(Array.isArray(L)){const X=L.map(P=>P==null||isNaN(P)?"--":Number(P).toFixed(4));return`<span style="color:${te}">${M.seriesName}</span>: ${X[0]}, ${X[1]}`}return L=L==null||isNaN(L)?"--":Number(L).toFixed(4),`<span style="color:${te}">${M.seriesName}</span>: ${L}%`}).join("<br/>")}},legend:{data:(j=(Z=Oe.value)==null?void 0:Z.y)==null?void 0:j.map(m=>m.name),textStyle:{color:ue}},xAxis:[{type:"category",data:(V=(Y=(ee=Oe.value)==null?void 0:ee.x[0])==null?void 0:Y.data)==null?void 0:V.map(m=>$t(m)),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(m,M){var _e,qe,Ze;const L=(Ze=(qe=(_e=Oe.value)==null?void 0:_e.x[0])==null?void 0:qe.data)==null?void 0:Ze.length,te=60,X=Fe.getWidth(),P=Math.floor(X/te),Q=Math.floor((L-1)/(P-1));return(L-1-m)%Q===0}},show:!1},{type:"category",data:(k=(D=(I=Oe.value)==null?void 0:I.x[0])==null?void 0:D.data)==null?void 0:k.map(m=>$t(m)),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(m,M){var _e,qe,Ze;const L=(Ze=(qe=(_e=Oe.value)==null?void 0:_e.x[0])==null?void 0:qe.data)==null?void 0:Ze.length,te=60,X=Fe.getWidth(),P=Math.floor(X/te),Q=Math.floor((L-1)/(P-1));return(L-1-m)%Q===0}},position:"bottom"}],yAxis:{type:"value",axisLabel:{formatter:"{value}%"},splitLine:{show:!0,lineStyle:{type:"dashed",color:ue}}},grid:{left:"3%",right:"4%",bottom:"0%",top:"10%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100}],series:(f=(v=Oe.value)==null?void 0:v.y)==null?void 0:f.map(m=>({name:m.name,type:"line",data:m.data,showSymbol:!1}))};Fe.setOption(u)}};let Ne=null;const ft=l(null),Ct=l(""),Be=l({}),pt=async()=>{var O,W,B,G,q,Z,j,ee,Y,V,I,D,k;const{json:o,httpController:ne}=await xa((a==null?void 0:a.taskId)||t());if(o.code==="200"&&(Ct.value=(W=(O=o==null?void 0:o.data)==null?void 0:O.excess_chart)==null?void 0:W.title,Be.value=(B=o==null?void 0:o.data)==null?void 0:B.excess_chart,ft.value)){if(Ne=Le(ft.value),Object.keys(Be.value).length==0)return;const v=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#0099cc","#ff00ff"];var z={title:{},tooltip:{trigger:"axis",formatter:function(f){return f.map(u=>{let m=u.value;const M=u.color;if(Array.isArray(m)){const L=m.map(te=>te==null||isNaN(te)?"--":Number(te).toFixed(4));return`<span style="color:${M}">${u.seriesName}</span>: ${L[0]}, ${L[1]}`}return m=m==null||isNaN(m)?"--":Number(m).toFixed(4),`<span style="color:${M}">${u.seriesName}</span>: ${m}`}).join("<br/>")}},legend:{data:(q=(G=Be.value)==null?void 0:G.y)==null?void 0:q.map(f=>f.name),top:"0px",textStyle:{color:ue,fontSize:10}},grid:{left:"3%",right:"4%",bottom:"0%",top:"10%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100}],xAxis:[{type:"category",data:(ee=(j=(Z=Be.value)==null?void 0:Z.x[0])==null?void 0:j.data)==null?void 0:ee.map(f=>f.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(f,u){var P,Q,_e;const m=(_e=(Q=(P=Be.value)==null?void 0:P.x[0])==null?void 0:Q.data)==null?void 0:_e.length,M=40,L=Ne.getWidth(),te=Math.floor(L/M),X=Math.floor((m-1)/(te-1));return(m-1-f)%X===0}},show:!1},{type:"category",data:(I=(V=(Y=Be.value)==null?void 0:Y.x[0])==null?void 0:V.data)==null?void 0:I.map(f=>f.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(f,u){var P,Q,_e;const m=(_e=(Q=(P=Be.value)==null?void 0:P.x[0])==null?void 0:Q.data)==null?void 0:_e.length,M=40,L=Ne.getWidth(),te=Math.floor(L/M),X=Math.floor((m-1)/(te-1));return(m-1-f)%X===0}},position:"bottom"}],yAxis:{type:"value",axisLabel:{formatter:f=>(f*100).toFixed(1)+"%"}},series:(k=(D=Be.value)==null?void 0:D.y)==null?void 0:k.map((f,u)=>({name:f.name,type:"line",data:f.data,symbol:"circle",symbolSize:6,showSymbol:!1,lineStyle:{width:(f.name.includes("多空组合"),1)},itemStyle:{color:v[u]}}))};Ne.setOption(z)}};Ce(()=>a.factorId,async()=>{a.into&&(console.log("加载mc3"),await vt(),await y(),await ae(),await R(),await h(),await p(),await he(),await Ee(),await Ve(),await st(),await nt(),await rt(),await ut(),await ht(),await pt(),await Me(),Ge())}),Ce(()=>a.taskId,async()=>{a.into&&(console.log("加载mc2"),await Me(),Ge(),await vt(),await y(),await Me(),await ae(),await R(),await h(),await p(),await he(),await Ee(),await Ve(),await st(),await nt(),await rt(),await ut(),await ht(),await pt(),await Me(),setTimeout(()=>{Ge()},1200))}),Ce(()=>a.into,async()=>{a.into&&(console.log("加载mc1"),await vt(),await y(),await ae(),await R(),await h(),await p(),await he(),await Ee(),await Ve(),await st(),await nt(),await rt(),await ut(),await ht(),await pt(),await Me(),Ge())}),Ce(()=>a.into,async()=>{await Me(),Ge()});const Ge=()=>{$==null||$.resize(),E==null||E.resize(),s==null||s.resize(),we==null||we.resize(),b==null||b.resize(),Ae==null||Ae.resize(),Pe==null||Pe.resize(),Te==null||Te.resize(),Ie==null||Ie.resize(),Fe==null||Fe.resize(),Ne==null||Ne.resize()};let Xe=null;We(async()=>{var o,ne,z,O,W,B,G,q,Z,j,ee;try{a.into&&(await vt(),await y(),await ae(),await R(),await h(),await p(),await he(),await Ee(),await Ve(),await st(),await nt(),await rt(),await ut(),await ht(),await pt(),St.value=!1,await Me(),Xe=new ResizeObserver(()=>{Ge()}),[(o=T.value)==null?void 0:o.parentElement,(ne=re.value)==null?void 0:ne.parentElement,(z=C.value)==null?void 0:z.parentElement,(O=He.value)==null?void 0:O.parentElement,(W=U.value)==null?void 0:W.parentElement,(B=ot.value)==null?void 0:B.parentElement,(G=lt.value)==null?void 0:G.parentElement,(q=it.value)==null?void 0:q.parentElement,(Z=ct.value)==null?void 0:Z.parentElement,(j=dt.value)==null?void 0:j.parentElement,(ee=ft.value)==null?void 0:ee.parentElement].forEach(V=>{V&&Xe.observe(V)}),Ge())}catch{S.value,St.value=!0}}),mt(()=>{Xe&&(Xe.disconnect(),Xe=null),qt()});const qt=()=>{$==null||$.dispose(),E==null||E.dispose(),s==null||s.dispose(),we==null||we.dispose(),b==null||b.dispose(),Ae==null||Ae.dispose(),Pe==null||Pe.dispose(),Te==null||Te.dispose(),Ie==null||Ie.dispose(),Fe==null||Fe.dispose(),Ne==null||Ne.dispose()},Lt=l([]),vt=async()=>{var z;const{json:o,httpController:ne}=await ra((a==null?void 0:a.taskId)||t());Lt.value=(z=o==null?void 0:o.data)==null?void 0:z.factor_data_analysis},St=l(!0),$t=o=>o&&o.split(" ")[0];return(o,ne)=>(w(),x("div",ls,[e("div",ns,[e("div",is,[e("div",rs,A(K.value),1),e("div",cs,[e("div",{ref_key:"echartsRefEarningsBigChart",ref:dt,style:{width:"100%",height:"400px"}},"加载中...",512)])]),e("div",us,[e("div",ds,[e("div",hs,[e("div",fs,[e("div",{class:"value",style:ve({color:i(c.value.return_ratio)})},A(c.value.return_ratio),5),ne[0]||(ne[0]=e("div",{class:"label"},"因子收益",-1))]),e("div",ps,[e("div",{class:"value",style:ve({color:i(c.value.sharpe_ratio)})},A(c.value.sharpe_ratio),5),ne[1]||(ne[1]=e("div",{class:"label"},"夏普比率",-1))]),e("div",vs,[e("div",{class:"value",style:ve({color:i(c.value.annualized_ratio)})},A(c.value.annualized_ratio),5),ne[2]||(ne[2]=e("div",{class:"label"},"年化收益",-1))]),e("div",ms,[e("div",ys,A(c.value.maximum_drawdown),1),ne[3]||(ne[3]=e("div",{class:"label"},"最大回撤",-1))]),(w(!0),x(me,null,Se(Lt.value,(z,O)=>(w(),x("div",{key:O,class:"data-item"},[(w(!0),x(me,null,Se(Object.values(z),(W,B)=>(w(),x(me,{key:B},[B==1?(w(),x("div",gs,A(W),1)):ce("",!0),B==0?(w(),x("div",_s,A(W),1)):ce("",!0)],64))),128))]))),128))])]),e("div",bs,[e("div",ws,A(ye.value),1),e("div",xs,[e("div",ks,[ie(It,{tableData:J.value,headers:de.value,isFixed:!0,"custom-header":De.value},null,8,["tableData","headers","custom-header"])])])]),e("div",Cs,[e("div",Ls,A(g.value),1),e("div",Ss,[e("div",$s,[ie(It,{tableData:H.value,headers:oe.value,isFixed:!0,"column-width":110},null,8,["tableData","headers"])])])])]),e("div",Ds,[e("div",As,[e("div",Ts,A(se.value),1),e("div",Is,[e("div",{ref_key:"echartsRefSimDietrich",ref:re,style:{width:"100%",height:"400px"}},"加载中...",512)])]),e("div",Fs,[e("div",Ns,A(F.value),1),e("div",Rs,[e("div",{ref_key:"echartsRefICDistribution",ref:C,style:{width:"100%",height:"400px"}},"加载中...",512)])]),e("div",Ms,[e("div",Es,A(at.value),1),e("div",Ps,[e("div",{ref_key:"echartsRefICSequence",ref:He,style:{width:"100%",height:"400px"}},"加载中...",512)])]),e("div",zs,[e("div",Os,A(fe.value),1),e("div",Bs,[e("div",{ref_key:"echartsRefICCcorrelation",ref:U,style:{width:"100%",height:"400px"}},"加载中...",512)])]),e("div",Ws,[e("div",Hs,A(_t.value),1),e("div",Vs,[e("div",{ref_key:"echartsRefRankICDecay",ref:ot,style:{width:"100%",height:"400px"}},"加载中...",512)])]),e("div",Gs,[e("div",qs,A(bt.value),1),e("div",Zs,[e("div",{ref_key:"echartsRefRankICDistribution",ref:lt,style:{width:"100%",height:"400px"}},"加载中...",512)])]),e("div",js,[e("div",Ks,A(wt.value),1),e("div",Js,[e("div",{ref_key:"echartsRefRankICSequence",ref:it,style:{width:"100%",height:"400px"}},"加载中...",512)])]),e("div",Us,[e("div",Ys,A(xt.value),1),e("div",Xs,[e("div",{ref_key:"echartsRefRankICCcorrelation",ref:ct,style:{width:"100%",height:"400px"}},"加载中...",512)])]),e("div",Qs,[e("div",el,A(kt.value),1),e("div",tl,[e("div",{ref_key:"echartsRefCurrentDeepAnalysis",ref:T,style:{width:"100%",height:"400px"}},"加载中...",512)])]),e("div",al,[e("div",ol,A(Ct.value),1),e("div",sl,[e("div",{ref_key:"echartsRefExcessReturnBigChart",ref:ft,style:{width:"100%",height:"400px"}},"加载中...",512)])])])])]))}}),nl=be(ll,[["__scopeId","data-v-442b3753"]]),il={class:"strategy-container"},rl={key:1,class:"strategy-container-content"},cl={class:"strategy-header"},ul={class:"strategy-content"},dl={class:"strategy-content"},hl={key:0,class:"tab-content"},fl={key:1,class:"tab-content"},pl=$e({__name:"index",setup(d){const t=Mt(),n=Je(),r=l("我的工作流"),a=l(null),S=l(null),i=l(!0),c=[{label:"收益",value:"factor_overview"},{label:"深度分析",value:"factor_analysis"}];n.child_currentFootTab="factor_overview";const y=h=>{console.log("当前选中的tab:",h)},$=l(null),T=l(null),K=async h=>{var g,oe,H,ae,ye,de;console.log("应用项目：",h);try{const J=await n.fetchLastRunId(h.workflow_id,h.feature_tag,h.locator);if(J.code===0)$.value=J.data;else if(J.code===-1001){t.warning("工作流正在运行，请等待完成后再点击应用！"),(g=S.value)==null||g.resetLoadingState();return}else if(J.code===-1002){t.error("工作流运行错误，请重新去工作流重新运行！"),(oe=S.value)==null||oe.resetLoadingState();return}else if(J.code===-1003){t.warning("工作流没有运行过，请去工作流运行！"),(H=S.value)==null||H.resetLoadingState();return}J.data.length>0&&(T.value=J.data[0],await n.getFactorLastDateData((ae=T.value)==null?void 0:ae.node_output),console.log("因子最新日期数据:",n.factorLastDateData))}catch(J){console.log("请求接口出错:",J),t.error("请求接口出错，请检查网络！"),(ye=S.value)==null||ye.resetLoadingState();return}(de=S.value)==null||de.resetLoadingState(),r.value=h.title,i.value=!1,n.child_currentFootTab="factor_overview"},N=()=>{i.value=!0};return We(async()=>{await n.fetchFactorList(),console.log("因子列表返回的数据:",n.factorList)}),(h,g)=>{var oe,H;return w(),x(me,null,[e("div",il,[i.value?(w(),ta(Ho,{key:0,ref_key:"tableaRef",ref:S,onApply:K,tableData:ge(n).factorList},null,8,["tableData"])):(w(),x("div",rl,[e("div",cl,[ie(ka,{onBack:N,backs:!0,title:r.value},null,8,["title"]),ie(Ca,{"tab-list":c,tab:ge(n).child_currentFootTab,"onUpdate:tab":[g[0]||(g[0]=ae=>ge(n).child_currentFootTab=ae),y]},null,8,["tab"])]),e("div",ul,[e("div",dl,[ge(n).child_currentFootTab==="factor_overview"?(w(),x("div",hl,[ie(Yo,{taskId:(oe=T.value)==null?void 0:oe.node_output},null,8,["taskId"])])):ce("",!0),ge(n).child_currentFootTab==="factor_analysis"?(w(),x("div",fl,[ie(nl,{into:!0,factorId:"",taskId:(H=T.value)==null?void 0:H.node_output},null,8,["taskId"])])):ce("",!0)])])]))]),ie(Ot,{ref_key:"logsDialog",ref:a},null,512)],64)}}}),vl=be(pl,[["__scopeId","data-v-725f9f8e"]]),ml={class:"no-use-container"},yl=$e({__name:"tip",props:{title:{type:String,default:"该功能暂未开放，敬请期待"}},setup(d){return(t,n)=>(w(),x("div",ml,[n[0]||(n[0]=e("div",{class:"no-use-container-img"},null,-1)),e("p",null,A(d.title),1)]))}}),gl=be(yl,[["__scopeId","data-v-0d18b139"]]),_l=$e({__name:"index",setup(d){const t=Je(),n=l(null);return l(!0),t.child_currentFootTab="trade_all",(r,a)=>(w(),x(me,null,[ie(gl,{title:"实盘功能开通请联系小助理，开通对应期货公司权限"}),ce("",!0),ie(Ot,{ref_key:"logsDialog",ref:n},null,512)],64))}}),bl=be(_l,[["__scopeId","data-v-576eec32"]]),wl={class:"strategy-container"},xl=$e({__name:"index",setup(d){const t=Je();return t.child_currentFootTab="signal_all",(n,r)=>(w(),x("div",wl," 信号指标内容... "))}}),kl=be(xl,[["__scopeId","data-v-960ae904"]]);aa({name:"bsCircle",draw:(d,t,n)=>{const{x:r,y:a,width:S,text:i}=t,{color:c,textColor:y}=n,$=S/2;d.beginPath(),d.arc(r,a,$,0,2*Math.PI),d.fillStyle=c||"#ff0000",d.fill(),d.strokeStyle="#ffffff",d.lineWidth=2,d.stroke(),d.fillStyle=y||"#ffffff",d.font=`bold ${$}px Arial`,d.textAlign="center",d.textBaseline="middle",d.fillText(i,r,a)},checkEventOn:(d,t)=>{const{x:n,y:r}=d,{x:a,y:S,width:i}=t,c=n-a,y=r-S,$=i/2;return Math.sqrt(c*c+y*y)<=$}});zt({name:"buyFigure",totalStep:2,createPointFigures:({coordinates:d})=>d.map(t=>({type:"bsCircle",attrs:{x:t.x,y:t.y,width:20,text:"B"},styles:{color:"#e9414d",textColor:"#ffffff"}}))});zt({name:"sellFigure",totalStep:2,createPointFigures:({coordinates:d})=>d.map(t=>({type:"bsCircle",attrs:{x:t.x,y:t.y,width:20,text:"S"},styles:{color:"#45b486",textColor:"#ffffff"}}))});console.log("figure.ts");oa({name:"factorIndicatorDraw",shortName:"Factor",zLevel:-1,figures:[],calc:d=>d.map(t=>({volume:t.volume,close:t.close,open:t.open})),createTooltipDataSource:({indicator:d,crosshair:t})=>{const r=d.result[t.dataIndex];if(r){const a=r.open<r.close?"rgb(224, 152, 199)":"rgb(143, 211, 232)";return{legends:[{title:"",value:{text:r.volume,color:a}}]}}return{}},draw:({ctx:d,chart:t,indicator:n,bounding:r,xAxis:a})=>{const{realFrom:S,realTo:i}=t.getVisibleRange(),{gapBar:c,halfGapBar:y}=t.getBarSpace(),{result:$}=n;let T=0;for(let h=S;h<i;h++){const g=$[h];g&&(T=Math.max(T,g.volume))}const K=r.height*.4,N=sa("rect");for(let h=S;h<i;h++){const g=$[h];if(g){const oe=Math.round(g.volume/T*K),H=g.open<g.close?"rgba(224, 152, 199, 0.6)":"rgba(143, 211, 232, 0.6)";new N({name:"rect",attrs:{x:a.convertToPixel(h)-y,y:r.height-oe,width:c,height:oe},styles:{color:H}}).draw(d)}}return!0}});const Cl={class:"left-bottom-content-tab"},Ll={key:0,class:"left-bottom-content-tab-item"},Sl={key:1,class:"left-bottom-content-tab-item"},$l={key:2,class:"left-bottom-content-tab-item"},Dl={key:3,class:"left-bottom-content-tab-item"},Al={class:"right"},Tl={class:"right-table"},Il=$e({__name:"index",setup(d){Pt(b=>({"4cf98024":g.value+"px","45b9b3f4":ae.value+"px"}));const t=Je(),n=l(!0);yt("child_isShowFuture",n);const r=l(100);yt("child_futureListHeight",r);const a=l(0);yt("child_dailyPositionHeight",a);const S=b=>{console.log("应用项目：",b),(b==null?void 0:b.type)==="strategy"&&(b.positionHeight?(r.value=60,a.value=b.positionHeight||0):(r.value=100,a.value=0),t.rightTableData=b.selectedApplyData||null,b.timeRange&&t.updateTimeRange(b.timeRange,b.startDate||"",b.endDate||""))};Ce(()=>t.currentFootTab,()=>{t.currentFootTab!=="strategy"&&(r.value=100,a.value=0)});let i=null;const c=l(null),y=l(null);let $=null;const T=l(1),K=[{key:"strategy",label:"策略"},{key:"factor",label:"因子"},{key:"trade",label:"实盘"}];t.currentFootTab="strategy";const N=l(null),h=l(!0),g=l(350),oe=()=>{h.value=!h.value,g.value=h.value?350:0},H=l(!0),ae=l(300),ye=()=>{H.value=!H.value,ae.value=H.value?300:0},de=l(!1),J=l(0),De=l(0),R=b=>{de.value=!0,J.value=b.clientY,De.value=ae.value,window.addEventListener("mousemove",E,{capture:!0}),window.addEventListener("mouseup",re,{capture:!0}),document.body.style.cursor="s-resize",document.body.style.userSelect="none"},E=b=>{de.value&&(ae.value=Math.max(50,Math.min(800,De.value-(b.clientY-J.value))),b.preventDefault(),b.stopPropagation())},re=()=>{de.value=!1,window.removeEventListener("mousemove",E,{capture:!0}),window.removeEventListener("mouseup",re,{capture:!0}),document.body.style.cursor="",document.body.style.userSelect=""},se=()=>{Me(()=>{var U;const b=((U=N.value)==null?void 0:U.$el)||N.value;b&&b.addEventListener("click",_,!0)})},_=b=>{var Ve;if(b.target.closest(".optional-svg"))return;const U=b.target.closest(".marketlist-row");if(!U)return;b.preventDefault(),b.stopPropagation();const fe=U.querySelector(".col2.code");if(!fe)return;const ke=(Ve=fe.textContent)==null?void 0:Ve.trim();ke&&(console.log("点击了合约:",ke),s(ke))};let p=null;const s=async(b,U)=>{console.log("准备切换到合约:",b),p&&clearTimeout(p),p=setTimeout(async()=>{console.log("执行合约切换:",b);try{if(i&&typeof i.setSymbol=="function"){U&&i.setPeriod({multiplier:1,timespan:"day",text:"1d"});const fe=C(b);i.setSymbol(fe),i.getChart().setOrderFlowData([]),i.getChart().setCandleVisible(!0),console.log("====================symbol=======================",fe),U&&(i.getChart().createOverlay({name:"buyFigure",points:U==null?void 0:U.buyFigure}),i.getChart().createOverlay({name:"sellFigure",points:U==null?void 0:U.sellFigure})),i.getChart().createIndicator("factorIndicatorDraw",!1,{id:"candle_pane"})}console.log("✅ 合约切换完成:",b)}catch(fe){console.error("❌ 合约切换失败:",fe)}},300)};t.klineCharthandleContractChange=s;const C=b=>{const U={BABA2503:"BABA",IF2503:"IF"},fe=b;return U[b]?{exchange:"XNYS",market:"stocks",ticker:U[b],name:U[b],shortName:U[b],priceCurrency:"usd",type:"stock"}:{exchange:"XNYS",market:"stocks",ticker:fe,name:fe,shortName:fe,priceCurrency:"usd",type:"stock"}},F=()=>{if(i){const b=i.getChart();b&&b.resize()}},le=b=>{t.currentFootTab=b,console.log("当前选中的tab:",b)},he=l(!1),we=l(0),He=l(0),at=b=>{he.value=!0,we.value=b.clientX,He.value=g.value,window.addEventListener("mousemove",xe,{capture:!0}),window.addEventListener("mouseup",Ee,{capture:!0}),document.body.style.cursor="w-resize",document.body.style.userSelect="none"},xe=b=>{he.value&&(g.value=Math.max(50,Math.min(800,He.value+(we.value-b.clientX))),b.preventDefault(),b.stopPropagation())},Ee=()=>{he.value=!1,window.removeEventListener("mousemove",xe,{capture:!0}),window.removeEventListener("mouseup",Ee,{capture:!0}),document.body.style.cursor="",document.body.style.userSelect=""};return Ce(ae,b=>{}),We(async()=>{try{const b=ae.value/window.innerHeight*100;c.value&&(i=new la({container:c.value,symbol:{exchange:"DCE",market:"stocks",name:"pp2509",shortName:"pp2509",ticker:"pp2509",priceCurrency:"usd",type:"future"},period:{multiplier:15,timespan:"minute",text:"1m"},datafeed:new go("Q0aVaOIdjbaHHu5UZM5MQ0XcOEU3mSIJ")}),i.setTheme("dark"),t.klineChartRef=i,$=new ResizeObserver(()=>{F()}),y.value&&$.observe(y.value)),se()}catch(b){console.error("Failed to load klinecharts:",b)}}),mt(()=>{var U;if(p&&(clearTimeout(p),p=null),i&&i.getDatafeed){const fe=i.getDatafeed();fe&&typeof fe.unsubscribeAll=="function"&&fe.unsubscribeAll()}$&&($.disconnect(),$=null);const b=((U=N.value)==null?void 0:U.$el)||N.value;b&&b.removeEventListener("click",_,!0),window.removeEventListener("mousemove",E,{capture:!0}),window.removeEventListener("mouseup",re,{capture:!0}),window.removeEventListener("mousemove",xe,{capture:!0}),window.removeEventListener("mouseup",Ee,{capture:!0})}),(b,U)=>(w(),x("div",{class:pe(["kline-container",{dragging:de.value}])},[e("div",{ref_key:"leftTopRef",ref:y,class:"left-top"},[e("div",{ref_key:"chartContainerRef",ref:c,class:"chart-container"},null,512)],512),e("div",{class:pe(["left-bottom",{dragging:de.value}])},[e("div",{class:"left-bottom-toggle-btn",onClick:ye},[(w(),x("svg",{style:ve({transform:H.value?"rotate(90deg)":"rotate(270deg)"}),viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"32302",width:"16",height:"16"},U[0]||(U[0]=[e("path",{"data-v-da8ede72":"",d:"M722.438 510.815c-0.246-0.246-0.513-0.454-0.766-0.69l-299.893-299.892c-14.231-14.24-37.291-14.24-51.529 0-14.241 14.231-14.241 37.291 0 51.529l274.851 274.859-274.849 274.851c-14.241 14.237-14.241 37.301 0 51.532 7.116 7.119 16.436 10.682 25.764 10.682 9.321 0 18.644-3.563 25.763-10.682l299.905-299.901c0.246-0.234 0.51-0.438 0.751-0.678 7.129-7.13 10.685-16.469 10.674-25.804 0.006-9.337-3.55-18.676-10.674-25.804z",fill:"#777777","p-id":"32303"},null,-1)]),4))]),e("div",{class:pe(["left-bottom-drag",{dragging:de.value}]),onMousedown:R},U[1]||(U[1]=[e("span",null,null,-1),e("span",null,null,-1),e("span",null,null,-1)]),34),e("div",{class:"left-bottom-content",style:ve({opacity:H.value?1:0})},[ie(yo,{onTabChange:le,activeTab:ge(t).currentFootTab,tabs:K},null,8,["activeTab"]),e("div",Cl,[ge(t).currentFootTab==="strategy"?(w(),x("div",Ll,[ie(La,{onApply:S})])):ce("",!0),ge(t).currentFootTab==="factor"?(w(),x("div",Sl,[ie(vl)])):ce("",!0),ge(t).currentFootTab==="trade"?(w(),x("div",$l,[ie(bl)])):ce("",!0),ge(t).currentFootTab==="indicator"?(w(),x("div",Dl,[ie(kl)])):ce("",!0)])],4)],2),e("div",Al,[e("div",{class:"right-toggle-btn",onClick:oe},[(w(),x("svg",{style:ve({transform:h.value?"rotate(0deg)":"rotate(180deg)"}),viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"32302",width:"16",height:"16"},U[2]||(U[2]=[e("path",{"data-v-da8ede72":"",d:"M722.438 510.815c-0.246-0.246-0.513-0.454-0.766-0.69l-299.893-299.892c-14.231-14.24-37.291-14.24-51.529 0-14.241 14.231-14.241 37.291 0 51.529l274.851 274.859-274.849 274.851c-14.241 14.237-14.241 37.301 0 51.532 7.116 7.119 16.436 10.682 25.764 10.682 9.321 0 18.644-3.563 25.763-10.682l299.905-299.901c0.246-0.234 0.51-0.438 0.751-0.678 7.129-7.13 10.685-16.469 10.674-25.804 0.006-9.337-3.55-18.676-10.674-25.804z",fill:"#777777","p-id":"32303"},null,-1)]),4))]),e("div",{class:pe(["right-drag",{dragging:he.value}]),onMousedown:at},U[3]||(U[3]=[e("span",null,null,-1),e("span",null,null,-1),e("span",null,null,-1)]),34),e("div",{class:"CustomTopPanel",style:ve({opacity:h.value?1:0})},[ie(so,{ref_key:"customTopPanelRef",ref:N,currentCustomPanelIndex:T.value},null,8,["currentCustomPanelIndex"])],4),e("div",Tl,[ie(ho)])])],2))}}),Fl=be(Il,[["__scopeId","data-v-a43223e1"]]),Nl={class:"about"},Ol=$e({__name:"ChartsView",setup(d){return(t,n)=>(w(),x("div",Nl,[ie(Fl)]))}});export{Ol as default};
