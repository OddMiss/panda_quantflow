import{H as Gt}from"./Header-CKmcx9-9.js";import{d as lt,v as ht,g as zt,c as _,o as y,F as Me,k as Je,i as je,b as e,l as Vt,a as We,n as Oe,x as ft,t as q,_ as at,r as h,f as ut,y as dt,z as qt,A as _t,h as Le,u as bt,B as Tt,C as kt,D as Ut,G as Zt,e as Qt,H as He,I as Xe,J as Qe,K as Wt,j as Ye,L as Pt,M as Nt,N as wt,O as Yt,P as Jt,Q as Ht,R as De,T as $t,w as Dt}from"./main-igtpSIOc.js";import{a as Kt}from"./index-DMQiFI3z.js";import{l as Pe,G as Xt,a as jt,b as ea,c as ta,d as aa,e as oa,f as sa,g as ra,h as ia,i as na,j as la,k as ca,m as da,n as ua,o as fa,p as Mt,s as ha}from"./index-Cx-N-r75.js";const ga="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAhNJREFUOE+Nkz2IU0EQx2c2TxJ5CHKihWcqfdl9hBgMAcVO7MUqCAqiJ2Ihp2IhaBPsUgg2lhaHV5gcaKdYaHFXqBA0CSRvkmcX5U5E1HydIewb80ISnsGPbLXLzv83s7P/QZhZ9Xr9NDOfBYBjALAXAL4xc0UIsdZut1fS6fQgKMHJoVQqLUYikccAcJiZHwkhXgohtgaDwQIiHkfE88y8bRhGxrKs9xPdCDAWv0HEcrfbvZBKpb7MVtZsNnd2Op0cIl7UWp+Mx+Nv/ZgRgIg2EPFHLBY7hYjerDh4JqIcAJwDAKWUauP4zSu9Xu/QnzLPwgqFQiiRSPg9yUsp7yIRrTHzZ9u2r/4rc/DOcZzLiHhTKSV9QBMRl6WUT+cFuK57UGv9QWu9xwf8DIVCJyzLej0voFwum+FwuOP3wQdsIuKSlPLZvADXdQ9orZue5+1Hx3FeAEDRtu078wJqtdoZIcQ9pdSi/wuXmDlrmqYVjUa354EQ0ToAvFNKXcdisbjDNM0aADy3bXv5fwAiugIAuX6/H08mkx9HRnJd98jQXRtD7z+oVCq3M5mM/huIiL4CwKpS6trUif6m0Wgc9TzvCTN/F0LcF0K8Mk1zs9Vq7WbmWD6fX89msx4R+S58CABLSqnV6TCNLb1raOkb42mMBarYQsS0lPLTOG4K+Q0QLLtarS4YhrEPANoT4cxM+JBbvwBBieor6fEbMAAAAABJRU5ErkJggg==",pa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAAXNSR0IArs4c6QAAAwxJREFUOE+VVE1oHVUU/r47M4lN/YmCiFAQ6qbiokVQBEGooC66svRnJQgqQle+/LRm5r3kZmbuKOlLpAlSqtiNq9KiLkRQlIggiLpQFyIIRUGQKJSYUqK58+7xnUde0Pja0Fnec+53v59zhrj+x7IsD5OcBHAAwLcicrrZbL4LQAZd4/ZDEaFz7giAVhfoGoAyjuPP67p+HECzC7gbQJFl2SWS/wHdArPWmiRJeiAArgKYzbLso+2POeee7jKbAXCbgnrvL1lrg/ZRQeI4PmqMaYUQ/uwym221Wh/fQH6vVBTFU8aYGZJ3hBCKuq4vqi/nSe4zxkxPTU19shPIAKZPqgoAP6k/V0nuTdP0j5sF6vdXVXW3iPzCqqqciBzT1NI0ff9mAYuiOGyMmSN5oReAc+6giLxO8kqn02lMT09/txOoc+6A3gFwJ8lGlmXLXFhY2DU2NrauQQwNDT2vAYjIB8PDw83JycnfB3h0j44LgEMhhJlOp/O2ptloNHZpAD8A+JJklmXZb9ba25MkaQJ4TkTaKysrZ5aWlv5eXFwcXltba5AcA3Dee19Za9ecc/eKiAPwqI7GrXEcT5F8sUv5jPd+3lr7V1EU95M8TfIhAMsADgL4xnt/0lp72Vp7S5Ik4yLyMoA367p+dWtoy7K8j+QcgEdE5JVms3lBJeZ5vj+Kov26TlmWfa9nZVkeJ/kagK+896estT/3htY59xmAi977c9bauqqqxzaN3dgM4+u+b3mePxxFkZo+pKanafqFtTaOouilKIqOMM/zB6Momie5R0TGN1dIH3lWgxaR5RDCG1EUnQDwBAD19h1ddl0tkvMi8qt6uSXTOXcIQFtELhtjxtM0/XFiYmL36OjoSWPMMyGE91ZXV+fa7fa1qqr2hRCUwF6S2vthT+a/o1fKcRyfIJnqEG5sbMxaa6/0e6y1d8VxrPt4XFl778+qNf36/35BWtBLSZJYAMdEpBoZGXlrfX39BZU46JEbgvWLRVE8QLJNUr36lOSEyr/edgxktr1ZZ0pnb6cV+wccUGjIODRIkAAAAABJRU5ErkJggg==",va="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAgCAYAAAB+ZAqzAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAJqADAAQAAAABAAAAIAAAAAALstX7AAAEgUlEQVRYCc2YWWiUVxTHO0uiVhP3qi20oZIggoK+1FICxaTSjULzkEJ9sNWHSMTRYGfLMk2zTGactmnGVhKopH2opXmwUE0LDaUREVREcCFqwIWCGtHWMhO7JDOZ/s7nvWEy5svWzCQXzpx7zzn3nP937j6WJ6ZYGhoanrFYLCWJROJN+GrcrFSu+pBdQ3YMfqS6uvrWVEJYJtuprq5und1udxP0Hfrax+kfA+B3sVgs6PP5Lo5jO0I9YWB+v/+loaEhD4HewIPud4r6EUCehu6KZ/QroBeolkCbREZBnei0Wq2BysrKk49EY//qAKZWAHodpx4MCpVRAn4UWRPDJMBMC8O9CZDS9y1IxzqBTAD+aNoxyXiETUdHh623t7dUOV2vlDHAfKu+umdEh3EafNxa+roxexcyhp/2eerBgoKCjtLS0niqC/0Vhry2tnYu8+c9ADkRPK+M/4IfstlsH3s8nt+UbEosEAg8G4/HP6DzDuhJ5eQ6IEPMw6+I/492bAATQNnZ2Q7mUAWgVirlAzp8QYbCpP2e7jAdnAwuJ5aDWLvwt1h8EquPWM0DAwNhAWhRX9GFrkAMKLfp0EyG2txud/SRKD2/wWAwhwyWAaqCCE+rKFeJvcXS2Nj4M4JXoDsA+hDEX4N4QBllhIXD4TnRaHQbAD8Cg4xYlwDrpzIf2lxVVfVrRpCYBKmvr9/McP6C+qGtqKjoZSqyc28pLi6OFBYWXuru7n5slaBPW5GMEXc7AT4nYwvgx03nGEPaypBKNtNWxpxjEhUApquSZdyC/v50opvQqkwOKADTuY9xEjzHUO0j5sT2sWRwUjfb+VEdxnGQfe1/7/z4usAqDExo5xdQqcXkrPxBnGb8rEwFJ20Azq7bRSrIWXcfSwXIRE7/DZZhkvOqion9JRO7LhVEJtqcQH7iy2r1gaHNjmAPoD6T4PBlmQAxWgxiP4VcqBVMc60I5IYppT4/P19O+RkpbBtlBG6U4ILJSvqMOxmNRE9Pj1ybZ6So2EM6uIVJvBdszUpwhXqAc/IbToGYNkonJ46dS+pWNXJrJBb1CiNbgCsHkB/ZQgXiJu39AGyn4/B1V+mmhcmNor+/fzsgXDjMU04jtL1s3AcNYCIEwKKsrKzdVPdAS0VGuQN9Mjg42IZ+Wm4a+FlAHJlPcmaugqT8DrUQ5wD6P0UwDEwaUkKh0HwytZNqcsc/yGALdMDr9T4wDCf509TUtJhs7Ibkw5eo7saHM5StTqfzYbLLx4BppaQ6Eom8Dxh5duUpeRR+EGrmtms8cJXclLH0V6CU1V4O5SjDGwDcn5ub2+5wOP5VshHMFJi2IrV2Ui/vQS9kTE743wA+xEPi05qamhvaNpnLI4eXkBMAsmnOU7rL8ABDdhi/Yy6ucYHpYDiycld7m7acEBu0HH4WOgPJ68oGXw6YF+EbIe3/HDI/l87v8TO8JaA3LbqjqcFoCobnNeSSQf23wWhmAuA4FGLYfxrNYCzZlIBphwBcRZZeZchkiGUl22lL5q6R3U6Xy9WnbSfL/wNxuVVL2KmRUgAAAABJRU5ErkJggg==",Aa={class:"category-items"},ma=["onClick","onDragstart","onDragend","draggable"],wa={class:"node-icon"},ya={key:0,src:va,alt:"icon",width:"11px",height:"11px"},xa={key:0,class:"item-count"},At=30,_a=lt({__name:"CategoryItem",props:{item:{type:Object,required:!0},level:{type:Number,default:0},selectedNodeId:{type:String,default:null},expandedCategories:{type:Array,default:()=>[]}},emits:["toggle-category","drag-start","drag-end"],setup(G,{emit:I}){const Q=G,T=I,U=ht(()=>{var D;return((D=Q.item.children)==null?void 0:D.filter(ae=>ae.object_type==="group"||ae.object_type==="plugin"))||[]}),r=D=>D===U.value.length-1,g=D=>D<U.value.length-1,z=D=>{if(!D.children)return 0;let ae=0;for(const k of D.children)k.object_type==="plugin"?ae++:k.object_type==="group"&&k.children&&(ae+=z(k));return ae},se=()=>({left:`${Q.level*At+8}px`}),M=()=>({left:`${Q.level*At+9.5}px`,width:`${At-2}px`}),re=()=>({marginLeft:`${Q.level*At+30}px`}),ie=D=>{T("toggle-category",D)},ke=(D,ae)=>{D.dataTransfer&&(D.dataTransfer.setData("node-type",ae.name),D.dataTransfer.effectAllowed="copy"),T("drag-start",ae)};return(D,ae)=>{const k=zt("category-item",!0);return y(),_("div",Aa,[(y(!0),_(Me,null,Je(U.value,(o,he)=>{var Ce,Ie;return y(),_("div",{key:o.id,class:je(["node-container",{"is-group":o.object_type==="group","is-plugin":o.object_type==="plugin","is-last":r(he),"has-children":o.object_type==="group"&&((Ce=o.children)==null?void 0:Ce.length)}])},[e("div",{class:je(["vertical-line",{full:g(he),partial:!g(he)}]),style:Oe(se())},null,6),e("div",{class:"horizontal-line",style:Oe(M())},null,4),e("div",{class:je(o.object_type==="group"?"group-content":"plugin-content"),style:Oe(re()),onClick:ft(E=>o.object_type==="group"?ie(o.id):null,["stop"]),onDragstart:E=>o.object_type==="plugin"?ke(E,o):null,onDragend:E=>o.object_type==="plugin"?D.$emit("drag-end"):null,draggable:o.object_type==="plugin"},[e("div",wa,[o.object_type==="group"?(y(),_("img",ya)):(y(),_("span",{key:1,class:je(["node-icon-indicator",{"is-selected":G.selectedNodeId===o.id}])},null,2))]),e("span",{class:"node-name",style:Oe({color:G.selectedNodeId===o.id?"#fff":"#858585"})},q(o.display_name||o.name),5),o.object_type==="group"&&((Ie=o.children)!=null&&Ie.length)?(y(),_("span",xa,q(z(o)),1)):We("",!0)],46,ma),o.object_type==="group"&&G.expandedCategories.includes(o.id)?(y(),Vt(k,{key:0,item:o,level:G.level+1,"selected-node-id":G.selectedNodeId,"expanded-categories":G.expandedCategories,onToggleCategory:ae[0]||(ae[0]=E=>D.$emit("toggle-category",E)),onDragStart:ae[1]||(ae[1]=E=>D.$emit("drag-start",E)),onDragEnd:ae[2]||(ae[2]=E=>D.$emit("drag-end"))},null,8,["item","level","selected-node-id","expanded-categories"])):We("",!0)],2)}),128))])}}}),ba=at(_a,[["__scopeId","data-v-ac1a95ba"]]),ka={class:"side-nav-container"},Ca={class:"search-container"},La={class:"search-input"},Sa={class:"nav-content"},Ea={key:0,class:"empty-state"},Ra=["onClick"],Na={class:"category-name"},Da={key:0,class:"item-count"},Ia=lt({__name:"Aside",props:{defaultExpanded:{type:Boolean,default:!0}},emits:["categories-loading-state"],setup(G,{emit:I}){const Q=G,T=I,U=h(!0),r=h(!1),z=h([]),se=h(null),M=h([]),re=E=>{if(!z.value.includes(E.id))return 0;let C=0;const ne=(ge,f)=>{ge.object_type==="group"&&z.value.includes(ge.id)&&(C=Math.max(C,f),ge.children&&ge.children.forEach(P=>ne(P,f+1)))};return ne(E,1),C},ie=E=>{if(!E.children)return 0;let C=0;for(const ne of E.children)ne.object_type==="plugin"?C++:ne.object_type==="group"&&ne.children&&(C+=ie(ne));return C};ut(async()=>{T("categories-loading-state",!0),U.value=!0;let E=!1;try{const C=await Kt();C&&C.length>0?(M.value=C,z.value=C.map(ne=>ne.id),E=!0):C&&C.length===0&&(M.value=[],z.value=[],E=!0)}catch(C){console.error("加载节点分类失败 (Aside.vue):",C)}finally{U.value=!1,E&&T("categories-loading-state",!1)}Q.defaultExpanded&&(z.value.length===0&&!E||z.value.length===0&&E&&M.value.length)});const ke=()=>{r.value=!r.value},D=E=>{const C=z.value.indexOf(E);C===-1?z.value.push(E):z.value.splice(C,1)},ae=E=>{E&&(se.value=E.id)},k=()=>{se.value=null},o=h(""),he=ht(()=>{if(!o.value.trim())return M.value;const E=o.value.toLowerCase(),C=ne=>ne.map(ge=>{if(ge.object_type==="group"){const f=C(ge.children||[]);return f.length>0||ge.name.toLowerCase().includes(E)?{...ge,children:f}:null}else if(ge.object_type==="plugin")return ge.name.toLowerCase().includes(E)||ge.display_name&&ge.display_name.toLowerCase().includes(E)?ge:null;return null}).filter(ge=>ge!==null);return C(M.value)}),Ce=()=>{o.value.trim()},Ie=()=>{o.value=""};return(E,C)=>(y(),_("div",ka,[e("div",{class:je(["side-nav",{collapsed:r.value}])},[r.value?We("",!0):(y(),_(Me,{key:0},[e("div",Ca,[e("div",La,[C[2]||(C[2]=e("img",{src:ga,alt:"icon",class:"search-icon",width:"14px",height:"14px"},null,-1)),dt(e("input",{type:"text","onUpdate:modelValue":C[0]||(C[0]=ne=>o.value=ne),onInput:Ce,placeholder:"搜索目录"},null,544),[[qt,o.value]]),o.value?(y(),_("button",{key:0,class:"clear-button",onClick:Ie},C[1]||(C[1]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)]))):We("",!0)])]),e("div",Sa,[o.value&&he.value.length===0?(y(),_("div",Ea,[C[3]||(C[3]=e("svg",{class:"empty-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M15.5 15.5L19 19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}),e("path",{d:"M5 11a6 6 0 1012 0 6 6 0 00-12 0z",stroke:"currentColor","stroke-width":"2"})],-1)),C[4]||(C[4]=e("p",null,"未找到匹配的节点或目录",-1)),e("button",{class:"clear-search",onClick:Ie},"清除搜索")])):(y(!0),_(Me,{key:1},Je(o.value?he.value:M.value,(ne,ge)=>{var f;return y(),_("div",{key:ne.id,class:"nav-category"},[e("div",{class:"category-header",onClick:P=>D(ne.id)},[C[5]||(C[5]=e("span",{class:"category-icon"},[e("img",{src:pa,alt:"icon"})],-1)),e("span",Na,q(ne.name),1),(f=ne.children)!=null&&f.length?(y(),_("span",Da,q(ie(ne)),1)):We("",!0)],8,Ra),dt(Le(ba,{item:ne,level:0,"selected-node-id":se.value,"expanded-categories":z.value,"max-expanded-level":re(ne),onToggleCategory:D,onDragStart:ae,onDragEnd:k},null,8,["item","selected-node-id","expanded-categories","max-expanded-level"]),[[_t,z.value.includes(ne.id)]])])}),128))])],64))],2),e("div",{class:"fixed-fold_arrow",onClick:ke},[(y(),_("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",style:Oe({transform:r.value?"rotate(90deg)":"rotate(270deg)"})},C[6]||(C[6]=[e("path",{d:"M7 14l5-5 5 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),4))])]))}}),Fa=at(Ia,[["__scopeId","data-v-a1bd9474"]]),It="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAYtJREFUWEfV2dFxgzAMAFDZS2SHbEG26D8cPx2nP9zx3y2aLbIDGcLOqcW9lGBLlgym+cQGPxQsccIAALRtezLGfFpr34dhuOGxWr++78/OuQ/v/ds4jpOZcV8AcAaAu7W2qYWccWg5AcDNe38xXdfhgeYpYlWQC1zgXE1kYFdkxDB57xuD1JrIGM5ae8FH7RtYC0nh0PULTCCncDcldzYH9wLcC8nFrQK3RubgosCtkLm4JLA0UoIjgaWQUhwLqEVqcGygFKnFZQFzkSVw2UAushROBKSQOO6cC69MofiIq9GfUpdTymJRmq+B73NqnDiCYeUI8vk+xZELFxFHkIFU49QRTDyPOFQfeOi/+NCbJJXnqqcZThLmzOGmtKxdnLNwztwUlg2ULCg5Z4llATULac5l5UHtAlTtptosyQiWwBEVh0zmUWBJnAa5CtwCJ0W+ALfESZD/p/WxR+SWOY6zZqr9Ru4wbrlKzaOQsQbmLjjOM7nWAt4VRyCvyyZ6FVwE+dNEx8Ejf4Z4AOhffFtCFuoVAAAAAElFTkSuQmCC",Ba=["onClick"],Ta=["src","alt"],Ua={class:"toolbar-text"},Ft=1.1,Wa=lt({__name:"Toolbar",props:{isRunning:{type:Boolean,default:!1},progress:{type:Number,default:0},graph:{type:Object,required:!0,default:null},isGraphReady:{type:Boolean,default:!1},canvas:{type:null,required:!1}},setup(G){function I(f,P=!1){f||(f=window.location.href);const Y={},le=f.indexOf("?");if(le!==-1){const F=f.indexOf("#",le),xe=F!==-1?f.substring(le+1,F):f.substring(le+1);Q(xe,Y)}if(P){const F=f.indexOf("#");if(F!==-1&&F<f.length-1){const xe=f.substring(F+1),be=xe.indexOf("?");if(be!==-1){const w=xe.substring(be+1);Q(w,Y)}}}return Y}function Q(f,P){if(!f)return;const Y=f.split("&");for(const le of Y){const[F,xe]=le.split("=",2);F&&(P[decodeURIComponent(F)]=xe!==void 0?decodeURIComponent(xe):"")}}const T=bt(),U=Tt(),r=G,g=[{id:1,src:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAUCAYAAACAl21KAAAAAXNSR0IArs4c6QAAAQ9JREFUOE/llKFOxEAURe+j00AQfAceFjTBEAwWAX9AQtDTZGdJp7UIVBUJCDyiCjQsfAC+P4Agm5DOzGWbVCC6Jaliw/P35L1zJyNpmt6IyCmAFQybQPJWrLWe5FhEXgFcAXgDcPcL84TkSETOAWzPl7hsQARwqLUurbXPAEqt9aQPNM+M28xunucHIYTyH4GeAGy0wvs0bZH8TJJkr9NRnucj7/2FiKz2UUh+NQ0nSTLtBA15RksCIilZlp21whdeGkKYVVV1XRRF3XmaMWZdKfUgIk1zC4fkzDl3ZIz5WBJHf6d+ksfOucchGyml9kXkvvlGXgDsDIH8yEzFGLMWx/Gm9z4aAouiyNd1/f4N+DkenOMZoNsAAAAASUVORK5CYII=",import.meta.url).href,alt:"save",text:"保存"},{id:2,src:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAATCAYAAACdkl3yAAAAAXNSR0IArs4c6QAAAU1JREFUOE+d1DFLw1AQB/D/JRFEcHZxdNbVVRB0dXJ1cxHXgi8v2DQ3pDjpVlc3v4E4SBc/gLoJIgT3Uhyq9M48oRpLapO8KSR3P97dvTxi5hUiYlVdB+Dhd4mIhNbam8K7mY/EzC5wU1X7RCRFaDwep1EU3VeFPgCcGWNOqiTMinE70vzjqTGmXREiAC7nz6oNMfMTgDtjzFERbALZfCixql6GYXg4wWpDrp4kSdr5YKIi1ggqw0qhTqez63nedoXm7wNYJaLrUoiZzwEczINUdYGIFgEMG5cWx/GG7/u3AN5FZKsRNI1Ya19qQ2WIa0FtiJmf8xMQuHLcTiZ9bALtBEHw0Gq13orDqA3999O+AshEJPV9/+caUVUdDAb9brc7nHcMvnuUJMkegCsiWppOEJFja+1FJcgFpWm6PBqN1qZvyCzLHnu93mcV6Au5hdZ8w5yWBAAAAABJRU5ErkJggg==",import.meta.url).href,alt:"export",text:"导出"},{id:3,src:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAATCAYAAACdkl3yAAAAAXNSR0IArs4c6QAAAUZJREFUOE+l1LFKxEAQBuB/JsgVclyv1wh2ng9gc1iIb2Bn63VayaWYJEo2G7hWbOxs9QkUBFtbrS19AgURTDJeCkO8M9yS23KZ/WY2mR2C4zLG7DNzAoBrRwoielFVIUcHcRzveJ7n1yFVZSIaAnhyhpoSWmtTAKdNULmvLtVaa8+mceezEFlrLwHsishWW4iSJLkioiMAkYiYNlCFTD9gHARBWa7Tql+tNVJmqqA0TW9V9QDAG4CbRWUURfEQhuHdb1wFWWvfAXRV9YuIvhdBAK5F5GQOMsZsMPMjgNU8z/eiKHp2wKqQP79/GWyuj9pi/zZkDctEZNPlik2djclkspZl2baI3C8FuRyuxzRW1ASNx+Nur9cbElH1PvM8Z2YuR8u68xgxxhwz88VsIlX9BHDoDI1Go5V+vz+YnZCdTufV9/2PHyuOmQ4RpZomAAAAAElFTkSuQmCC",import.meta.url).href,alt:"import",text:"导入"},{id:4,src:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAUCAYAAACAl21KAAAAAXNSR0IArs4c6QAAAWZJREFUOE/tlLFLAzEYxd872m46u+jg4iTuOtgiCqKbg7P+A06l0OTK0SSF4uQ/oLODowiKWAfdRXBwcNDFWbe23GdTpNij1x6dvSW8fMkv+R65R6R8zrkygP1E+VwpdTxqC9NA1to9ADuJ+qXW+mIkyBizS3IxDZhlXkTe6Jx7AbAEIAAQA5AsmxNrXvutGWOKQRDcxXFcCsOwNQUIU4OiKJrN5/NHnU7nJIqir6lBjUZjXURaJIvVavU+FWSMOfAthmF49tt+Ug/ZkQrqneg9g9a65EFJnfR1LMgDetcegP7qfxBgrb31nmitN/yY1Jk9qtfryx5Qq9We/ZjUmUGTfpORIGvtKskHAFtKqZtJEF93zm0CuBaRNa31Y/8dNZvNmW63+yEiTyLig6s9AVYgWSa5ksvl5iuVyvcg2Jxz2yJySnIuy41E5JPkoVLqyq8fSkgR8fm0ICKFcTCSbaXUO8lBdv0AzkZJXg8QSYAAAAAASUVORK5CYII=",import.meta.url).href,alt:"delete",text:"清空"},{id:5,src:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAATCAYAAACdkl3yAAAAAXNSR0IArs4c6QAAAq9JREFUOE+VlF2oTUEUx/9r9t6lxFXIffEV+Ug3H0+IB99SyleEkkIePAnlnNl3t9z9cepe3ngg9+ESykcSijwoIlKkKDc8E4mEOLP3LOZ2jo7jIPM2s9b81pq1/msILVaWZXOstWsAzAAwiog+isgLAFfzPL/MzF+br1HjQZZlU6y1R4hoIYBnInILwGsiaiOiDhGZD+BVURT7oig623j3JyhN0yUAzgHoF5HdYRjebY7a3d3dbow5AGAHgG6t9f66zwCoq6urw/O8OwAuGWO2MXO11ZPrZ2mabgLQB2C/1vqQO3cgStP0AYBPxpjFzJz/DdIA2wOgYq2d1tnZ+ZyyLFslIueLopgeRdHTZkiapldqkZ802phZBUHwWEQehWG4xWVzSkTawzBc1CITZ7cisi4MwwstguwSkSzP85HO8SWA41rryv+C4jierJR69qO2Mx3oCxHtLJfLJxvefw3AhNp+oms5gM8iYqy1m6MoeuRsPT09g6vV6icAKxzoHYCS1vpYU1fG1vYZgNMAnjiQ53m9pVLpvbMx84ggCN5aaxdQkiQPlVI3y+Wy68Jvgv1bjZIkmUdEt40x411GLuJ6Y8wkZrYtClrUin2xhe0ggJVa68lUK5hr7Tat9Ylm5yRJ1uZ5foOZPza1v933/edExE6UA8pO0/Twj9HYaK2d7cT1L0Eys+/7/nUiGmOM6XBDPABi5kFBENwEMFoptbpUKjmlt1zMPMz3/TNEtLQoillRFD2uj8jABWYeWncQkT6lVG+1Wr1fr1ulUhlnrd0gInuJ6BuA4SJyJs/z7c7nl2+kNncbRSQkoqkA3PC+AdAGYIiIfCCio8aYzPO8uUqpi3VYM+jnc+I4nkpEM5RSo5wYrbX9eZ7fa/wZ4jhe7mDuJ/gj6F8FbxDvMgBbvwM3PmOICE4pBgAAAABJRU5ErkJggg==",import.meta.url).href,alt:"zoom-in",text:"放大"},{id:6,src:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAUCAYAAACAl21KAAAAAXNSR0IArs4c6QAAAplJREFUOE+dlE1IVFEUx//nzXtJIIgyjQsLCVoJrVqEK7PaBC5Moq9FC11Glm2Sd+80N9+7zmQRFLWwiKKIomlTqwwypI9VC1u0CGpRWYhGjEmRvY+TV2ZkHM2P7vZ/zu+d87/3/wjLnGw2WzszM1PvOM7U6OjoRD6fj/5VTpWCUmqj4zgnmbmDiBrL9Gkiegzgiuu6I5V9C0Ba6+MAsgDGmfk2Mz+3LGs8iqIay7K2EtF+AK1ElC8UCl0DAwPTJeA8SGt9AUA3M58Ow/C8UurPUmt4nrfbsqxbzDxh23ZLb2/vlKmbA3me12VZ1lVmPiilzC/nm9F8399ERK8AvBFCtM2BcrlcTRRFH5j5upTy1EqQkt7X19ecSCReElG767qPyPf9EwAyYRg2KqV+rBZk6rTWZvqUEKKFtNbDzDwmpTyyFoip7e/vb2fmB0RUb0BfmTknpbxUAvm+3xDHcaoSnEgkAiHE29kN2GjFp/KZmZsN6Dczd0kp75QatdZjABqWmjAMw52ZTOaZ0Xp6etYnk8lfANoMyDSdE0JcLDUqpeqqqqrqKkFRFAVSyo9lk5vb+1Sa6AkRfXNd9/B/eLSPme8GQbDBTHTU+BYEwWal1Pe1wLTWD4mo2nXdXaSUqnYc5z2A+0KI7tWCtNatAJ4C2COEGJp72b7vHyIiY3anEOLmSrBsNrsljuMXs7kbEUIcmI9IEXaGiNLMfDYMQ08pZW5j0fF9fy8RXQNQG8dxUzqdfrcAVHypnQBMeA3kXmX6AZj0bwNwg5m3E9E6Zm6VUn5Z6n+UtG37GBF1zPrWBMAyH2HmcQBDAC5LKV8rpVK2bQ+XYItA5bsMDg46k5OTqTAMfyqlCpV7lsGiZUErmV7M24Y4jnf8BdONMaMxI63zAAAAAElFTkSuQmCC",import.meta.url).href,alt:"zoom-out",text:"缩小"},{id:7,src:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAfxJREFUOE+Vk7+LE0EUx79v3d1OEEEQQYsTLI3VidilUVCwipwKeoV/gcURM7NxSGY2iURFQQ4CCt5ZCHYWNlqLhRaCFjbKKiJIIIU/kE12nswRwxKSvcuUM+995vu+7z3CNscYcyrLsn69Xn9bFEpFj8aYiwA2APxh5tNSylfz4ueCxpAHAL4D8ADsLYLNBDWbzcOe571n5sue551j5i/M/IuI1pIk2dfr9YbTymaClFKe7/sHpZRJHMePHUgIUVNKLSmlPs0qr9Ajl5AH7chsrfUdItovhLiQT5gH0lr3iKjvlLr4LUVxHN+11q74vl+uVqsf8iBjzCoR/ajVas+n7o8BeAngoRBijbTWt4joGhGtM/MEYq1NsyzbVEr9dYB2u31oNBqdJaK8HQ52lZnbZIx5DeA4gDcAfud+TQFcEUK49sMNJoDrUz6FAE4w8ztSSu0JguCFgwwGgzPdbjcPc4Cj1tqfURR9zkOUUmEQBE8BHAFQ3pL5H+ZKk1KuTnmx6dovpRT5e631fSIqO4hTPam30+nsTtP0QBRFH3fStUajUbLWflNK9SddK5qPhecoD2u1WkvW2ifD4fB8GIZ6vCLPXGeTJFledEU2iOgkgK8A3AgsM/NtKWVjoRWpVCq7SqXSIyK65BKZ+cY8yLYejWH3ACRSyptFXv4DBbYHOWLuLHQAAAAASUVORK5CYII=",import.meta.url).href,alt:"move",text:"移动"},{id:8,src:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAAXNSR0IArs4c6QAAAldJREFUOE+tlDtoFFEUhv+zswMGk3WDiFoIoo0YhMVGhVhEURGNqLC9KYQo2CQI456bcLOZGbZSUTE++qCFRiRNQCtT+EC0EbERH51aaBpBduZ377IJmxCXjXrLuf/55p7HfwQtDkkZGxtb53nemiRJvlprv7fSy3KXcRwfIzkA4ACA1U2a9wCmPM+7EgTBp6Wxi2BhGG4CMCkivSS/iMg0ybciMiciG0juB7CX5E8Aw8aYG83ABVilUumpVquPRKQrTVNNkmTCWvtr6d/L5XKP53lXAfQBuKmqg9baHMl8HRbH8do0TV+ISCeAg6r6ulVtisWiVygULgE4R7IsIq4cWodFUXQNwKCI9JVKpSetQPN31tqM7/vTAA43vu2TKIrWA/hMctIYc6odkNO41LLZ7IyI7F6AjY+Pn85kMrdI7jLGPG8HZq1d5fv+XQB75vUkT0oYhrdFpKiq3QDYDuxPGpema/8WY8z2fwG5WAe7B6Cgqlv/B+yy62RHR0f30NCQG8a/Pq5m/SLyUEROlEqlByslubFK0/TNyMjIhDQ68wHAR1XdtRJYGIa9IuLm0qhqNO+AMySvk7xgjKm0A7TW5n3ff0bSzdu2IAh+1GFu1cRxPAWgn+R5Y8zFVsAoijbWmuZKshPAUVWdqXezyR6dvu/fAXCkthkeO89Vq9VZa23apMlns1nnEm34eEBVXUz9LFpBDb8NkyyJSL6xht4BmKttCPeaHTUr+wCeJklydnR09FVzBssuxyAIunO53PE0TQ+JyGYAXQC+1crwkuR9Y8zscmX4DWS98ucU6bk+AAAAAElFTkSuQmCC",import.meta.url).href,alt:"refresh",text:"刷新"}],z=ht(()=>r.isGraphReady?g:g.filter(f=>f.id<=4)),se=h(null),M=h(!1),re=f=>!!((f===3||f===4)&&r.isRunning);function ie(f,P){if(re(f)){f===3?U.warning("工作流运行时无法导入 JSON 文件",{timeout:2e3}):f===4&&U.warning("工作流运行时无法删除节点",{timeout:2e3});return}switch(f){case 1:D();break;case 2:ae();break;case 3:k();break;case 4:he();break;case 5:Ce();break;case 6:Ie();break;case 7:E();break;case 8:C();break;default:console.warn(`No action defined for id: ${f}`)}}const ke=()=>{const P=(r.graph.graph||r.graph).serialize(),Y={format_version:"2.0",name:T.title?T.title:`workflow-${new Date().toISOString().replace(/[:]/g,"-").slice(0,19)}`,description:"",litegraph:P,nodes:[],links:[]};T.title=Y.name;const le=I(window.location.href);return le.workflow_id&&T.owner!=="*"&&(Y.id=le.workflow_id),console.log("graphData.nodes:",P.nodes),P.nodes&&Array.isArray(P.nodes)&&(Y.nodes=P.nodes.map(F=>{const xe=Object.keys(F.properties),be={};return xe.forEach(w=>{var pe;const p=(pe=F.inputs.find(ye=>ye.name===w))==null?void 0:pe.fieldName,L=F.properties[w];be[p]=L}),P.links.find(w=>F.id===w[1]),{uuid:F.flags.uuid,title:F.title||"",name:F.type||"",type:F.type||"",litegraph_id:F.id||0,positionX:F.pos?F.pos[0]:0,positionY:F.pos?F.pos[1]:0,width:F.size?F.size[0]:0,height:F.size?F.size[1]:0,static_input_data:be||{},output_db_id:null}})),P.links&&Array.isArray(P.links)&&(Y.links=P.links.map(F=>{var Be,Ge;const[xe,be,w,p,L,pe]=F,ye=P.nodes.find(Re=>Re.id===be),Te=P.nodes.find(Re=>Re.id===p);return console.log("sourceNode,targetNode:",ye,Te),{uuid:Ut(),litegraph_id:be,status:1,previous_node_uuid:ye.flags.uuid,next_node_uuid:Te.flags.uuid,output_field_name:(Be=Te.inputs[L])==null?void 0:Be.fieldName,input_field_name:(Ge=ye.outputs[w])==null?void 0:Ge.fieldName}})),Y};async function D(){try{const f=JSON.stringify(ke());if(console.log("jsonString:",ke()),ke().nodes.length===0){U.warning("当前工作区域为空，不可保存空白工作流！",{timeout:2e3});return}const P=localStorage.getItem("token"),Y=await fetch("http://localhost:8000/api/workflow/save",{method:"POST",headers:{uid:"0","quantflow-auth":"2","Content-Type":"application/json",Authorization:`${P}`},body:f});if(Y.ok){localStorage.setItem("savedGraph",JSON.stringify(f));const le=await Y.json();if(console.log("data:",le),U.success(T.owner==="*"?"模版工作流克隆成功！":"保存成功！",{timeout:2e3}),T.workflow_id=le.data.workflow_id,T.owner="",T.workflow_id){const F=new URL(window.location.href);F.searchParams.set("workflow_id",T.workflow_id),window.history.replaceState({},"",F)}}else throw new Error(`请求失败: ${Y.status} ${Y.statusText}`)}catch(f){console.error("保存图表时出错:",f),U.error("保存失败！",{timeout:2e3})}}function ae(){const f=JSON.stringify(ke()),P=new Blob([f],{type:"application/json"}),Y=URL.createObjectURL(P),le=document.createElement("a");le.href=Y,le.download=`graph-export-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(le),le.click(),document.body.removeChild(le),URL.revokeObjectURL(Y),console.log("图表已成功导出",f)}function k(){var f;if(T.owner==="*"){U.warning("当前为模版,不支持导入覆盖，请先点击保存按钮创建个人工作流后，再进行导入!",{timeout:2e3});return}if(r.isRunning){U.warning("工作流运行时无法导入 JSON 文件",{timeout:2e3});return}(f=se.value)==null||f.click()}async function o(f){var le;if(r.isRunning){U.warning("工作流运行时无法导入 JSON 文件",{timeout:2e3});return}console.log("开始导入图形");const P=f.target;if(!((le=P.files)!=null&&le.length))return;const Y=P.files[0];try{const F=await Y.text(),xe=JSON.parse(F).litegraph,be=r.graph.graph||r.graph,w=r.canvas;if(!be||!w)return console.error("Graph or Canvas not initialized"),!1;be.clear();try{be.configure(xe),be.nodes.forEach(a=>{a._fullTitle?a.title=a.truncateTitle(a._fullTitle):(a._fullTitle=a.title||"",a.title=a.truncateTitle(a.title||""))}),w.setZoom(1),w.ds.offset=[0,0];let p=1/0,L=-1/0,pe=1/0,ye=-1/0;be.nodes.forEach(a=>{p=Math.min(p,a.pos[0]),L=Math.max(L,a.pos[0]+a.size[0]),pe=Math.min(pe,a.pos[1]),ye=Math.max(ye,a.pos[1]+a.size[1])});const Te=L-p,Be=ye-pe,Ge=p+Te/2,Re=pe+Be/2,et=w.canvas.getBoundingClientRect(),ct=et.width,ze=et.height;return w.ds.offset=[ct/2-Ge,ze/2-Re],be.setDirtyCanvas(!0),w.draw(!0,!0),U.success("导入成功！",{timeout:2e3}),P.value="",!0}catch(p){return console.error("Error configuring graph:",p),U.error("导入失败：图形数据格式不正确",{timeout:2e3}),!1}}catch(F){return console.error("Import failed:",F),U.error("导入失败，请检查文件格式是否正确",{timeout:2e3}),!1}}function he(){if(T.owner==="*"){U.warning("当前为模版,不支持清空!",{timeout:2e3});return}if(r.isRunning){U.warning("工作流运行时无法删除节点",{timeout:2e3});return}try{const f=r.graph.graph||r.graph;confirm("确定要清空当前图表吗？此操作不可撤销。")&&(f.clear(),f.setDirtyCanvas(!0,!0),console.log("图表已清空"),U.success("图表已清空",{timeout:2e3}))}catch(f){console.error("清空图表时出错:",f)}}function Ce(){if(r.canvas)try{const f=r.canvas.ds.scale||1;r.canvas.setZoom(f*Ft),r.canvas.draw(!0,!0)}catch(f){console.error("Zoom in error:",f)}}function Ie(){if(r.canvas)try{const f=r.canvas.ds.scale||1;r.canvas.setZoom(f/Ft),r.canvas.draw(!0,!0)}catch(f){console.error("Zoom out error:",f)}}function E(){r.canvas&&(M.value=!M.value,r.canvas.drag_mode=M.value,M.value?r.canvas.canvas.style.cursor="grab":r.canvas.canvas.style.cursor="default")}function C(){if(r.canvas)try{r.canvas.setZoom(1),r.canvas.ds.offset=[0,0],r.canvas.draw(!0,!0)}catch(f){console.error("Reset view error:",f)}}const ne=()=>{M.value&&(r.canvas.canvas.style.cursor="grabbing")},ge=()=>{M.value&&(r.canvas.canvas.style.cursor="grab")};return ut(()=>{r.canvas&&(r.canvas.canvas.addEventListener("mousedown",ne),r.canvas.canvas.addEventListener("mouseup",ge))}),kt(()=>{r.canvas&&(r.canvas.canvas.removeEventListener("mousedown",ne),r.canvas.canvas.removeEventListener("mouseup",ge))}),(f,P)=>(y(),_(Me,null,[(y(!0),_(Me,null,Je(z.value,Y=>(y(),_("div",{class:je(["toolbar-item",{disabled:re(Y.id)}]),key:Y.id,onClick:le=>ie(Y.id,Y.text)},[e("img",{src:Y.src,alt:Y.alt,width:"17px",height:"19px"},null,8,Ta),e("div",Ua,q(Y.text),1)],10,Ba))),128)),e("input",{type:"file",ref_key:"fileInput",ref:se,style:{display:"none"},accept:".json",onChange:o},null,544)],64))}}),Ma=at(Wa,[["__scopeId","data-v-a322dbff"]]),Oa={class:"table-container"},Ga={class:"table-wrapper"},za={key:0,class:"fixed-column"},Va={class:"scroll-area"},qa={style:{display:"flex",position:"sticky",top:"0","z-index":"99",background:"#292C38",width:"max-content"}},Za=["title"],Qa={__name:"TablesScroll",props:{tableData:{type:Array,required:!0},headers:{type:Array,required:!0},isFixed:{type:Boolean,default:!0},columnWidth:{type:[Number,String],default:0},customHeader:{type:Array,default:[]}},setup(G){Zt(z=>({"55ffc88a":`${G.columnWidth}px`}));const I=G,Q=h(null),T=h(null),U=z=>!isNaN(z)&&Number.isFinite(Number(z))&&String(z).includes(".")?Number(z).toFixed(2):z,r=z=>z?z.replace(/(\d{4})(\d{2})(\d{2})/g,"$1-$2-$3"):"-",g=()=>{Q.value&&T.value&&I.isFixed&&(console.log("-------------"),Q.value.addEventListener("scroll",()=>{console.log(Q.value.scrollTop),T.value.style.top=`-${Q.value.scrollTop}px`}))};return ut(()=>{g()}),(z,se)=>(y(),_("div",Oa,[e("div",Ga,[I.isFixed?(y(),_("div",za,[e("div",{class:"fixed-header",style:Oe({width:`${G.customHeader.length>0?G.customHeader[0].width:G.columnWidth}px`})},q(G.customHeader.length>0?G.customHeader[0].key:I.headers[0]),5),e("div",{class:"fixed-body",ref_key:"fixedBody",ref:T},[(y(!0),_(Me,null,Je(I.tableData,(M,re)=>(y(),_("div",{key:re,class:"fixed-cell",style:Oe({width:`${G.customHeader.length>0?G.customHeader[0].width:G.columnWidth}px`})},q(r(M[I.headers[0]])),5))),128))],512)])):We("",!0),e("div",Va,[e("div",{class:"scroll-body",ref_key:"scrollBody",ref:Q},[e("div",qa,[(y(!0),_(Me,null,Je([...I.headers].splice(I.isFixed?1:0),(M,re)=>(y(),_("div",{key:re,class:"header-cell",style:Oe({width:`${G.customHeader.length>0?G.customHeader[re+1].width:G.columnWidth}px`}),title:M},q(G.customHeader.length>0?G.customHeader[re+1].key:M),13,Za))),128))]),(y(!0),_(Me,null,Je(I.tableData,(M,re)=>(y(),_("div",{key:re,class:"table-row"},[(y(!0),_(Me,null,Je([...I.headers].splice(I.isFixed?1:0),(ie,ke)=>(y(),_("div",{key:ke,class:"table-cell",style:Oe({width:`${G.customHeader.length>0?G.customHeader[ke+1].width:G.columnWidth}px`})},q(U(M[ie])),5))),128))]))),128))],512)])])]))}},Bt=at(Qa,[["__scopeId","data-v-885753ee"]]),Pa={class:"factor-deep"},Ya={class:"factor-deep-header"},Ja={class:"factor-item"},Ha={class:"factor-item-title"},$a={class:"factor-item-content"},Ka={style:{display:"flex","justify-content":"space-between"}},Xa={class:"factor-deep-content",style:{"flex-shrink":"0","flex-basis":"368px","margin-top":"20px"}},ja={class:"data-card",style:{height:"100%"}},eo={class:"data-item"},to={class:"data-item"},ao={class:"data-item"},oo={class:"data-item"},so={class:"value"},ro={key:0,class:"value"},io={key:1,class:"label"},no={class:"factor-item",style:{margin:"0","margin-top":"20px",width:"auto","flex-shrink":"0","flex-grow":"1","flex-basis":"460px","margin-left":"20px"}},lo={class:"factor-item-title"},co={class:"factor-item-content"},uo={style:{width:"100%",height:"400px"}},fo={class:"factor-item",style:{"margin-left":"20px"}},ho={class:"factor-item-title"},go={class:"factor-item-content"},po={style:{width:"100%",height:"400px"}},vo={class:"factor-item-container"},Ao={class:"factor-item"},mo={class:"factor-item-title"},wo={class:"factor-item-content"},yo={class:"factor-item"},xo={class:"factor-item-title"},_o={class:"factor-item-content"},bo={class:"factor-item"},ko={class:"factor-item-title"},Co={class:"factor-item-content"},Lo={class:"factor-item"},So={class:"factor-item-title"},Eo={class:"factor-item-content"},Ro={class:"factor-item"},No={class:"factor-item-title"},Do={class:"factor-item-content"},Io={class:"factor-item"},Fo={class:"factor-item-title"},Bo={class:"factor-item-content"},To={class:"factor-item"},Uo={class:"factor-item-title"},Wo={class:"factor-item-content"},Mo={class:"factor-item"},Oo={class:"factor-item-title"},Go={class:"factor-item-content"},zo={class:"factor-item"},Vo={class:"factor-item-title"},qo={class:"factor-item-content"},Zo={class:"factor-item"},Qo={class:"factor-item-title"},Po={class:"factor-item-content"},Se="#7d7d7d",Yo=lt({__name:"FactorDeep",props:{factorId:{type:String,required:!0},taskId:{type:String,requfactorIdired:!0},into:{type:Boolean,required:!0,default:!1}},setup(G){const I=t=>"",Q=t=>t,T=(t,we)=>{if(typeof t=="number")return parseFloat(t.toFixed(we));if(typeof t=="string"&&!isNaN(t)&&t.includes("."))return parseFloat(Number(t).toFixed(we));if(Array.isArray(t))return t.map(S=>T(S));if(typeof t=="object"&&t!==null){const S={};for(const N in t)t.hasOwnProperty(N)&&(S[N]=T(t[N]));return S}return t},U=t=>!isNaN(t)&&Number.isFinite(Number(t))&&String(t).includes(".")?Number(t).toFixed(2):t,r=G;Qt();const g=h(!1),z=t=>{const we=parseFloat(t);return we>0?"#ff4851":we<0?"#2fae34":"#333"},se=h({annualized_ratio:0,maximum_drawdown:0,return_ratio:0,sharpe_ratio:0}),M=async()=>{var S,N,V,O,X,j,ee,te;const{json:t,httpController:we}=await Xt(r.taskId||I());se.value={annualized_ratio:Q((N=(S=t==null?void 0:t.data)==null?void 0:S.one_group_data)==null?void 0:N.annualized_ratio),maximum_drawdown:Q((O=(V=t==null?void 0:t.data)==null?void 0:V.one_group_data)==null?void 0:O.maximum_drawdown),return_ratio:Q((j=(X=t==null?void 0:t.data)==null?void 0:X.one_group_data)==null?void 0:j.return_ratio),sharpe_ratio:Q((te=(ee=t==null?void 0:t.data)==null?void 0:ee.one_group_data)==null?void 0:te.sharpe_ratio)}};let re=null;const ie=h(null),ke=h(""),D=h({}),ae=async()=>{var N,V,O,X,j,ee,te,ue,fe,W,B,v,x,d,c,l;const{json:t,httpController:we}=await jt((r==null?void 0:r.taskId)||I());if(t.code==="200"&&(ke.value=(V=(N=t==null?void 0:t.data)==null?void 0:N.return_chart)==null?void 0:V.title,D.value=(O=t==null?void 0:t.data)==null?void 0:O.return_chart,ie.value)){if(re=Qe(ie.value),Object.keys(D.value).length==0)return;var S={code:"200",message:"查询成功",data:{task_id:"bbf3bbc030a94849bea4810058eec027",return_chart:{title:"python 5 groups return",x:[{name:"date",data:(j=(X=D.value)==null?void 0:X.x[0])==null?void 0:j.data}],y:(ee=D.value)==null?void 0:ee.y}}};const u=(W=(fe=(ue=(te=S==null?void 0:S.data)==null?void 0:te.return_chart)==null?void 0:ue.x[0])==null?void 0:fe.data)==null?void 0:W.map(R=>R.split(" ")[0]),b=(x=(v=(B=S==null?void 0:S.data)==null?void 0:B.return_chart)==null?void 0:v.y)==null?void 0:x.map(R=>R.name),A=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFCC5C","#FF6F69","#88D8B0","#6C88C4","#FFA07A","#98FB98","#87CEEB","#DDA0DD"].sort(()=>Math.random()-.5),de=(l=(c=(d=S==null?void 0:S.data)==null?void 0:d.return_chart)==null?void 0:c.y)==null?void 0:l.map((R,K)=>{var qe;return(qe=R==null?void 0:R.data)==null?void 0:qe.map((it,nt)=>({value:[nt,K,Number(it).toFixed(2)],itemStyle:{color:A[K%A.length]}}))}).flat(),$={title:{left:"center"},tooltip:{show:!1,axisPointer:{show:!1}},grid3D:{viewControl:{projection:"orthographic",autoRotate:!0,distance:200,beta:45,alpha:25},boxWidth:70,boxHeight:70,boxDepth:200,light:{main:{intensity:1.2}},top:"0%",bottom:"10%"},xAxis3D:{type:"category",data:u==null?void 0:u.map(R=>R.split(" ")[0]),name:"",axisLabel:{interval:Math.floor((u==null?void 0:u.length)/10),rotate:45,margin:20,textStyle:{fontSize:10,color:Se}},nameTextStyle:{fontSize:14,margin:30}},yAxis3D:{type:"category",data:b,name:"",axisLabel:{color:Se}},zAxis3D:{type:"value",name:"",axisLabel:{color:Se}},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100},{type:"inside",xAxisIndex:0,start:0,end:100}],series:[{type:"bar3D",data:de,shading:"lambert",label:{show:!1}}]};re.setOption($)}},k=h("分组收益"),o=h([]),he=h({}),Ce=async()=>{var S,N;const{json:t,httpController:we}=await ea((r==null?void 0:r.taskId)||I());t.code==="200"&&(he.value=(S=t==null?void 0:t.data)==null?void 0:S.group_return_analysis,o.value=Object.keys((N=t==null?void 0:t.data)==null?void 0:N.group_return_analysis[0]))},Ie=h("最新数据"),E=h([]),C=h({}),ne=h([{key:"时间",width:130},{key:"股票代码",width:100},{key:"名称",width:100},{key:"因子值",width:80}]),ge=async()=>{var S,N;const{json:t,httpController:we}=await ta((r==null?void 0:r.taskId)||I());t.code==="200"&&(C.value=(S=t==null?void 0:t.data)==null?void 0:S.last_date_top_factor,E.value=Object.keys((N=t==null?void 0:t.data)==null?void 0:N.last_date_top_factor[0]))};let f=null;const P=h(null),Y=h(""),le=h({}),F=async()=>{var N,V,O,X,j,ee,te,ue,fe;const{json:t,httpController:we}=await aa((r==null?void 0:r.taskId)||I());if(t.code==="200"&&(Y.value=(V=(N=t==null?void 0:t.data)==null?void 0:N.ic_decay_chart)==null?void 0:V.title,console.log("还需处理-----------------",T((O=t==null?void 0:t.data)==null?void 0:O.ic_decay_chart,3)),le.value=(X=t==null?void 0:t.data)==null?void 0:X.ic_decay_chart,P.value)){if(f=Qe(P.value),Object.keys(le.value).length==0)return;const W=(ee=(j=le.value)==null?void 0:j.x[0])==null?void 0:ee.data,B=(fe=(ue=(te=le.value)==null?void 0:te.y[0])==null?void 0:ue.data)==null?void 0:fe.map((v,x)=>({value:v,itemStyle:{color:v>0?"#ff0000":"#3498db"}}));var S={title:{},tooltip:{trigger:"axis",formatter:function(v){return v.map(x=>{let d=x.value;const c=x.color;if(Array.isArray(d)){const l=d.map(u=>u==null||isNaN(u)?"--":Number(u).toFixed(4));return`<span style="color:${c}">${x.seriesName}</span>: ${l[0]}, ${l[1]}`}return d=d==null||isNaN(d)?"--":Number(d).toFixed(4),`<span style="color:${c}">${x.seriesName}</span>: ${d}`}).join("<br/>")}},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100}],xAxis:[{type:"category",data:W,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(v,x){const d=W.length,c=40,l=f.getWidth(),u=Math.floor(l/c),b=Math.floor((d-1)/(u-1));return(d-1-v)%b===0}},show:!1},{type:"category",data:W,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(v,x){const d=W.length,c=40,l=f.getWidth(),u=Math.floor(l/c),b=Math.floor((d-1)/(u-1));return(d-1-v)%b===0}},position:"bottom"}],yAxis:[{type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",color:Se}}}],series:[{name:"IC值",type:"bar",data:B,label:{show:!1,position:"bottom",formatter:function(v){return v.value?v.value.toFixed(2):""}}},{name:"IC趋势",type:"line",smooth:!1,showSymbol:!1,data:le.value.y[0].data,lineStyle:{color:"#ff0000",width:0}}]};f.setOption(S)}};let xe=null;const be=h(null),w=h(""),p=h({}),L=async()=>{var N,V,O,X,j,ee,te,ue,fe;const{json:t,httpController:we}=await oa((r==null?void 0:r.taskId)||I());if(t.code==="200"&&(console.log("json",t),w.value=(V=(N=t==null?void 0:t.data)==null?void 0:N.ic_den_chart)==null?void 0:V.title,p.value=(O=t==null?void 0:t.data)==null?void 0:O.ic_den_chart,be.value)){if(xe=Qe(be.value),Object.keys(p.value).length==0)return;var S={title:{},tooltip:{trigger:"axis",formatter:function(W){return W.map(B=>{let v=B.value;const x=B.color;if(Array.isArray(v)){const d=v.map(c=>c==null||isNaN(c)?"--":Number(c).toFixed(4));return`<span style="color:${x}">${B.seriesName}</span>: ${d[0]}, ${d[1]}`}return v=v==null||isNaN(v)?"--":Number(v).toFixed(4),`<span style="color:${x}">${B.seriesName}</span>: ${v}`}).join("<br/>")}},legend:{data:["Histogram","Density Curve"],top:"0px",textStyle:{color:Se}},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100},{type:"inside",xAxisIndex:0,start:0}],xAxis:{type:"value",boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!0,lineStyle:{type:"dashed",color:Se}}},yAxis:{type:"value",axisLine:{onZero:!1,show:!1},axisTick:{show:!1},position:"left",splitLine:{show:!0,lineStyle:{type:"dashed",color:Se}}},series:[{name:"Histogram",type:"bar",data:(ee=(j=(X=p.value)==null?void 0:X.y[0])==null?void 0:j.data)==null?void 0:ee.map((W,B)=>{var v,x;return[(x=(v=p.value)==null?void 0:v.x[0])==null?void 0:x.data[B],W]}),itemStyle:{color:"rgba(135, 206, 235, 0.6)"}},{name:"Density Curve",type:"line",smooth:!0,data:(fe=(ue=(te=p.value)==null?void 0:te.y[1])==null?void 0:ue.data)==null?void 0:fe.map((W,B)=>{var v,x;return[(x=(v=p.value)==null?void 0:v.x[0])==null?void 0:x.data[B],W]}),itemStyle:{color:"#1E90FF"},lineStyle:{width:2}}]};xe.setOption(S)}};let pe=null;const ye=h(null),Te=h(""),Be=h({}),Ge=async()=>{var N,V,O,X,j,ee,te,ue,fe,W,B,v,x;const{json:t,httpController:we}=await sa((r==null?void 0:r.taskId)||I());if(t.code==="200"&&(Te.value=(V=(N=t==null?void 0:t.data)==null?void 0:N.ic_seq_chart)==null?void 0:V.title,Be.value=(O=t==null?void 0:t.data)==null?void 0:O.ic_seq_chart,console.log("echartsRefICSequenceData",Be.value),ye.value)){if(pe=Qe(ye.value),Object.keys(Be.value).length==0)return;var S={title:{left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(d){return d.map(c=>{let l=c.value;const u=c.color;if(Array.isArray(l)){const b=l.map(A=>A==null||isNaN(A)?"--":Number(A).toFixed(4));return`<span style="color:${u}">${c.seriesName}</span>: ${b[0]}, ${b[1]}`}return l=l==null||isNaN(l)?"--":Number(l).toFixed(4),`<span style="color:${u}">${c.seriesName}</span>: ${l}`}).join("<br/>")}},legend:{data:(j=(X=Be.value)==null?void 0:X.y)==null?void 0:j.map(d=>d.name),top:"0px",selected:{IC:!0,Cum_IC:!1},textStyle:{color:Se}},grid:{left:"3%",right:"4%",bottom:"2%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100}],xAxis:[{type:"category",data:(ue=(te=(ee=Be.value)==null?void 0:ee.x[0])==null?void 0:te.data)==null?void 0:ue.map(d=>d.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(d,c){var $,R,K;const l=(K=(R=($=Be.value)==null?void 0:$.x[0])==null?void 0:R.data)==null?void 0:K.length,u=40,b=pe.getWidth(),A=Math.floor(b/u),de=Math.floor((l-1)/(A-1));return(l-1-d)%de===0}},show:!1},{type:"category",data:(B=(W=(fe=Be.value)==null?void 0:fe.x[0])==null?void 0:W.data)==null?void 0:B.map(d=>d.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(d,c){var $,R,K;const l=(K=(R=($=Be.value)==null?void 0:$.x[0])==null?void 0:R.data)==null?void 0:K.length,u=40,b=pe.getWidth(),A=Math.floor(b/u),de=Math.floor((l-1)/(A-1));return(l-1-d)%de===0}},position:"bottom"}],yAxis:{type:"value",axisLabel:{interval:1e3},splitLine:{show:!0,lineStyle:{type:"dashed",color:Se}}},series:(x=(v=Be.value)==null?void 0:v.y)==null?void 0:x.map(d=>({name:d.name,data:d.data,type:d.name==="IC"?"bar":"line",itemStyle:{color:d.name==="IC"?"#3498db":"#e74c3c"},label:{show:!1,position:"top",formatter:function(c){return c.data.toFixed(3)}}}))};pe.setOption(S)}};let Re=null;const et=h(null),ct=h(""),ze=h({}),a=async()=>{var N,V,O,X,j,ee,te,ue,fe,W,B,v,x;const{json:t,httpController:we}=await ra((r==null?void 0:r.taskId)||I());if(t.code==="200"&&(ct.value=(V=(N=t==null?void 0:t.data)==null?void 0:N.ic_self_correlation_chart)==null?void 0:V.title,ze.value=(O=t==null?void 0:t.data)==null?void 0:O.ic_self_correlation_chart,et.value)){if(Re=Qe(et.value),Object.keys(ze.value).length==0)return;var S={title:{},tooltip:{trigger:"axis",formatter:function(d){return d.map(c=>{let l=c.value;const u=c.color;if(Array.isArray(l)){const b=l.map(A=>A==null||isNaN(A)?"--":Number(A).toFixed(4));return`<span style="color:${u}">${c.seriesName}</span>: ${b[0]}, ${b[1]}`}return l=l==null||isNaN(l)?"--":Number(l).toFixed(4),`<span style="color:${u}">${c.seriesName}</span>: ${l}`}).join("<br/>")}},legend:{data:["自相关系数","下限(95%置信区间)","上限(95%置信区间)"],top:"0px",textStyle:{color:Se}},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100}],xAxis:[{type:"category",data:(j=(X=ze.value)==null?void 0:X.x[0])==null?void 0:j.data,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(d,c){var $,R,K;const l=(K=(R=($=ze.value)==null?void 0:$.x[0])==null?void 0:R.data)==null?void 0:K.length,u=40,b=Re.getWidth(),A=Math.floor(b/u),de=Math.floor((l-1)/(A-1));return(l-1-d)%de===0}},show:!1},{type:"category",data:(te=(ee=ze.value)==null?void 0:ee.x[0])==null?void 0:te.data,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(d,c){var $,R,K;const l=(K=(R=($=ze.value)==null?void 0:$.x[0])==null?void 0:R.data)==null?void 0:K.length,u=40,b=Re.getWidth(),A=Math.floor(b/u),de=Math.floor((l-1)/(A-1));return(l-1-d)%de===0}},position:"bottom"}],yAxis:{type:"value",min:-1,max:1,interval:.2,splitLine:{show:!0,lineStyle:{type:"dashed",color:Se}}},series:[{name:"自相关系数",type:"line",data:(fe=(ue=ze.value)==null?void 0:ue.y[0])==null?void 0:fe.data,symbol:"circle",symbolSize:8,lineStyle:{width:2},itemStyle:{color:"#3498db"},label:{show:!1,position:"top",formatter:function(d){return d.value.toFixed(3)}}},{name:"下限(95%置信区间)",type:"line",data:(B=(W=ze.value)==null?void 0:W.y[1])==null?void 0:B.data,lineStyle:{type:"dashed",width:1},itemStyle:{color:"#95a5a6"},symbol:"none"},{name:"上限(95%置信区间)",type:"line",data:(x=(v=ze.value)==null?void 0:v.y[2])==null?void 0:x.data,lineStyle:{type:"dashed",width:1},itemStyle:{color:"#95a5a6"},symbol:"none"}]};Re.setOption(S)}};let s=null;const n=h(null),i=h(""),m=h({}),J=async()=>{var N,V,O,X,j,ee,te,ue,fe,W;const{json:t,httpController:we}=await ia((r==null?void 0:r.taskId)||I());if(t.code==="200"&&(i.value=(V=(N=t==null?void 0:t.data)==null?void 0:N.rank_ic_decay_chart)==null?void 0:V.title,m.value=(O=t==null?void 0:t.data)==null?void 0:O.rank_ic_decay_chart,n.value)){if(s=Qe(n.value),Object.keys(m.value).length==0)return;const B=(j=(X=m.value)==null?void 0:X.x[0])==null?void 0:j.data,v=(ue=(te=(ee=m.value)==null?void 0:ee.y[0])==null?void 0:te.data)==null?void 0:ue.map((x,d)=>({value:x,itemStyle:{color:x>0?"#ff0000":"#3498db"}}));var S={title:{},tooltip:{trigger:"axis",formatter:function(x){return x.map(d=>{let c=d.value;const l=d.color;if(Array.isArray(c)){const u=c.map(b=>b==null||isNaN(b)?"--":Number(b).toFixed(4));return`<span style="color:${l}">${d.seriesName}</span>: ${u[0]}, ${u[1]}`}return c=c==null||isNaN(c)?"--":Number(c).toFixed(4),`<span style="color:${l}">${d.seriesName}</span>: ${c}`}).join("<br/>")}},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100}],xAxis:[{type:"category",data:B,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(x,d){const c=B.length,l=40,u=s.getWidth(),b=Math.floor(u/l),A=Math.floor((c-1)/(b-1));return(c-1-x)%A===0}},show:!1},{type:"category",data:B,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(x,d){const c=B.length,l=40,u=s.getWidth(),b=Math.floor(u/l),A=Math.floor((c-1)/(b-1));return(c-1-x)%A===0}},position:"bottom"}],yAxis:[{type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",color:Se}}}],series:[{name:"IC值",type:"bar",data:v,label:{show:!1,position:"bottom",formatter:function(x){return x.value?x.value.toFixed(3):""}}},{name:"IC趋势",type:"line",smooth:!1,showSymbol:!1,data:(W=(fe=m.value)==null?void 0:fe.y[0])==null?void 0:W.data,lineStyle:{color:"#000000",width:0}}]};s.setOption(S)}};let oe=null;const Ae=h(null),Ne=h(""),H=h({}),ce=async()=>{var N,V,O,X,j,ee,te,ue,fe;const{json:t,httpController:we}=await na((r==null?void 0:r.taskId)||I());if(t.code==="200"&&(Ne.value=(V=(N=t==null?void 0:t.data)==null?void 0:N.rank_ic_den_chart)==null?void 0:V.title,H.value=(O=t==null?void 0:t.data)==null?void 0:O.rank_ic_den_chart,Ae.value)){if(oe=Qe(Ae.value),Object.keys(H.value).length==0)return;var S={title:{},tooltip:{trigger:"axis",formatter:function(W){return W.map(B=>{let v=B.value;const x=B.color;if(Array.isArray(v)){const d=v.map(c=>c==null||isNaN(c)?"--":Number(c).toFixed(4));return`<span style="color:${x}">${B.seriesName}</span>: ${d[0]}, ${d[1]}`}return v=v==null||isNaN(v)?"--":Number(v).toFixed(4),`<span style="color:${x}">${B.seriesName}</span>: ${v}`}).join("<br/>")}},legend:{data:["Histogram","Density Curve"],top:"0px",textStyle:{color:Se}},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100},{type:"inside",xAxisIndex:0,zoomOnMouseWheel:!1,start:0}],xAxis:{type:"value",boundaryGap:!1,axisLine:{onZero:!1},axisLabel:{formatter:"{value}"},splitLine:{show:!0,lineStyle:{type:"dashed",color:Se}}},yAxis:{type:"value",axisLine:{onZero:!1,show:!1},axisTick:{show:!1},position:"left",splitLine:{show:!0,lineStyle:{type:"dashed",color:Se}}},series:[{name:"Histogram",type:"bar",data:(ee=(j=(X=H.value)==null?void 0:X.y[0])==null?void 0:j.data)==null?void 0:ee.map((W,B)=>{var v,x;return[(x=(v=H.value)==null?void 0:v.x[0])==null?void 0:x.data[B],W]}),itemStyle:{color:"rgba(135, 206, 235, 0.6)"}},{name:"Density Curve",type:"line",smooth:!0,data:(fe=(ue=(te=H.value)==null?void 0:te.y[1])==null?void 0:ue.data)==null?void 0:fe.map((W,B)=>{var v,x;return[(x=(v=H.value)==null?void 0:v.x[0])==null?void 0:x.data[B],W]}),itemStyle:{color:"#1E90FF"},lineStyle:{width:2}}]};oe.setOption(S)}};let Z=null;const _e=h(null),ve=h(""),me=h({}),Fe=async()=>{var N,V,O,X,j,ee,te,ue,fe,W,B,v,x;const{json:t,httpController:we}=await la(r.taskId||I());if(t.code==="200"&&(ve.value=(V=(N=t==null?void 0:t.data)==null?void 0:N.rank_ic_seq_chart)==null?void 0:V.title,me.value=(O=t==null?void 0:t.data)==null?void 0:O.rank_ic_seq_chart,_e.value)){if(Z=Qe(_e.value),Object.keys(me.value).length==0)return;var S={title:{left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(d){return d.map(c=>{let l=c.value;const u=c.color;if(Array.isArray(l)){const b=l.map(A=>A==null||isNaN(A)?"--":Number(A).toFixed(4));return`<span style="color:${u}">${c.seriesName}</span>: ${b[0]}, ${b[1]}`}return l=l==null||isNaN(l)?"--":Number(l).toFixed(4),`<span style="color:${u}">${c.seriesName}</span>: ${l}`}).join("<br/>")}},legend:{data:(j=(X=me.value)==null?void 0:X.y)==null?void 0:j.map(d=>d.name),top:"0px",selected:{IC:!0,Cum_IC:!1},textStyle:{color:Se}},grid:{left:"3%",right:"4%",bottom:"1%",top:"15%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100}],xAxis:[{type:"category",data:(ue=(te=(ee=me.value)==null?void 0:ee.x[0])==null?void 0:te.data)==null?void 0:ue.map(d=>d.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(d,c){var $,R,K;const l=(K=(R=($=me.value)==null?void 0:$.x[0])==null?void 0:R.data)==null?void 0:K.length,u=40,b=Z.getWidth(),A=Math.floor(b/u),de=Math.floor((l-1)/(A-1));return(l-1-d)%de===0}},show:!1},{type:"category",data:(B=(W=(fe=me.value)==null?void 0:fe.x[0])==null?void 0:W.data)==null?void 0:B.map(d=>d.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(d,c){var $,R,K;const l=(K=(R=($=me.value)==null?void 0:$.x[0])==null?void 0:R.data)==null?void 0:K.length,u=40,b=Z.getWidth(),A=Math.floor(b/u),de=Math.floor((l-1)/(A-1));return(l-1-d)%de===0}},position:"bottom"}],yAxis:{type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",color:Se}}},series:(x=(v=me.value)==null?void 0:v.y)==null?void 0:x.map(d=>({name:d.name,data:d.data,type:d.name==="Rank_IC"?"bar":"line",itemStyle:{color:d.name==="IC"?"#3498db":"#e74c3c"},showSymbol:!1,label:{show:!1,position:"top",formatter:function(c){return c.data.toFixed(3)}}}))};Z.setOption(S)}};let Ee=null;const Ze=h(null),Ue=h(""),Ve=h({}),tt=async()=>{var N,V,O,X,j,ee,te,ue,fe,W,B,v,x;const{json:t,httpController:we}=await ca((r==null?void 0:r.taskId)||I());if(t.code==="200"&&(Ue.value=(V=(N=t==null?void 0:t.data)==null?void 0:N.rank_ic_self_correlation_chart)==null?void 0:V.title,Ve.value=(O=t==null?void 0:t.data)==null?void 0:O.rank_ic_self_correlation_chart,Ze.value)){if(Ee=Qe(Ze.value),Object.keys(Ve.value).length==0)return;var S={title:{},tooltip:{trigger:"axis",formatter:function(d){return d.map(c=>{let l=c.value;const u=c.color;if(Array.isArray(l)){const b=l.map(A=>A==null||isNaN(A)?"--":Number(A).toFixed(4));return`<span style="color:${u}">${c.seriesName}</span>: ${b[0]}, ${b[1]}`}return l=l==null||isNaN(l)?"--":Number(l).toFixed(4),`<span style="color:${u}">${c.seriesName}</span>: ${l}`}).join("<br/>")}},legend:{data:["自相关系数","下限(95%置信区间)","上限(95%置信区间)"],top:"0px",textStyle:{color:Se}},grid:{left:"3%",right:"4%",bottom:"10%",top:"10%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:0,start:0,end:100}],xAxis:[{type:"category",data:(j=(X=Ve.value)==null?void 0:X.x[0])==null?void 0:j.data,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(d,c){var $,R,K;const l=(K=(R=($=Ve.value)==null?void 0:$.x[0])==null?void 0:R.data)==null?void 0:K.length,u=40,b=Ee.getWidth(),A=Math.floor(b/u),de=Math.floor((l-1)/(A-1));return(l-1-d)%de===0}},show:!1},{type:"category",data:(te=(ee=Ve.value)==null?void 0:ee.x[0])==null?void 0:te.data,axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(d,c){var $,R,K;const l=(K=(R=($=Ve.value)==null?void 0:$.x[0])==null?void 0:R.data)==null?void 0:K.length,u=40,b=Ee.getWidth(),A=Math.floor(b/u),de=Math.floor((l-1)/(A-1));return(l-1-d)%de===0}},position:"bottom"}],yAxis:{type:"value",min:-1,max:1,interval:.2,splitLine:{show:!0,lineStyle:{type:"dashed",color:Se}}},series:[{name:"自相关系数",type:"line",data:(fe=(ue=Ve.value)==null?void 0:ue.y[0])==null?void 0:fe.data,symbol:"circle",symbolSize:8,lineStyle:{width:2},itemStyle:{color:"#3498db"},label:{show:!1,position:"top",formatter:function(d){return d.value.toFixed(3)}}},{name:"下限(95%置信区间)",type:"line",data:(B=(W=Ve.value)==null?void 0:W.y[1])==null?void 0:B.data,lineStyle:{type:"dashed",width:1},itemStyle:{color:"#95a5a6"},symbol:"none"},{name:"上限(95%置信区间)",type:"line",data:(x=(v=Ve.value)==null?void 0:v.y[2])==null?void 0:x.data,lineStyle:{type:"dashed",width:1},itemStyle:{color:"#95a5a6"},symbol:"none"}]};Ee.setOption(S)}};let $e=null;const yt=h(null),Ct=h(""),ot=h({}),gt=async()=>{var S,N,V,O,X,j,ee,te,ue,fe,W,B,v,x,d,c;const{json:t,httpController:we}=await da((r==null?void 0:r.taskId)||I());if(t.code==="200"&&((V=(N=(S=t==null?void 0:t.data)==null?void 0:S.return_chart)==null?void 0:N.y)==null||V.forEach(l=>{l.data=l.data.map(u=>U(u*100))}),Ct.value=(X=(O=t==null?void 0:t.data)==null?void 0:O.return_chart)==null?void 0:X.title,ot.value=(j=t==null?void 0:t.data)==null?void 0:j.return_chart,yt.value)){if($e=Qe(yt.value),Object.keys(ot.value).length==0)return;const l={title:{},tooltip:{trigger:"axis",formatter:function(u){return u.map(b=>{let A=b.value;const de=b.color;if(Array.isArray(A)){const $=A.map(R=>R==null||isNaN(R)?"--":Number(R).toFixed(4));return`<span style="color:${de}">${b.seriesName}</span>: ${$[0]}, ${$[1]}`}return A=A==null||isNaN(A)?"--":Number(A).toFixed(4),`<span style="color:${de}">${b.seriesName}</span>: ${A}%`}).join("<br/>")}},legend:{data:(te=(ee=ot.value)==null?void 0:ee.y)==null?void 0:te.map(u=>u.name),textStyle:{color:Se}},xAxis:[{type:"category",data:(W=(fe=(ue=ot.value)==null?void 0:ue.x[0])==null?void 0:fe.data)==null?void 0:W.map(u=>Rt(u)),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(u,b){var qe,it,nt;const A=(nt=(it=(qe=ot.value)==null?void 0:qe.x[0])==null?void 0:it.data)==null?void 0:nt.length,de=60,$=$e.getWidth(),R=Math.floor($/de),K=Math.floor((A-1)/(R-1));return(A-1-u)%K===0}},show:!1},{type:"category",data:(x=(v=(B=ot.value)==null?void 0:B.x[0])==null?void 0:v.data)==null?void 0:x.map(u=>Rt(u)),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(u,b){var qe,it,nt;const A=(nt=(it=(qe=ot.value)==null?void 0:qe.x[0])==null?void 0:it.data)==null?void 0:nt.length,de=60,$=$e.getWidth(),R=Math.floor($/de),K=Math.floor((A-1)/(R-1));return(A-1-u)%K===0}},position:"bottom"}],yAxis:{type:"value",axisLabel:{formatter:"{value}%"},splitLine:{show:!0,lineStyle:{type:"dashed",color:Se}}},grid:{left:"3%",right:"4%",bottom:"0%",top:"10%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100}],series:(c=(d=ot.value)==null?void 0:d.y)==null?void 0:c.map(u=>({name:u.name,type:"line",data:u.data,showSymbol:!1}))};$e.setOption(l)}};let Ke=null;const xt=h(null),Lt=h(""),st=h({}),pt=async()=>{var N,V,O,X,j,ee,te,ue,fe,W,B,v,x;const{json:t,httpController:we}=await ua((r==null?void 0:r.taskId)||I());if(t.code==="200"&&(Lt.value=(V=(N=t==null?void 0:t.data)==null?void 0:N.excess_chart)==null?void 0:V.title,st.value=(O=t==null?void 0:t.data)==null?void 0:O.excess_chart,xt.value)){if(Ke=Qe(xt.value),Object.keys(st.value).length==0)return;const d=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#0099cc","#ff00ff"];var S={title:{},tooltip:{trigger:"axis",formatter:function(c){return c.map(l=>{let u=l.value;const b=l.color;if(Array.isArray(u)){const A=u.map(de=>de==null||isNaN(de)?"--":Number(de).toFixed(4));return`<span style="color:${b}">${l.seriesName}</span>: ${A[0]}, ${A[1]}`}return u=u==null||isNaN(u)?"--":Number(u).toFixed(4),`<span style="color:${b}">${l.seriesName}</span>: ${u}`}).join("<br/>")}},legend:{data:(j=(X=st.value)==null?void 0:X.y)==null?void 0:j.map(c=>c.name),top:"0px",textStyle:{color:Se,fontSize:10}},grid:{left:"3%",right:"4%",bottom:"0%",top:"10%",containLabel:!0},dataZoom:[{type:"slider",xAxisIndex:[0,1],start:0,end:100}],xAxis:[{type:"category",data:(ue=(te=(ee=st.value)==null?void 0:ee.x[0])==null?void 0:te.data)==null?void 0:ue.map(c=>c.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(c,l){var R,K,qe;const u=(qe=(K=(R=st.value)==null?void 0:R.x[0])==null?void 0:K.data)==null?void 0:qe.length,b=40,A=Ke.getWidth(),de=Math.floor(A/b),$=Math.floor((u-1)/(de-1));return(u-1-c)%$===0}},show:!1},{type:"category",data:(B=(W=(fe=st.value)==null?void 0:fe.x[0])==null?void 0:W.data)==null?void 0:B.map(c=>c.split(" ")[0]),axisTick:{show:!0,alignWithLabel:!0},axisLabel:{rotate:45,interval:function(c,l){var R,K,qe;const u=(qe=(K=(R=st.value)==null?void 0:R.x[0])==null?void 0:K.data)==null?void 0:qe.length,b=40,A=Ke.getWidth(),de=Math.floor(A/b),$=Math.floor((u-1)/(de-1));return(u-1-c)%$===0}},position:"bottom"}],yAxis:{type:"value",axisLabel:{formatter:c=>(c*100).toFixed(1)+"%"}},series:(x=(v=st.value)==null?void 0:v.y)==null?void 0:x.map((c,l)=>({name:c.name,type:"line",data:c.data,symbol:"circle",symbolSize:6,showSymbol:!1,lineStyle:{width:(c.name.includes("多空组合"),1)},itemStyle:{color:d[l]}}))};Ke.setOption(S)}};He(()=>r.factorId,async()=>{r.into&&(console.log("加载mc3"),await vt(),await M(),await Ce(),await ge(),await ae(),await F(),await L(),await Ge(),await a(),await J(),await ce(),await Fe(),await tt(),await gt(),await pt(),await Xe(),rt())}),He(()=>r.taskId,async()=>{r.into&&(console.log("加载mc2"),await Xe(),rt(),await vt(),await M(),await Xe(),await Ce(),await ge(),await ae(),await F(),await L(),await Ge(),await a(),await J(),await ce(),await Fe(),await tt(),await gt(),await pt(),await Xe(),setTimeout(()=>{rt()},1200))}),He(()=>r.into,async()=>{r.into&&(console.log("加载mc1"),await vt(),await M(),await Ce(),await ge(),await ae(),await F(),await L(),await Ge(),await a(),await J(),await ce(),await Fe(),await tt(),await gt(),await pt(),await Xe(),rt())}),He(()=>r.into,async()=>{await Xe(),rt()});const rt=()=>{re==null||re.resize(),f==null||f.resize(),xe==null||xe.resize(),pe==null||pe.resize(),Re==null||Re.resize(),s==null||s.resize(),oe==null||oe.resize(),Z==null||Z.resize(),Ee==null||Ee.resize(),$e==null||$e.resize(),Ke==null||Ke.resize()},Ot=()=>{re==null||re.dispose(),f==null||f.dispose(),xe==null||xe.dispose(),pe==null||pe.dispose(),Re==null||Re.dispose(),s==null||s.dispose(),oe==null||oe.dispose(),Z==null||Z.dispose(),Ee==null||Ee.dispose(),$e==null||$e.dispose(),Ke==null||Ke.dispose()},St=h([]),vt=async()=>{var S;const{json:t,httpController:we}=await fa((r==null?void 0:r.taskId)||I());St.value=(S=t==null?void 0:t.data)==null?void 0:S.factor_data_analysis},Et=h(!0);ut(async()=>{try{r.into&&(await vt(),await M(),await Ce(),await ge(),await ae(),await F(),await L(),await Ge(),await a(),await J(),await ce(),await Fe(),await tt(),await gt(),await pt(),Et.value=!1,await Xe(),rt())}catch{g.value,Et.value=!0}window.addEventListener("resize",rt)}),kt(()=>{window.removeEventListener("resize",rt),Ot()});const Rt=t=>t&&t.split(" ")[0];return(t,we)=>(y(),_("div",Pa,[e("div",Ya,[e("div",Ja,[e("div",Ha,q(ke.value),1),e("div",$a,[e("div",{ref_key:"echartsRefEarningsBigChart",ref:yt,style:{width:"100%",height:"400px"}},[Le(Pe,{visible:!0})],512)])]),e("div",Ka,[e("div",Xa,[e("div",ja,[e("div",eo,[e("div",{class:"value",style:Oe({color:z(se.value.return_ratio)})},q(se.value.return_ratio),5),we[0]||(we[0]=e("div",{class:"label"},"因子收益",-1))]),e("div",to,[e("div",{class:"value",style:Oe({color:z(se.value.sharpe_ratio)})},q(se.value.sharpe_ratio),5),we[1]||(we[1]=e("div",{class:"label"},"夏普比率",-1))]),e("div",ao,[e("div",{class:"value",style:Oe({color:z(se.value.annualized_ratio)})},q(se.value.annualized_ratio),5),we[2]||(we[2]=e("div",{class:"label"},"年化收益",-1))]),e("div",oo,[e("div",so,q(se.value.maximum_drawdown),1),we[3]||(we[3]=e("div",{class:"label"},"最大回撤",-1))]),(y(!0),_(Me,null,Je(St.value,(S,N)=>(y(),_("div",{key:N,class:"data-item"},[(y(!0),_(Me,null,Je(Object.values(S),(V,O)=>(y(),_(Me,{key:O},[O==1?(y(),_("div",ro,q(V),1)):We("",!0),O==0?(y(),_("div",io,q(V),1)):We("",!0)],64))),128))]))),128))])]),e("div",no,[e("div",lo,q(Ie.value),1),e("div",co,[e("div",uo,[Le(Bt,{tableData:C.value,headers:E.value,isFixed:!0,"custom-header":ne.value},null,8,["tableData","headers","custom-header"])])])]),e("div",fo,[e("div",ho,q(k.value),1),e("div",go,[e("div",po,[Le(Bt,{tableData:he.value,headers:o.value,isFixed:!0,"column-width":110},null,8,["tableData","headers"])])])])]),e("div",vo,[e("div",Ao,[e("div",mo,q(Y.value),1),e("div",wo,[e("div",{ref_key:"echartsRefSimDietrich",ref:P,style:{width:"100%",height:"400px"}},[Le(Pe,{visible:!0})],512)])]),e("div",yo,[e("div",xo,q(w.value),1),e("div",_o,[e("div",{ref_key:"echartsRefICDistribution",ref:be,style:{width:"100%",height:"400px"}},[Le(Pe,{visible:!0})],512)])]),e("div",bo,[e("div",ko,q(Te.value),1),e("div",Co,[e("div",{ref_key:"echartsRefICSequence",ref:ye,style:{width:"100%",height:"400px"}},[Le(Pe,{visible:!0})],512)])]),e("div",Lo,[e("div",So,q(ct.value),1),e("div",Eo,[e("div",{ref_key:"echartsRefICCcorrelation",ref:et,style:{width:"100%",height:"400px"}},[Le(Pe,{visible:!0})],512)])]),e("div",Ro,[e("div",No,q(i.value),1),e("div",Do,[e("div",{ref_key:"echartsRefRankICDecay",ref:n,style:{width:"100%",height:"400px"}},[Le(Pe,{visible:!0})],512)])]),e("div",Io,[e("div",Fo,q(Ne.value),1),e("div",Bo,[e("div",{ref_key:"echartsRefRankICDistribution",ref:Ae,style:{width:"100%",height:"400px"}},[Le(Pe,{visible:!0})],512)])]),e("div",To,[e("div",Uo,q(ve.value),1),e("div",Wo,[e("div",{ref_key:"echartsRefRankICSequence",ref:_e,style:{width:"100%",height:"400px"}},[Le(Pe,{visible:!0})],512)])]),e("div",Mo,[e("div",Oo,q(Ue.value),1),e("div",Go,[e("div",{ref_key:"echartsRefRankICCcorrelation",ref:Ze,style:{width:"100%",height:"400px"}},[Le(Pe,{visible:!0})],512)])]),e("div",zo,[e("div",Vo,q(Ct.value),1),e("div",qo,[e("div",{ref_key:"echartsRefCurrentDeepAnalysis",ref:ie,style:{width:"100%",height:"400px"}},[Le(Pe,{visible:!0})],512)])]),e("div",Zo,[e("div",Qo,q(Lt.value),1),e("div",Po,[e("div",{ref_key:"echartsRefExcessReturnBigChart",ref:xt,style:{width:"100%",height:"400px"}},[Le(Pe,{visible:!0})],512)])])])])]))}}),Jo=at(Yo,[["__scopeId","data-v-62815ad4"]]),Ho={class:"logs-header"},$o={class:"controls"},Ko={class:"filter-group"},Xo=["value"],jo={class:"filter-group"},es={width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ts={key:0,d:"M3 4h13M3 8h9M3 12h5M19 20V8M15 16l4 4 4-4"},as={key:1,d:"M3 4h13M3 8h9M3 12h5M19 20V8M15 12l4-4 4 4"},os={class:"filter-group"},ss={class:"logs-content-area"},rs={class:"logs-table"},is={class:"log-message"},ns={key:0,class:"metadata-container"},ls=["onClick"],cs={class:"toggle-text"},ds={class:"log-metadata"},us={class:"logs-footer"},fs={class:"pagination-info"},hs={key:0},gs={class:"pagination-controls"},ps=["disabled"],vs={width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",style:{transform:"rotate(270deg)"}},As=["disabled"],ms={width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",style:{transform:"rotate(90deg)"}},ws=lt({__name:"Logs",props:{isCollapsed:{type:Boolean,default:!0},logCount:{type:Number,default:0}},setup(G){Wt();const I=bt(),Q=G,T=h([]),U=h(!1),r=h("ALL"),g=h("asc"),z=h(50),se=h(1),M=h([void 0]),re=h(void 0),ie=h(!1),ke=h(null),D=h(Q.isCollapsed);He(()=>Q.isCollapsed,w=>{w||(D.value=w)});const ae=h(new Set),k=h(50);let o=!1;const he=w=>{var L;o=!0,document.body.style.cursor="ns-resize",document.body.style.userSelect="none";const p=(L=w.target.closest(".logs-container"))==null?void 0:L.getBoundingClientRect();p&&(p.height,w.clientY,document.addEventListener("mousemove",Ce),document.addEventListener("mouseup",Ie))},Ce=w=>{if(!o)return;const p=window.innerHeight,L=w.clientY,ye=(p-L)/p*100;k.value=Math.min(Math.max(ye,20),80)},Ie=()=>{o=!1,document.body.style.cursor="",document.body.style.userSelect="",document.removeEventListener("mousemove",Ce),document.removeEventListener("mouseup",Ie)},E=async(w,p=!1)=>{if(!I.workflow_run_id||!I.workflow_id)return T.value=[],p&&(se.value=1,M.value=[void 0],re.value=void 0,ie.value=!1,ke.value=null),!1;U.value=!0;try{const L=localStorage.getItem("token"),pe={workflow_run_id:I.workflow_run_id,workflow_id:I.workflow_id,limit:Number(z.value)};w&&(pe.last_sequence=w),r.value!=="ALL"&&(pe.log_level=r.value);const ye=await Mt.get("http://localhost:8000/api/workflow/run/log",{params:pe,headers:{uid:"0","quantflow-auth":"2","Content-Type":"application/json",Authorization:`${L}`}});if(ye.status===200&&ye.data&&ye.data.data){const Te=ye.data.data;return T.value=Te.logs||[],re.value=Te.next_sequence,ie.value=Te.has_more??!1,ke.value=Te.total_count,p&&(se.value=1,M.value=[void 0]),!0}else return console.error("Failed to fetch logs:",ye),T.value=[],p&&(se.value=1,M.value=[void 0],re.value=void 0),ie.value=!1,!1}catch(L){return console.error("Error fetching logs:",L),T.value=[],p&&(se.value=1,M.value=[void 0],re.value=void 0),ie.value=!1,!1}finally{U.value=!1}},C=ht(()=>{let w=[...T.value];return r.value!=="ALL"&&(w=w.filter(p=>p.level===r.value)),w.sort((p,L)=>{const pe=new Date(p.timestamp).getTime(),ye=new Date(L.timestamp).getTime();return g.value==="asc"?pe-ye:ye-pe}),w}),ne=ht(()=>["ALL","INFO","ERROR","WARNING","DEBUG"]),ge=async()=>{if(ie.value&&re.value!=null&&!U.value){const w=re.value;await E(w,!1)&&(se.value++,M.value.length<se.value?M.value.push(w):M.value[se.value-1]=w)}},f=async()=>{if(se.value>1&&!U.value){const w=se.value-1,p=M.value[w-1];await E(p,!1)&&(se.value=w)}},P=()=>{g.value=g.value==="asc"?"desc":"asc",Xe(()=>{xe()})},Y=w=>{if(!w)return"N/A";try{return new Date(w).toLocaleString()}catch{return w}},le=()=>{E(void 0,!0)},F=()=>{D.value=!D.value,D.value||(k.value=50)},xe=()=>{const w=document.querySelector(".logs-content-area");w&&(g.value==="asc"?w.scrollTop=w.scrollHeight:w.scrollTop=0)};He(()=>T.value,()=>{Xe(()=>{xe()})},{deep:!0}),He(()=>Q.logCount,async(w,p)=>{w!==p&&I.workflow_run_id&&await E(void 0,!0)},{immediate:!1}),ut(async()=>{await E(void 0,!0)});const be=w=>{ae.value.has(w)?ae.value.delete(w):ae.value.add(w)};return(w,p)=>(y(),_("div",{class:je(["logs-container",{collapsed:D.value,dragging:Ye(o)}]),style:Oe({height:k.value+"%"})},[e("div",{class:"drag-handle",onMousedown:he},null,32),e("div",{class:"toggle-button",onClick:F},[(y(),_("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",style:Oe({transform:D.value?"rotate(0deg)":"rotate(180deg)"})},p[2]||(p[2]=[e("path",{d:"M7 14l5-5 5 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),4))]),e("div",Ho,[p[7]||(p[7]=Pt('<div class="title" data-v-7a5cf825><svg width="24" height="24" viewBox="0 0 24 24" fill="none" data-v-7a5cf825><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" data-v-7a5cf825></circle><path d="M8 9H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" data-v-7a5cf825></path><path d="M8 12H14" stroke="currentColor" stroke-width="2" stroke-linecap="round" data-v-7a5cf825></path><path d="M8 15H12" stroke="currentColor" stroke-width="2" stroke-linecap="round" data-v-7a5cf825></path></svg><span data-v-7a5cf825>日志内容</span></div>',1)),e("div",$o,[e("div",Ko,[p[3]||(p[3]=e("label",{for:"level-filter"},"级别:",-1)),dt(e("select",{id:"level-filter","onUpdate:modelValue":p[0]||(p[0]=L=>r.value=L),onChange:le},[(y(!0),_(Me,null,Je(ne.value,L=>(y(),_("option",{key:L,value:L},q(L),9,Xo))),128))],544),[[Nt,r.value]])]),e("div",jo,[p[4]||(p[4]=e("label",{for:"sort-order"},"时间:",-1)),e("button",{onClick:P,class:"sort-button"},[(y(),_("svg",es,[g.value==="desc"?(y(),_("path",ts)):(y(),_("path",as))]))])]),e("div",os,[p[6]||(p[6]=e("label",{for:"limit-per-page"},"每页:",-1)),dt(e("select",{id:"limit-per-page","onUpdate:modelValue":p[1]||(p[1]=L=>z.value=L),onChange:le},p[5]||(p[5]=[e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)]),544),[[Nt,z.value]])])])]),e("div",ss,[e("table",rs,[p[9]||(p[9]=e("thead",null,[e("tr",null,[e("th",{class:"timestamp-col"},"时间"),e("th",{class:"level-col"},"级别"),e("th",{class:"message-col"},"消息")])],-1)),e("tbody",null,[(y(!0),_(Me,null,Je(C.value,L=>(y(),_("tr",{key:L._id,class:je(["log-entry",`log-level-${L.level.toLowerCase()}`])},[e("td",null,q(Y(L.timestamp)),1),e("td",null,[e("span",{class:je(["log-level-badge",`log-level-badge-${L.level.toLowerCase()}`])},q(L.level),3)]),e("td",is,[wt(q(L.message)+" ",1),L.metadata&&Object.keys(L.metadata).length>0?(y(),_("div",ns,[e("button",{class:"metadata-toggle",onClick:pe=>be(L._id)},[e("span",cs,q(ae.value.has(L._id)?"收起详情":"查看详情"),1),(y(),_("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",class:je({rotate:ae.value.has(L._id)})},p[8]||(p[8]=[e("path",{d:"M6 9l6 6 6-6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),2))],8,ls),dt(e("div",ds,[e("pre",null,q(JSON.stringify(L.metadata,null,2)),1)],512),[[_t,ae.value.has(L._id)]])])):We("",!0)])],2))),128))])])]),e("div",us,[e("div",fs,[e("span",null,"第 "+q(se.value)+" 页",1),ke.value!==null?(y(),_("span",hs," / 总 "+q(ke.value)+" 条记录",1)):We("",!0),e("span",null," (已加载 "+q(T.value.length)+" 条)",1)]),e("div",gs,[e("button",{onClick:f,disabled:se.value===1||U.value,class:"pagination-button pagination-button-prev"},[(y(),_("svg",vs,p[10]||(p[10]=[e("path",{d:"M7 14l5-5 5 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))),p[11]||(p[11]=wt(" 上一页 "))],8,ps),e("button",{onClick:ge,disabled:!ie.value||U.value,class:"pagination-button pagination-button-next"},[p[13]||(p[13]=wt(" 下一页 ")),(y(),_("svg",ms,p[12]||(p[12]=[e("path",{d:"M7 14l5-5 5 5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])))],8,As)])])],6))}}),ys=at(ws,[["__scopeId","data-v-7a5cf825"]]),xs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAYtJREFUWEfV2dFxgzAMAFDZS2SHbEG26D8cPx2nP9zx3y2aLbIDGcLOqcW9lGBLlgym+cQGPxQsccIAALRtezLGfFpr34dhuOGxWr++78/OuQ/v/ds4jpOZcV8AcAaAu7W2qYWccWg5AcDNe38xXdfhgeYpYlWQC1zgXE1kYFdkxDB57xuD1JrIGM5ae8FH7RtYC0nh0PULTCCncDcldzYH9wLcC8nFrQK3RubgosCtkLm4JLA0UoIjgaWQUhwLqEVqcGygFKnFZQFzkSVw2UAushROBKSQOO6cC69MofiIq9GfUpdTymJRmq+B73NqnDiCYeUI8vk+xZELFxFHkIFU49QRTDyPOFQfeOi/+NCbJJXnqqcZThLmzOGmtKxdnLNwztwUlg2ULCg5Z4llATULac5l5UHtAlTtptosyQiWwBEVh0zmUWBJnAa5CtwCJ0W+ALfESZD/p/WxR+SWOY6zZqr9Ru4wbrlKzaOQsQbmLjjOM7nWAt4VRyCvyyZ6FVwE+dNEx8Ejf4Z4AOhffFtCFuoVAAAAAElFTkSuQmCC",_s={class:"alert"},bs={class:"box"},ks={__name:"alert",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(G,{emit:I}){const Q=G,T=I,U=()=>{T("close")};return(r,g)=>dt((y(),_("div",_s,[e("div",bs,[e("img",{onClick:U,class:"close-btn",src:xs}),Yt(r.$slots,"default",{},void 0,!0)])],512)),[[_t,Q.show]])}},mt=at(ks,[["__scopeId","data-v-34167be4"]]),Cs={key:0,class:"alert-container"},Ls={class:"alert-header"},Ss={class:"alert-content"},Es={key:1,class:"alert-container"},Rs={class:"alert-header"},Ns={class:"alert-content"},Ds={class:"content-container"},Is={class:"toolbar-container"},Fs={class:"run-container"},Bs={key:0,style:{"font-size":"12px",color:"#fff",position:"absolute",top:"-26px",transform:"scale(0.8)"}},Ts={key:0,class:"drag-overlay"},Us=lt({__name:"Editor",setup(G){const I=h(null);let Q=null;const T=h(null),U=Wt(),r=Jt(),g=bt(),z=()=>{g.codeStatus=!1,g.code=""};He(()=>g.codeStatus,()=>{console.log("workflowStore.codeStatus",g.codeStatus),console.log("workflowStore.code",g.code),Q&&setTimeout(()=>{Q.setValue(g.code)},300)}),He(()=>r.isBoxShow,async()=>{console.log("---2333-----"),r.isBoxShow&&(await Xe(),console.log("strategyAnalysisRef.value",T.value),T.value&&(console.log("---23334-----"),T.value.handleApply({workflow_id:r.id,title:g.title,feature_tag:"backtest",locator:"backtest_id",last_run_id:g.workflow_run_id},!1)))});const se=()=>{if(g.node.node){g.node.node.properties[g.node.title]=Q.getValue(),g.code=Q.getValue();const a=g.node.node.widgets.find(s=>s.name===g.node.title);a.value=Q.getValue(),console.log("workflowStore.node.widget",a),g.codeStatus=!1}};function M(a,s=!1){a||(a=window.location.href);const n={},i=a.indexOf("?");if(i!==-1){const m=a.indexOf("#",i),J=m!==-1?a.substring(i+1,m):a.substring(i+1);re(J,n)}if(s){const m=a.indexOf("#");if(m!==-1&&m<a.length-1){const J=a.substring(m+1),oe=J.indexOf("?");if(oe!==-1){const Ae=J.substring(oe+1);re(Ae,n)}}}return n}function re(a,s){if(!a)return;const n=a.split("&");for(const i of n){const[m,J]=i.split("=",2);m&&(s[decodeURIComponent(m)]=J!==void 0?decodeURIComponent(J):"")}}const ie=Tt(),ke=h(!1),D=h(null);let ae=h(null),k,o;const he=h(!1),Ce=h(0),Ie=h(!1);let E=0,C=0,ne=1;const ge=()=>{C+=.03*ne,C>=1?(C=1,ne=-1):C<=0&&(C=0,ne=1),o&&o.draw(!0,!0),requestAnimationFrame(ge)};ge();const f=()=>{const a=D.value,s=Math.max(window.devicePixelRatio,1);a.height=a.width=NaN;const{width:n,height:i}=a.getBoundingClientRect();a.width=Math.round(n*s),a.height=Math.round(i*s),a.getContext("2d").scale(s,s),o.scale_offset=[1,1],o.ds.scale=1,o.dirty_canvas=!0,o.dirty_bgcanvas=!0,o==null||o.draw(!0,!0)},P=a=>{var s;if(he.value){a.preventDefault();return}(s=a.dataTransfer)!=null&&s.types.includes("Files")&&(a.preventDefault(),E++,Ie.value=!0)},Y=a=>{var n,i;if(he.value){a.preventDefault();return}(((n=a.dataTransfer)==null?void 0:n.types.includes("node-type"))||(i=a.dataTransfer)!=null&&i.types.includes("Files"))&&(a.preventDefault(),a.dataTransfer.dropEffect="copy")},le=a=>{var s;if(he.value){a.preventDefault();return}(s=a.dataTransfer)!=null&&s.types.includes("Files")&&(a.preventDefault(),E--,E<=0&&(Ie.value=!1,E=0))},F=async a=>{var n,i,m,J,oe,Ae,Ne;if(g.owner==="*"){ie.warning("当前为模版,不支持导入覆盖，请先点击保存按钮创建个人工作流后，再进行导入!",{timeout:2e3});return}if(he.value){if(a.preventDefault(),(n=a.dataTransfer)!=null&&n.types.includes("Files")){const H=a.dataTransfer.files;H!=null&&H.length&&H[0].name.toLowerCase().endsWith(".json")&&ie.warning("工作流运行时无法导入 JSON 文件",{timeout:2e3})}return}if((i=a.dataTransfer)==null?void 0:i.types.includes("node-type")){const H=(m=a.dataTransfer)==null?void 0:m.getData("node-type");if(console.log("nodeType:",H),H&&k){const ce=(J=D.value)==null?void 0:J.getBoundingClientRect();if(ce){const Z=a.clientX-ce.left,_e=a.clientY-ce.top,ve=o.ds.scale||1,me=o.ds.offset||[0,0],Fe=[(Z-me[0])/ve,(_e-me[1])/ve],Ee=De.createNode(H);if(Ee){Ee.pos=Fe;let Ze=0;for(const Ue of k.nodes)Ue.order&&Ue.order>Ze&&(Ze=Ue.order);Ee.order=Ze+1e3,k.add(Ee),k.setDirtyCanvas(!0),o.draw(!0,!0)}}}return}if((oe=a.dataTransfer)!=null&&oe.types.includes("Files")){a.preventDefault(),Ie.value=!1,E=0;const H=a.dataTransfer.files;if(!(H!=null&&H.length))return;const ce=H[0];if(!ce.name.toLowerCase().endsWith(".json")){mt("请拖入 JSON 文件");return}try{const Z=await ce.text(),_e=JSON.parse(Z).litegraph;if(!k||!o){console.error("Graph or GraphCanvas not initialized");return}k.clear();try{if(k.configure(_e),k.nodes.forEach(ve=>{ve._fullTitle?ve.title=ve.truncateTitle(ve._fullTitle):(ve._fullTitle=ve.title||"",ve.title=ve.truncateTitle(ve.title||""))}),k.nodes.length>0){const ve=k.nodes[0],me=D.value.getBoundingClientRect(),Fe=me.width,Ee=me.height;o.setZoom(1);const Ze=ve.pos[0],Ue=ve.pos[1],Ve=((Ae=ve.size)==null?void 0:Ae[0])||0,tt=((Ne=ve.size)==null?void 0:Ne[1])||0;o.ds.offset=[Fe/2-(Ze+Ve/2),Ee/2-(Ue+tt/2)],o.setDirty(!0,!0)}else o.setZoom(1),o.ds.offset=[0,0];o.draw(!0,!0),console.log("Graph imported successfully")}catch(ve){console.error("Error configuring graph:",ve),mt("导入失败：图形数据格式不正确")}}catch(Z){console.error("Import failed:",Z),mt("导入失败，请检查文件格式是否正确")}}},xe=()=>{const a=getComputedStyle(document.documentElement),s=i=>a.getPropertyValue(i).trim();De.NODE_DEFAULT_BGCOLOR=s("--node-bg"),De.NODE_TEXT_COLOR=s("--node-text"),De.BACKGROUND_IMAGE_COLOR=s("--node-bg"),De.GRID_COLOR=s("--grid-color");const n=document.documentElement.classList.contains("dark");De.LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,De.LGraphCanvas.link_type_colors={tezheng:"#339966",mubiao:"#CC3366",hangqing:"#3366CC",out1:"#CC6600",out2:"#0ff",target1:"#0ff",target2:"#f56c6c"}},be=h(!1);He(be,a=>{a&&o.visible_nodes.forEach(s=>{s.inputs.forEach((n,i)=>{})})}),He(he,a=>{!k||!o||(a?(o.allow_dragnodes=!1,o.allow_reconnect_links=!1,o.allow_linking=!1,o.allow_select_nodes=!1,k.nodes.forEach(s=>{s.inputs&&s.inputs.forEach(n=>{n.locked=!0}),s.outputs&&s.outputs.forEach(n=>{n.locked=!0}),s.widgets&&s.widgets.forEach(n=>{n.disabled=!0})})):(o.allow_dragnodes=!0,o.allow_dragcanvas=!0,o.allow_reconnect_links=!0,o.allow_linking=!0,o.allow_select_nodes=!0,k.nodes.forEach(s=>{s.inputs&&s.inputs.forEach(n=>{n.locked=!1}),s.outputs&&s.outputs.forEach(n=>{n.locked=!1}),s.widgets&&s.widgets.forEach(n=>{n.disabled=!1})})),o.draw(!0,!0))});const w=async a=>{try{const n={uid:"0","quantflow-auth":"2","Content-Type":"application/json",Authorization:`${localStorage.getItem("token")}`},i=await fetch(`http://localhost:8000/api/workflow/query?workflow_id=${a}`,{headers:n});if(i.status===404)return ie.error("工作流不存在!"),null;if(i.ok){const m=await i.json();return g.title=m.name,g.owner=m.owner,console.log("获取workflow数据成功:",m),m.last_run_id&&(g.workflow_run_id=m.last_run_id,et(null,"auto")),m}else throw new Error(`请求失败: ${i.status} ${i.statusText}`)}catch(s){return console.error("获取workflow数据失败:",s),null}},p=a=>{try{if(!a){console.error("获取workflow数据为空:",a);return}const s=a.litegraph;if(!k||!o){console.error("Graph or GraphCanvas not initialized");return}k.clear();try{if(k.configure(s),k.nodes.forEach(n=>{n._fullTitle?n.title=n.truncateTitle(n._fullTitle):(n._fullTitle=n.title||"",n.title=n.truncateTitle(n.title||""))}),k.nodes.length>0){let n=1/0,i=-1/0,m=1/0,J=-1/0;k.nodes.forEach(Ue=>{var Ve,tt;n=Math.min(n,Ue.pos[0]),i=Math.max(i,Ue.pos[0]+(((Ve=Ue.size)==null?void 0:Ve[0])||0)),m=Math.min(m,Ue.pos[1]),J=Math.max(J,Ue.pos[1]+(((tt=Ue.size)==null?void 0:tt[1])||0))});const oe=i-n,Ae=J-m,Ne=D.value.getBoundingClientRect(),H=Ne.width,ce=Ne.height,Z=100,_e=(H-Z*2)/oe,ve=(ce-Z*2)/Ae,me=Math.min(_e,ve,1);o.setZoom(me);const Fe=(n+i)/2,Ee=(m+J)/2,Ze=window.devicePixelRatio||1;o.ds.offset=[H/2/Ze-Fe*me+350,ce/2/Ze-Ee*me+100],o.setDirty(!0,!0)}else o.setZoom(1),o.ds.offset=[0,0];o.draw(!0,!0),console.log("Graph imported successfully")}catch(n){console.error("Error configuring graph:",n),console.log("api工作流数据导入失败：图形数据格式不正确",n)}}catch(s){console.error("Import failed:",s),console.log("api工作流数据导入失败，请检查文件格式是否正确",s)}};ut(async()=>{Q=Ht.create(I.value,{value:"",theme:"vs-dark",language:"python",automaticLayout:!0,contextmenu:!0,scrollbar:{alwaysConsumeMouseWheel:!0,useShadows:!1,verticalScrollbarSize:5,horizontalScrollbarSize:5},padding:{top:10,bottom:0,left:0,right:0},minmap:{enabled:!0},quickSuggestions:{other:!0,comments:!1,strings:!1},suggest:{snippetsPreventQuickSuggestions:!1,showIcons:!0,maxVisibleSuggestions:12,selectionMode:"always",insertMode:"insert",minWordLength:1,filterGraceful:!0,acceptSuggestionOnEnter:"on",tabCompletion:"on"},wordBasedSuggestions:!0,quickSuggestionsDelay:10,parameterHints:{enabled:!0,cycle:!0}}),setTimeout(()=>{Q.setValue(g.code)},300);const a=M(window.location.href);if(console.log("params:",a),console.log("params.workflow_id:",a.workflow_id),a.workflow_id===""||!a.workflow_id?(g.workflow_id="",g.owner="",g.workflow_run_id="",g.title=""):g.workflow_id=a.workflow_id,console.log("onMounted"),!D.value)return;xe(),De.LGraphCanvas.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",De.pointerListenerAdd(D.value,"move",i=>{be.value=o.pointer.dragStarted}),k=new De.LGraph,o=new De.LGraphCanvas(D.value,k),ae.value=k,o.high_quality=!0,o.render_connections_border=!0,o.render_curved_connections=!0,o.links_render_mode=De.SPLINE_LINK,o.render_canvas_border=!1,o.render_connection_arrows=!1,o.render_curved_connections=!1,o.links_render_mode=De.SPLINE_LINK,o.render_shadows=!0,o.zoom_modify_alpha=!0;const s=()=>{o&&xe()},n=new MutationObserver(()=>{s()});if(n.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),o.setZoom(Math.max(window.devicePixelRatio,1)),o.ds.offset=[0,0],o.allow_dragcanvas=!0,o.allow_dragnodes=!0,o.allow_interaction=!0,o.allow_searchbox=!1,o.drag_mode=!1,o.allow_reconnect_links=!0,o.allow_zoom=!0,o.onShowNodeCreationDialog=()=>!1,o.onDrawForeground=i=>{for(const m of o.visible_nodes){const J=m._pos,oe=m.size,Ae=De.NODE_TITLE_HEIGHT,Ne=m.flags.collapsed?Ae:oe[1]+Ae,H=6,ce=15;if(i.strokeStyle="rgba(39,103,238,0)",i.lineWidth=0,m.status==="success")i.strokeStyle="#33FF00",i.lineWidth=2;else if(m.status==="failed")i.strokeStyle="#FF0033",i.lineWidth=7;else if(m.status==="running"){const Ee=0+C*.6;i.strokeStyle=`rgba(51, 102, 255,${Ee})`,i.lineWidth=4}i.beginPath();const Z=J[0]-H,_e=J[1]-Ae-H;let ve=oe[0];m.flags.collapsed&&(i.save(),i.restore(),ve=Math.max(m.width));const me=ve+H*2,Fe=Ne+H*2;i.moveTo(Z+ce,_e),i.lineTo(Z+me-ce,_e),i.quadraticCurveTo(Z+me,_e,Z+me,_e+ce),i.lineTo(Z+me,_e+Fe-ce),i.quadraticCurveTo(Z+me,_e+Fe,Z+me-ce,_e+Fe),i.lineTo(Z+ce,_e+Fe),i.quadraticCurveTo(Z,_e+Fe,Z,_e+Fe-ce),i.lineTo(Z,_e+ce),i.quadraticCurveTo(Z,_e,Z+ce,_e),i.stroke()}},f(),window.addEventListener("resize",f),k.runStep(),s(),k.start(),ke.value=!0,k.change(),o.draw(!0,!0),De.NODE_BOX_OUTLINE_COLOR="rgba(39,103,238,0.65)",De.WIDGET_BGCOLOR="rgba(16,18,19,0.8)",De.WIDGET_SECONDARY_TEXT_COLOR="#858585",De.NODE_WIDGET_HEIGHT=25,await new Promise(i=>setTimeout(i,500)),a.workflow_id){const i=await w(a.workflow_id);p(i)}kt(()=>{n.disconnect(),window.removeEventListener("resize",f),k&&(k.stop(),ke.value=!1)})});const L=()=>{const a=k.serialize(),s={format_version:"2.0",name:g.title?g.title:`workflow-${new Date().toISOString().replace(/[:]/g,"-").slice(0,19)}`,description:"",litegraph:a,nodes:[],links:[]};g.title=s.name;const n=M(window.location.href);return n.workflow_id&&g.owner!=="*"&&(s.id=n.workflow_id),console.log("graphData.nodes:",a.nodes),a.nodes&&Array.isArray(a.nodes)&&(s.nodes=a.nodes.map(i=>{const m=Object.keys(i.properties),J={};return m.forEach(oe=>{var H;const Ae=(H=i.inputs.find(ce=>ce.name===oe))==null?void 0:H.fieldName,Ne=i.properties[oe];J[Ae]=Ne}),a.links.find(oe=>i.id===oe[1]),{uuid:i.flags.uuid,title:i.title||"",name:i.type||"",type:i.type||"",litegraph_id:i.id||0,positionX:i.pos?i.pos[0]:0,positionY:i.pos?i.pos[1]:0,width:i.size?i.size[0]:0,height:i.size?i.size[1]:0,static_input_data:J||{},output_db_id:null}})),a.links&&Array.isArray(a.links)&&(s.links=a.links.map(i=>{var _e,ve;const[m,J,oe,Ae,Ne,H]=i,ce=a.nodes.find(me=>me.id===J),Z=a.nodes.find(me=>me.id===Ae);return console.log("sourceNode,targetNode:",ce,Z),{uuid:Ut(),litegraph_id:J,status:1,previous_node_uuid:ce.flags.uuid,next_node_uuid:Z.flags.uuid,output_field_name:(_e=Z.inputs[Ne])==null?void 0:_e.fieldName,input_field_name:(ve=ce.outputs[oe])==null?void 0:ve.fieldName}})),s},pe=async()=>{if(L().nodes.length===0){ie.warning("当前工作区域为空，不可保存空白工作流！",{timeout:2e3});return}const a=JSON.stringify(L());try{const s=localStorage.getItem("token"),n=await fetch("http://localhost:8000/api/workflow/save",{method:"POST",headers:{uid:"0","quantflow-auth":"2","Content-Type":"application/json",Authorization:`${s}`},body:a});if(n.ok){const i=await n.json();console.log("保存的workflow_id:",i);const m=i.data&&i.data.workflow_id;g.workflow_id=m;const J=new URL(window.location.href);if(J.searchParams.set("workflow_id",m),window.history.replaceState({},"",J),console.log("保存的的workflow_id:",m),g.owner==="*"&&ie.success("模版工作流克隆成功！正在运行中...",{timeout:2e3}),g.owner="",g.workflow_id){const oe=new URL(window.location.href);oe.searchParams.set("workflow_id",g.workflow_id),window.history.replaceState({},"",oe)}return m}else throw new Error(`请求失败: ${n.status} ${n.statusText}`)}catch(s){return console.error("保存图表时出错:",s),ie.error("运行失败，请重试！",{timeout:2e3}),null}},ye=h(0),Te=async a=>{try{ye.value=-1;const s=localStorage.getItem("token"),n=await fetch("http://localhost:8000/api/workflow/run",{method:"POST",headers:{uid:"0","quantflow-auth":"2","Content-Type":"application/json",Authorization:`${s}`},body:JSON.stringify({workflow_id:a})});if(console.log("运行模式:","LOCAL"),n.ok){const i=await n.json();console.log("运行结果:",i);const m=i.data&&i.data.workflow_run_id;return g.workflow_run_id=m,m}else throw new Error(`请求失败: ${n.status} ${n.statusText}`)}catch(s){return console.error("运行图表时出错:",s),ie.error("运行失败，请重试！",{timeout:2e3}),null}},Be=async a=>{console.log("nodeStatus:",a),k.nodes.forEach(s=>{s.status=null}),a.success_node_ids&&a.success_node_ids.forEach(s=>{const n=k.nodes.find(i=>i.flags.uuid===s);n&&(n.status="success",o.draw(!0,!0))}),a.running_node_ids&&a.running_node_ids.forEach(s=>{const n=k.nodes.find(i=>i.flags.uuid===s);n&&(n.status="running",o.draw(!0,!0))}),a.failed_node_ids&&a.failed_node_ids.forEach(s=>{const n=k.nodes.find(i=>i.flags.uuid===s);n&&(n.status="failed",o.draw(!0,!0))})},Ge=h(!0),Re=async(a,s,n,i,m)=>{try{ye.value++;const J=localStorage.getItem("token"),oe=await Mt.get("http://localhost:8000/api/workflow/run",{params:{workflow_run_id:a,last_log_id:s},headers:{uid:"0","quantflow-auth":"2","Content-Type":"application/json",Authorization:`${J}`}});if(oe.status===200){const Ae=oe.data;console.log("轮询结果:",Ae),Be(Ae.data);const Ne=Ae.data&&Ae.data.progress;Ce.value=Ne,Ne<100&&he.value?g.pollTimer=setTimeout(Re.bind(this,a,s,n,i,m),i):(Ge.value=!0,m==="click"?ie.success("运行完成！"):m==="auto"&&ie.success("获取运行结果成功！"),console.log("轮询结束:",Ae.data),g.pollData={...Ae.data},he.value=!1,clearTimeout(g.pollTimer));const H=Ae.data&&Ae.data.status;if(H>=2&&(he.value=!1,Ce.value=Ne,clearTimeout(g.pollTimer),H==3)){const ce=Ae.data.last_error_message+`
`+Ae.data.last_error_stacktrace;m!=="auto"&&(Ge.value=!1),setTimeout(()=>{Ge.value=!0},300)}H>2&&m==="auto"&&k.nodes.forEach(ce=>{ce.status=null})}else throw new Error(`请求失败: ${oe.status} ${oe.statusText}`)}catch(J){console.error("轮询工作流状态时出错:",J),he.value=!1,clearTimeout(g.pollTimer)}},et=async(a,s)=>{if(a&&ze(a),a){if(g.workflow_id=await pe(),console.log("workflow_id:",g.workflow_id),g.workflow_id){const n=await Te(g.workflow_id);g.workflow_run_id=n,console.log("workflow_run_id11:",g.workflow_run_id),Re(n,0,g.user_id,5e3,"click"),he.value=!0,Ce.value=0,g.pollData=null}}else Re(g.workflow_run_id,0,g.user_id,5e3,"auto"),he.value=!0,Ce.value=0,g.pollData=null},ct=async a=>{a&&ze(a);try{he.value=!1,Ce.value=0,clearTimeout(g.pollTimer),await new Promise(i=>setTimeout(i,500)),k.nodes.forEach(i=>{i.status=null}),o.allow_dragnodes=!0,o.allow_dragcanvas=!0,o.allow_reconnect_links=!0,o.allow_linking=!0,o.allow_select_nodes=!0,k.nodes.forEach(i=>{i.inputs&&i.inputs.forEach(m=>{m.locked=!1}),i.outputs&&i.outputs.forEach(m=>{m.locked=!1}),i.widgets&&i.widgets.forEach(m=>{m.disabled=!1})}),k.setDirtyCanvas(!0),o.draw(!0,!0);const s=localStorage.getItem("token"),n=await fetch("http://localhost:8000/api/workflow/run/terminate",{method:"POST",headers:{uid:"0","quantflow-auth":"2","Content-Type":"application/json",Authorization:`${s}`},body:JSON.stringify({workflow_run_id:g.workflow_run_id})});if(n.ok)console.log("停止运行成功"),ie.success("停止运行成功",{timeout:2e3});else throw new Error(`请求失败: ${n.status} ${n.statusText}`)}catch(s){console.error("停止运行时出错:",s),ie.error("停止运行失败",{timeout:2e3})}},ze=a=>{const s=a.currentTarget;s.classList.remove("animating-ripple"),s.offsetWidth,s.classList.add("animating-ripple"),setTimeout(()=>{s.classList.remove("animating-ripple")},600)};return(a,s)=>(y(),_(Me,null,[Ye(U).isBoxShow?(y(),_("div",Cs,[e("div",Ls,[e("img",{class:"close-btn",src:It,alt:"close",style:{width:"16px",height:"16px",cursor:"pointer"},onClick:s[0]||(s[0]=(...n)=>Ye(U).closeBox&&Ye(U).closeBox(...n))})]),e("div",Ss,[Le(Jo,{into:!0,factorId:"",taskId:Ye(U).id},null,8,["taskId"])])])):We("",!0),Ye(r).isBoxShow?(y(),_("div",Es,[e("div",Rs,[e("img",{class:"close-btn",src:It,alt:"close",style:{width:"16px",height:"16px",cursor:"pointer"},onClick:s[1]||(s[1]=(...n)=>Ye(r).closeBox&&Ye(r).closeBox(...n))})]),e("div",Ns,[Le(ha,{ref_key:"strategyAnalysisRef",ref:T},null,512)])])):We("",!0),e("div",{class:"graph-editor litegraph .litegraph-editor",onDragenter:ft(P,["prevent"]),onDragover:ft(Y,["prevent"]),onDragleave:ft(le,["prevent"]),onDrop:ft(F,["prevent"])},[e("div",Ds,[e("canvas",{ref_key:"canvas",ref:D},null,512),e("div",Is,[Le(Ma,{"is-running":he.value,progress:Ce.value,graph:Ye(k),"is-graph-ready":ke.value,canvas:Ye(o)},null,8,["is-running","progress","graph","is-graph-ready","canvas"])]),e("div",Fs,[he.value?(y(),_("div",Bs,q(Ce.value.toFixed(2))+"%",1)):We("",!0),he.value?(y(),_("div",{key:1,class:"progress-bar",style:Oe({width:Ce.value+"%"})},null,4)):We("",!0),he.value?(y(),_("button",{key:3,class:"run-button stop-run-button",onClick:s[3]||(s[3]=n=>ct(n))},s[5]||(s[5]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z",fill:"currentColor"})],-1)]))):(y(),_("button",{key:2,class:"run-button",onClick:s[2]||(s[2]=n=>et(n))},s[4]||(s[4]=[e("svg",{class:"play-icon",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M8 5.14v14.72a1 1 0 001.5.86l11-7.36a1 1 0 000-1.72l-11-7.36a1 1 0 00-1.5.86z",fill:"currentColor"})],-1)])))]),Le(ys,{logCount:ye.value,isCollapsed:Ge.value},null,8,["logCount","isCollapsed"]),Le($t,{name:"fade"},{default:Dt(()=>[Ie.value?(y(),_("div",Ts,s[6]||(s[6]=[e("div",{class:"drag-message"},[e("svg",{class:"upload-icon",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 3L20 10H16.5V19H7.5V10H4L12 3Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]),e("p",null,"释放以导入 JSON 文件")],-1)]))):We("",!0)]),_:1})])],32),Le(mt,{onClose:z,show:Ye(g).codeStatus},{default:Dt(()=>[s[7]||(s[7]=e("div",{class:"editorMonaco-head",style:{height:"40px","line-height":"40px","text-indent":"20px",color:"#fff","font-size":"14px"}},"编辑代码",-1)),e("div",{class:"editorMonaco",style:{height:"calc(100% - 100px)"},ref_key:"editorDom",ref:I},null,512),e("div",{class:"editorMonaco-foot",style:{height:"40px","padding-top":"15px"}},[e("div",{class:"content-btn active",onClick:se,style:{display:"inline-flex",float:"right","margin-right":"20px"}},"确定")])]),_:1,__:[7]},8,["show"])],64))}}),Ws=at(Us,[["__scopeId","data-v-c8170adf"]]),Ms={class:"quantflow-container"},Os={class:"content-container"},Gs={class:"aside-container"},zs=lt({__name:"Quantflow",setup(G){const I=h(!0),Q=T=>{I.value=T};return(T,U)=>(y(),_("div",Ms,[Le(Gt),U[0]||(U[0]=wt()),e("div",Os,[e("div",Gs,[Le(Fa,{onCategoriesLoadingState:Q})]),Le(Ws)])]))}}),Ys=at(zs,[["__scopeId","data-v-36d9fec6"]]);export{Ys as default};
